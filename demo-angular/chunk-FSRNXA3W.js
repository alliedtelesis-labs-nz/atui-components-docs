import{a}from"./chunk-H66LYRGA.js";import{a as h,b as n,c as l,d,e as u}from"./chunk-CP7M2NO3.js";import{i as o}from"./chunk-7EPSDV5K.js";var g=a("fixed z-menu w-full rounded-md border border-solid border-light bg-white p-4 shadow-md",{variants:{open:{true:null,false:"hidden"}}}),b=class{constructor(s){h(this,s),this.menuStateChange=u(this,"menuStateChange",7),this.offset_x=0,this.offset_y=0,this.position="bottom",this.align="start",this.width="280px",this.autoclose=!0,this.trigger="click",this.role="menu",this.disabled=!1,this.isOpen=!1,this.isIntersectingViewport=!1,this.updatePosition=()=>{requestAnimationFrame(()=>{let e=this.triggerEl;e&&(this.triggerPosition=e.getBoundingClientRect())})},this.handleOutsideClick=e=>{this.isOpen&&!this.el.contains(e.target)&&this.mouseLeaveHandler()}}toggleMenu(){return o(this,null,function*(){this.menuStateChange.emit(!this.isOpen),this.isOpen=!this.isOpen,this.updatePosition()})}openMenu(){return o(this,null,function*(){this.isOpen=!0,this.menuStateChange.emit(!0)})}closeMenu(){return o(this,null,function*(){this.isOpen=!1,this.menuStateChange.emit(!1)})}getIsOpen(){return o(this,null,function*(){return this.isOpen})}componentDidLoad(){this.updatePosition(),window.addEventListener("scroll",this.updatePosition,!0),window.addEventListener("resize",this.updatePosition),window.addEventListener("click",this.handleOutsideClick),this.initIntersectionObserver()}disconnectedCallback(){window.removeEventListener("scroll",this.updatePosition,!0),window.removeEventListener("resize",this.updatePosition),window.removeEventListener("click",this.handleOutsideClick),this.observer&&this.observer.disconnect()}initIntersectionObserver(){let s={root:null,rootMargin:"0px",threshold:1};this.observer=new IntersectionObserver(t=>{t.forEach(i=>{i.isIntersecting?this.isIntersectingViewport=!1:(this.isIntersectingViewport=!0,this.positionStrategy(i))})},s);let e=this.el.querySelector('[data-name="menu-content-wrapper"]');e&&this.observer.observe(e)}positionStrategy(s){if(!this.isOpen)return;let e=window.innerWidth,t=window.innerHeight,{top:i,right:r,left:c,height:p}=s.boundingClientRect;this.position==="bottom"&&i+p>=t?this.position="top":this.position==="top"&&i<=0&&(this.position="bottom"),this.position==="right"&&r>=e?this.position="left":this.position==="left"&&c<=0&&(this.position="right")}mouseEnterHandler(){this.timedOutCloser&&clearTimeout(this.timedOutCloser),this.isOpen||(this.isOpen=!0,this.menuStateChange.emit(!0),this.updatePosition())}mouseLeaveHandler(){this.timedOutCloser=setTimeout(()=>{this.isOpen=!1,this.menuStateChange.emit(!1)},150)}get positionStyle(){var s,e;let t={},i=(s=this.triggerEl)===null||s===void 0?void 0:s.getBoundingClientRect(),r=(e=this.menuEl)===null||e===void 0?void 0:e.getBoundingClientRect();if(!i)return t;switch(this.position){case"top":t.top=`${i.top-r.height}px`,this.align==="start"?t.left=`${i.left}px`:t.right=`${window.innerWidth-i.right}px`;break;case"bottom":t.top=`${i.bottom+this.offset_y}px`,this.align==="start"?t.left=`${i.left}px`:t.right=`${window.innerWidth-i.right-8}px`;break;case"left":t.left=`${i.left-r.width}px`,this.align==="start"?t.top=`${i.top}px`:t.bottom=`${window.innerHeight-i.bottom}px`;break;case"right":t.left=`${i.right+this.offset_x}px`,this.align==="start"?t.top=`${i.top}px`:t.bottom=`${window.innerHeight-i.bottom}px`;break}return t.width=this.width,t}render(){let s=g({open:this.isOpen});return n(l,{key:"9a57f48286b36e8ea821ede6f490fa34342a89ee"},n("div",{key:"a897e7320acf66d4089f814ff56c5f90f1a7ca61",class:"relative",onBlur:()=>this.trigger==="click"&&!this.disabled?this.mouseLeaveHandler():null},n("div",{key:"036b305841cacd2e3383f0dd4856c0952e13bf32","aria-haspopup":"true","data-name":"menu-trigger",ref:e=>this.triggerEl=e,"aria-expanded":`${this.isOpen?"true":"false"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled?this.mouseEnterHandler():null,onKeyDown:e=>o(this,null,function*(){e.key==="Escape"&&(yield this.closeMenu())}),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled?this.mouseLeaveHandler():null,onClick:()=>this.trigger==="click"&&!this.disabled?this.toggleMenu():null,class:this.disabled?"contents":""},n("slot",{key:"f0f45a293508792f7146315c78d4f0b02ae4f453",name:"menu-trigger"})),n("div",{key:"a43d19713a09a855a993fa3839dd5bc96526188d",role:this.role,style:this.positionStyle,"data-position":this.position,"data-align":this.align,ref:e=>this.menuEl=e,"aria-hidden":`${this.isOpen?"false":"true"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:e=>{(e.key==="Enter"||e.key===" "||e.key==="Escape")&&this.autoclose&&this.mouseLeaveHandler()},onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:s,"data-name":"menu-content-wrapper"},n("slot",{key:"9cdd0ba67f15c28dca859481b243e5d9ab5a25db",name:"menu-content"}))))}get el(){return d(this)}};export{b as atui_menu};
