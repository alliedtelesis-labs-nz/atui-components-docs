import{a as o}from"./chunk-5H2OG7DN.js";import{a as u,b as i,c as f,d as _}from"./chunk-OYGHDCNF.js";import{h as d}from"./chunk-B7O3QC5Z.js";var b=class{constructor(e){u(this,e),this.page_size=10,this.use_custom_pagination=!1,this.auto_size_columns=!0,this.tableCreated=!1,this.activeFilters={},this.selectedFilters=[],this.menuSelectedIds=[],this.searchValue=""}handleSelectedFiltersChange(e){this.menuSelectedIds=e.map(t=>t.id),this.updateActiveFilters()}componentWillLoad(){return d(this,null,function*(){this.translations=yield o(this.el)})}componentDidLoad(){return d(this,null,function*(){yield this.initGrid()})}componentDidUpdate(){return d(this,null,function*(){yield this.initGrid()})}updateRowByIndex(e,t){return d(this,null,function*(){let h=this.agGrid.getRenderedNodes();e.forEach(({index:l,update:r})=>{let a=h.find(s=>s.rowIndex===l);a&&(a.updateData(r),t?.flash&&this.agGrid.flashCells({rowNodes:[a]}),this.agGrid.refreshCells({rowNodes:[a],force:t?.forceRefresh||!1}))})})}getDisplayedRows(){return d(this,null,function*(){return this.agGrid.getRenderedNodes()})}initGrid(){return d(this,null,function*(){var e;this.col_defs&&!this.tableCreated&&this.tableEl&&(this.agGrid=yield this.tableEl.createGrid(),this.tableCreated=!0,this.setupExternalFilters(),!((e=this.table_data)===null||e===void 0)&&e.items&&this.agGrid.setGridOption("rowData",this.table_data.items))})}setupExternalFilters(){this.agGrid&&(this.agGrid.setGridOption("isExternalFilterPresent",()=>Object.keys(this.activeFilters).length>0),this.agGrid.setGridOption("doesExternalFilterPass",e=>{if(!e.data)return!0;let t=this.activeFilters.__search__;if(t){let l=t.toLowerCase();if(!this.col_defs.some(a=>{let s;return a.valueGetter&&typeof a.valueGetter=="function"?s=a.valueGetter({data:e.data,node:e,colDef:a,api:this.agGrid,context:null,getValue:n=>e.data[n],column:null}):a.field&&(s=e.data[a.field]),s&&String(s).toLowerCase().includes(l)}))return!1}return Object.entries(this.activeFilters).every(([l,r])=>{if(l==="__search__"||!r)return!0;let a=this.col_defs.find(c=>c.field===l),s;return a&&a.valueGetter&&typeof a.valueGetter=="function"?s=a.valueGetter({data:e.data,node:e,colDef:a,api:this.agGrid,context:null,getValue:c=>e.data[c],column:null}):s=e.data[l],s&&String(s).toLowerCase().includes(String(r).toLowerCase())})}))}handleColumnChange(e){let{id:t,checked:h}=e.detail,l=this.col_defs.map(r=>r.field===t?Object.assign(Object.assign({},r),{hide:!h}):r);this.col_defs=l}handleFilterChange(e){if(!e.detail||Array.isArray(e.detail)&&e.detail.length===0){this.selectedFilters=[],this.menuSelectedIds=[],this.updateActiveFilters();return}Array.isArray(e.detail)&&(typeof e.detail[0]=="string"?this.handleMenuFilterChange(e.detail):typeof e.detail[0]=="object"&&this.handleFilterListChange(e.detail)),this.updateActiveFilters()}handleMenuFilterChange(e){this.selectedFilters=e.map(t=>({id:t,value:""})),this.menuSelectedIds=e}handleFilterListChange(e){!e.length||e.length===1&&e[0].id===""?(this.selectedFilters=[],this.menuSelectedIds=[]):(this.selectedFilters=e,this.menuSelectedIds=e.map(t=>t.id))}updateActiveFilters(){let e=this.activeFilters.__search__;this.activeFilters={},e&&(this.activeFilters.__search__=e),this.selectedFilters.forEach(t=>{t.value&&(this.activeFilters[t.id]=t.value)}),this.searchValue&&(this.activeFilters.__search__=this.searchValue),this.agGrid?(this.setupExternalFilters(),this.agGrid.onFilterChanged()):console.log("agGrid not available, cannot apply filter")}handleSearchChange(e){this.searchValue=e.detail||"",this.searchValue?this.activeFilters.__search__=this.searchValue:delete this.activeFilters.__search__,this.updateActiveFilters()}render(){return i(f,{key:"d8c0a333b89a631b16a5559fd6562f0e7103c4f3"},i("atui-table-actions",{key:"c49a5f4aac8a1a3a9cec8c5ba337cc1e9a54b445",ag_grid:this.agGrid},i("div",{key:"6a4d8f88d5edcfaf2fdf9d1dd9300d112fc95ab8",class:"flex items-center gap-8",slot:"search"},!this.hide_dropdown_filters&&this.col_defs&&i("atui-table-filter-menu",{key:"3a850d86d22ef5415c2ba12fc04a979890d92d9e",slot:"filter-menu",col_defs:this.col_defs,selected:this.menuSelectedIds,onAtuiChange:e=>this.handleFilterChange(e)}),i("atui-search",{key:"7e9f9d615cae5a4567cd2c2a468fa55725c47057",class:"w-input-md",label:this.search_label,hint_text:this.search_hint,info_text:this.search_info_tooltip,placeholder:this.translations.ATUI.TABLE.SEARCH_BY_KEYWORD,onAtuiChange:e=>this.handleSearchChange(e)})),!this.hide_dropdown_filters&&this.col_defs&&i("atui-table-filters",{key:"28694b00adfc1ab7106f02f6e881482f94463c99",slot:"filters",col_defs:this.col_defs,selected:this.selectedFilters,onAtuiChange:e=>this.handleFilterChange(e)}),!this.hide_export_menu&&i("atui-table-export-menu",{key:"915d61ef599425ce457a7751af20b3f8028a7f99",slot:"export-menu"}),!this.hide_column_manager&&this.col_defs&&i("atui-column-manager",{key:"6ea922430862c5ed7f88149d153e03631714cb73",slot:"column-manager",col_defs:this.col_defs,onAtuiChange:e=>this.handleColumnChange(e)}),i("div",{key:"a49b646e2ddbe6d5235f8905a25aebbed2a5e79d",slot:"actions"},i("slot",{key:"457c73a8cdf9173df82921160cdd918c29f89c76",name:"actions"}))),i("slot",{key:"b48445382a05be1f598f412cf60d27f1bb31c0d0",name:"multi-select-actions"}),i("atui-table",{key:"74e7b3d2b6fa2ac01d140494044856b5cac34e0b",ref:e=>this.tableEl=e,table_data:this.table_data,col_defs:this.col_defs,page_size:this.page_size,use_custom_pagination:this.use_custom_pagination,disable_auto_init:!0,auto_size_columns:this.auto_size_columns}))}get el(){return _(this)}static get watchers(){return{selectedFilters:["handleSelectedFiltersChange"]}}};export{b as atui_search_table};
