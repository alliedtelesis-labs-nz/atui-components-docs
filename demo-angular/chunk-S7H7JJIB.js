import{a as c}from"./chunk-MDWZTFYQ.js";import{a as h}from"./chunk-5H2OG7DN.js";import{a as r}from"./chunk-Y2EDR7QV.js";import{a as l,b as s,c as d,d as u,e as n}from"./chunk-QU7G2TPC.js";import{h as o}from"./chunk-B7O3QC5Z.js";var g=r("relative flex flex-col items-end gap-2 rounded-lg border border-solid p-8 transition-[background-color,color,box-shadow] duration-300 ease-in-out",{variants:{invalid:{true:"border-destructive focus-within:border-destructive focus-within:ring-2 focus-within:ring-destructive/30",false:"border-med focus-within:border-active-foreground focus-within:ring-2 focus-within:ring-active-foreground/30"},disabled:{true:"pointer-events-none bg-surface-1",false:"bg-white"}},compoundVariants:[{disabled:!0,className:"focus-within:ring-0"}],defaultVariants:{invalid:!1,disabled:!1}}),f=r("w-full resize-none whitespace-pre-wrap break-words border-none bg-transparent text-body text-dark shadow-none outline-none focus-visible:ring-0 focus-visible:ring-offset-0",{variants:{invalid:{true:"border-destructive-foreground",false:"border-med"},disabled:{true:"pointer-events-none bg-surface-1",false:"bg-disableD-LIGHT"}},defaultVariants:{invalid:!1,disabled:!1}}),v=class{constructor(e){l(this,e),this.atuiChange=n(this,"atuiChange",7),this.atuiSubmit=n(this,"atuiSubmit",7),this.atuiStop=n(this,"atuiStop",7),this.atuiFocus=n(this,"atuiFocus",7),this.placeholder="Enter your message...",this.max_height=240,this.max_length=2e3,this.in_progress=!1,this.value="",this.disabled=!1,this.invalid=!1,this.inputId=`prompt-input-${Math.random().toString(36).substring(2,11)}`}componentWillLoad(){return o(this,null,function*(){this.translations=yield h(this.el)})}focusInput(){this.textareaEl&&(this.textareaEl.focus(),this.atuiFocus.emit())}handleInput(e){e.stopPropagation(),this.value=e.target.value,this.max_length&&this.value.length>this.max_length?this.invalid=!0:this.invalid=!1,this.atuiChange.emit(this.value),this.autoResize()}autoResize(){if(this.textareaEl){this.textareaEl.style.height="auto";let e=this.textareaEl.scrollHeight,t=Math.max(44,Math.min(e,this.max_height));this.textareaEl.style.height=`${t}px`}}componentDidLoad(){setTimeout(()=>{this.autoResize()},0)}handleKeyDown(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.sendMessage())}sendMessage(){this.in_progress?this.atuiStop.emit():this.value&&this.value.trim()!==""&&!this.invalid&&(this.atuiSubmit.emit(this.value.trim()),this.value="",this.invalid=!1,setTimeout(()=>{this.autoResize(),this.focusInput()},0))}render(){let e=!this.disabled&&!this.invalid&&(this.in_progress||this.value&&this.value.trim()!==""),t=g({invalid:this.invalid,disabled:this.disabled}),a=f({invalid:this.invalid,disabled:this.disabled});return s(d,{key:"aa968cd0ec4da3fe4afe9a8e53084a87c161d813",tabindex:"-1",id:this.inputId+"-container",class:"w-full px-16"},s("div",{key:"d3231c29c5b2926c8f2287c96fdafbf4815755ab",class:"flex flex-col"},s("slot",{key:"f22ecd5434d3ea0da975b8f3515f9038e43f9ac7",name:"label"}),(this.label||this.info_text)&&s("atui-form-label",{key:"5713272d9b12e90434bb8245f89d4d70c4538828",label:this.label,for:this.inputId,info_text:this.info_text,"data-name":"prompt-input-label"}),this.hint_text&&s("span",{key:"d480a19cb061b8dcd5b3ddb7932ca59eeb934d28",class:"mb-8 inline-block text-xs leading-tight text-light","data-name":"prompt-input-hint"},this.hint_text)),s("div",{key:"9e619856eb62d4cb9b77f4c0ac7c7189b8a01f0c",class:t},s("textarea",{key:"bfb86532a9bde8ca2d47f06d98a558c970a6705c",class:a,disabled:this.disabled,id:this.inputId,placeholder:this.placeholder,onInput:i=>this.handleInput(i),onKeyDown:i=>this.handleKeyDown(i),value:this.value,ref:i=>this.textareaEl=i,style:{minHeight:"44px",maxHeight:this.max_height+"px",overflow:"hidden"},"data-name":"prompt-input"}),s("div",{key:"7f7675707feffad6694ec5151ea3c690222161e4",class:"gap-1 flex w-full items-center justify-between"},s("div",{key:"b392664eaee8f5d98fdf798d88a65b3c2e4e650e",class:"flex items-center gap-4"},s("slot",{key:"5e5aaee983a84b29f39592c9877e6869b806f0e1",name:"actions-left"})),s("div",{key:"3c8ad41b2964af794df0926e9eb9350be5e75292",class:"flex items-center gap-4 self-end"},s("slot",{key:"7639389078abb571310dee5a9762d3caf0546886",name:"actions-right"}),s("atui-button",{key:"c8657bbfe05dd62ae93f99e1a372e1edcd7d61fe",class:"rounded-lg",size:"sm",type:"secondary",icon:this.in_progress?"stop":"arrow_upward",disabled:!e,onClick:()=>this.sendMessage(),onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&this.sendMessage()},"data-name":"prompt-send-button"})))),s("slot",{key:"47da738299a326283f129c428f6a7e9b754c199c",name:"footer"}),this.invalid&&s("span",{key:"f1d6f1a6f4af9d7d987113ceb7d43e148da2eef7",class:"text-xs text-error-dark","data-name":"error-text"},this.error_text?this.error_text:this.translations.ATUI.PROMPT.ERROR_MESSAGE))}get el(){return u(this)}},y=class{constructor(e){l(this,e),this.atuiMessageCopy=n(this,"atuiMessageCopy",7),this.atuiMessageRetry=n(this,"atuiMessageRetry",7),this.atuiMessageEdit=n(this,"atuiMessageEdit",7),this.atuiMessageVote=n(this,"atuiMessageVote",7),this.messages=[],this.loading=!1,this.auto_scroll=!0,this.chatbot_title="Assistant",this.enable_vote=!0,this.enable_copy=!0,this.enable_edit=!1}componentDidUpdate(){this.auto_scroll&&this.scrollContainer&&this.scrollToBottom()}scrollToBottom(){return o(this,null,function*(){return new Promise(e=>{requestAnimationFrame(()=>{this.scrollContainer&&this.scrollContainer.scrollTo({top:this.scrollContainer.scrollHeight,behavior:"smooth"}),e()})})})}scrollLastMessageToTop(){return o(this,null,function*(){return new Promise(e=>{requestAnimationFrame(()=>{if(!this.scrollContainer){e();return}let t=this.scrollContainer.querySelectorAll('[data-role="user"]');if(!t.length){e();return}t[t.length-1].scrollIntoView({behavior:"smooth",block:"start"}),e()})})})}handleVote(e){e.stopPropagation();let t=this.messages.findIndex(a=>a.id===e.detail.messageId);if(t!==-1){let a=[...this.messages];a[t]=Object.assign(Object.assign({},a[t]),{vote_status:e.detail.score}),this.messages=a,this.atuiMessageVote.emit(e.detail)}}handleMessageCopy(e){let t=this.getMessageIndexFromEvent(e);t!==-1&&this.atuiMessageCopy.emit({messageId:this.messages[t].id,content:e.detail})}handleMessageRetry(e){let t=this.getMessageIndexFromEvent(e);t!==-1&&this.atuiMessageRetry.emit({messageId:this.messages[t].id})}handleMessageEdit(e){let t=this.getMessageIndexFromEvent(e);t!==-1&&this.atuiMessageEdit.emit({messageId:this.messages[t].id,content:e.detail})}getMessageIndexFromEvent(e){let a=e.target.closest("[data-message-index]");return a?parseInt(a.dataset.messageIndex||"-1",10):-1}renderLoadingIndicator(){return this.loading?s("div",{class:"flex flex-col gap-16","data-name":"loading-container"},s("atui-prompt-message",{role:"assistant",content:"Typing...",name:this.chatbot_title,loading:!0,"data-name":"loading-message"})):null}renderMessage(e,t){let a=e.role==="system"?"assistant":e.role,i=e.role==="user"?e.name:e.name||this.chatbot_title;return s("atui-prompt-message",{role:a,content:e.content,name:i,loading:e.loading,error:e.error,error_message:e.error_message,vote_status:e.vote_status||c.None,message_id:e.id,enable_vote:this.enable_vote,enable_copy:this.enable_copy,enable_edit:this.enable_edit,"data-name":`message-${t}`,"data-message-index":t})}renderMessages(){return this.messages.map((e,t)=>this.renderMessage(e,t))}render(){let e=this.messages&&this.messages.length>0;return s(d,{key:"4ebdba767270a8f6ba4b2e4cb3dd5d7ecd895042",class:"block h-full","data-name":"thread-container"},s("div",{key:"23aa505f865b39b4ce78ba065d9730dd6c0a35c3",class:"flex h-full flex-col gap-16 overflow-y-auto scroll-smooth",ref:t=>this.scrollContainer=t,"data-name":"scroll-container"},e?s("div",{"data-name":"thread-messages-container",class:"flex flex-col gap-16"},this.renderMessages(),this.renderLoadingIndicator()):s("slot",{name:"thread-empty-state"}),s("slot",{key:"7f39a717637c1b87fa73a6b3840a0ad9bb914fe0",name:"thread-messages"})))}};export{v as atui_prompt_input,y as atui_prompt_thread};
