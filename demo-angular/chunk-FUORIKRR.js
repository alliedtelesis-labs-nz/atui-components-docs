import{a as l,b as u,c as d,d as p,e as c,f as g}from"./chunk-BQET5BRB.js";import{a as m,b as i,c as f,d as b,e as E}from"./chunk-MADVCF6R.js";import{h as e}from"./chunk-B7O3QC5Z.js";var w=class{constructor(t){m(this,t),this.atuiMenuStateChange=E(this,"atuiMenuStateChange",7),this.offset_x=0,this.offset_y=0,this.position="bottom",this.align="start",this.autoclose=!0,this.trigger="click",this.role="menu",this.disabled=!1,this.isOpen=!1,this.updatePosition=()=>e(this,null,function*(){this.triggerEl&&this.menuEl&&this.isOpen&&(yield this.updateFloatingPosition())})}disabledChanged(t){t&&this.isOpen&&this.closeMenu()}toggleMenu(){return e(this,null,function*(){this.disabled||(this.menuEl&&(this.menuEl.togglePopover(),this.isOpen=this.menuEl.matches(":popover-open")),this.atuiMenuStateChange.emit(this.isOpen),yield this.updatePosition())})}openMenu(){return e(this,null,function*(){this.disabled||(this.menuEl&&(this.menuEl.showPopover(),this.isOpen=!0),this.atuiMenuStateChange.emit(!0),yield this.updatePosition())})}closeMenu(){return e(this,null,function*(){this.menuEl&&(this.menuEl.hidePopover(),this.isOpen=!1),this.atuiMenuStateChange.emit(!1)})}getIsOpen(){return e(this,null,function*(){return this.isOpen})}componentDidLoad(){return e(this,null,function*(){this.popoverId=`atui-menu-${Math.random().toString(36).substr(2,9)}`,yield this.setupFloatingUI(),setTimeout(()=>this.setupPopoverEventListeners(),0)})}setupPopoverEventListeners(){this.menuEl&&this.menuEl.addEventListener("toggle",t=>{let s=t;this.isOpen=s.newState==="open",this.atuiMenuStateChange.emit(this.isOpen),this.isOpen&&requestAnimationFrame(()=>this.updatePosition())})}disconnectedCallback(){this.cleanupFloatingUI()}mouseEnterHandler(){return e(this,null,function*(){this.timedOutCloser&&clearTimeout(this.timedOutCloser),this.isOpen||(yield this.openMenu())})}mouseLeaveHandler(){return e(this,null,function*(){yield this.closeMenu()})}setupFloatingUI(){return e(this,null,function*(){if(this.cleanupAutoUpdate&&this.cleanupAutoUpdate(),this.triggerEl&&this.menuEl){let t=new IntersectionObserver(a=>{!a[0].isIntersecting&&this.isOpen&&this.mouseLeaveHandler()},{threshold:0});t.observe(this.triggerEl),this.cleanupAutoUpdate=l(this.triggerEl,this.menuEl,()=>{if(this.isOpen){let a=this.getFloatingUIPlacement(),n="fixed";g(this.triggerEl,this.menuEl,{placement:a,strategy:n,middleware:[u(this.position==="bottom"||this.position==="top"?this.offset_y:this.offset_x),p({fallbackStrategy:"bestFit",padding:8}),d({padding:8,mainAxis:!0,crossAxis:!0}),c({apply({availableWidth:r,availableHeight:h,elements:o}){Object.assign(o.floating.style,{maxWidth:`${r}px`,maxHeight:`${h}px`})}})]}).then(({x:r,y:h})=>{let o={position:n,left:`${r}px`,top:`${h}px`,margin:"0",transform:"none"};this.width&&(o.width=this.width),Object.assign(this.menuEl.style,o)})}},{ancestorScroll:!0,ancestorResize:!0,elementResize:!0,layoutShift:!0,animationFrame:!0});let s=this.cleanupAutoUpdate;this.cleanupAutoUpdate=()=>{s(),t.disconnect()}}})}cleanupFloatingUI(){this.cleanupAutoUpdate&&(this.cleanupAutoUpdate(),this.cleanupAutoUpdate=void 0)}updateFloatingPosition(){return e(this,null,function*(){!this.triggerEl||!this.menuEl||(yield this.setupFloatingUI())})}getFloatingUIPlacement(){let t={top:"top",bottom:"bottom",left:"left",right:"right"},s={start:"start",end:"end"},a=t[this.position]||"bottom",n=s[this.align]||"start";return`${a}-${n}`}render(){return i(f,{key:"0ccc40e271fd4a14df7653ffd3b74645573589c8",class:"relative z-modal"},i("div",{key:"fcb61f0ffe05715d172148d4654f517487bb1c1c",class:"relative",onBlur:()=>this.trigger==="click"&&!this.disabled?this.mouseLeaveHandler():null},i("div",{key:"c3c7f3fbd692af418a01b60c8098625bd2addaae","aria-haspopup":"true","data-name":"menu-trigger",ref:t=>this.triggerEl=t,"aria-expanded":`${this.isOpen?"true":"false"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled?this.mouseEnterHandler():null,onKeyDown:t=>e(this,null,function*(){switch(t.key){case"Escape":yield this.closeMenu();break;case"Enter":case" ":t.preventDefault(),yield this.toggleMenu();break}}),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled?this.mouseLeaveHandler():null,onClick:t=>e(this,null,function*(){this.trigger==="click"&&!this.disabled&&(t.preventDefault(),t.stopPropagation(),this.isOpen?yield this.closeMenu():yield this.openMenu())}),class:this.disabled?"contents":""},i("slot",{key:"0a898fb587915acb5f2838767a035aaaee6da384",name:"menu-trigger"})),i("div",{key:"34440c8dc0ea4ef501b2b70a96234bdfcd207b0d",role:this.role,"data-position":this.position,"data-align":this.align,ref:t=>this.menuEl=t,"aria-hidden":`${this.isOpen?"false":"true"}`,popover:"auto",id:this.popoverId,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:t=>e(this,null,function*(){(t.key==="Enter"||t.key===" "||t.key==="Escape")&&this.autoclose&&(yield this.mouseLeaveHandler())}),onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:"w-fit rounded-md bg-white p-4 shadow-md","data-name":"menu-content-wrapper"},i("slot",{key:"179740be7f893b123e430b0b11469d24600a4a42",name:"menu-content"}))))}get el(){return b(this)}static get watchers(){return{disabled:["disabledChanged"]}}};export{w as atui_menu};
