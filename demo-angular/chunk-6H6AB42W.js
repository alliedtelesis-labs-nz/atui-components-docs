import{a as l,b as u,c as d,d as g,e as p,f as c}from"./chunk-BQET5BRB.js";import{a as f,b as r,c as m,d as E,e as b}from"./chunk-OYGHDCNF.js";import{h as t}from"./chunk-B7O3QC5Z.js";var w=class{constructor(e){f(this,e),this.atuiMenuStateChange=b(this,"atuiMenuStateChange",7),this.offset_x=0,this.offset_y=0,this.position="bottom",this.align="start",this.autoclose=!0,this.trigger="click",this.role="menu",this.disabled=!1,this.isOpen=!1,this.triggerEls=[],this.updatePosition=()=>t(this,null,function*(){this.triggerEl&&this.menuEl&&this.isOpen&&(yield this.updateFloatingPosition())}),this.externalTriggerListeners=[]}disabledChanged(e){e&&this.isOpen&&this.closeMenu()}toggleMenu(){return t(this,null,function*(){this.disabled||(this.menuEl&&(this.menuEl.togglePopover(),this.isOpen=this.menuEl.matches(":popover-open")),this.atuiMenuStateChange.emit(this.isOpen),yield this.updatePosition(),this.updateAriaExpanded())})}openMenu(){return t(this,null,function*(){this.disabled||(this.menuEl&&(this.menuEl.showPopover(),this.isOpen=!0),this.atuiMenuStateChange.emit(!0),yield this.updatePosition(),this.updateAriaExpanded())})}closeMenu(){return t(this,null,function*(){this.menuEl&&(this.menuEl.hidePopover(),this.isOpen=!1),this.atuiMenuStateChange.emit(!1),this.updateAriaExpanded()})}updateAriaExpanded(){this.trigger_id&&this.triggerEl&&this.triggerEl.setAttribute("aria-expanded",this.isOpen?"true":"false")}getIsOpen(){return t(this,null,function*(){return this.isOpen})}componentDidLoad(){return t(this,null,function*(){if(this.popoverId=`atui-menu-${Math.random().toString(36).substr(2,9)}`,this.trigger_id){if(this.triggerEls=Array.from(document.querySelectorAll(`[data-id="${this.trigger_id}"]`)),this.triggerEls.length===0){console.warn(`atui-menu: No elements found with data-id="${this.trigger_id}"`);return}}else this.triggerEl=this.el.querySelector('[data-name="menu-trigger"]');yield this.setupFloatingUI(),setTimeout(()=>this.setupPopoverEventListeners(),0),this.trigger_id&&this.triggerEls.length&&this.setupExternalTriggerListeners()})}setupPopoverEventListeners(){this.menuEl&&this.menuEl.addEventListener("toggle",e=>{let s=e;this.isOpen=s.newState==="open",this.atuiMenuStateChange.emit(this.isOpen),this.isOpen&&requestAnimationFrame(()=>this.updatePosition())})}setupExternalTriggerListeners(){!this.triggerEls||this.triggerEls.length===0||this.triggerEls.forEach(e=>{let s=[];if(this.trigger==="hover"){let i=()=>{this.disabled||(this.triggerEl=e,this.mouseEnterHandler())},a=()=>{this.disabled||(this.triggerEl=e,this.mouseLeaveHandler())};s.push({event:"mouseenter",handler:i},{event:"mouseleave",handler:a})}if(this.trigger==="click"){let i=a=>t(this,null,function*(){this.disabled||(a.preventDefault(),a.stopPropagation(),this.triggerEl=e,this.isOpen?yield this.closeMenu():yield this.openMenu())});s.push({event:"click",handler:i})}let n=i=>t(this,null,function*(){if(!this.disabled)switch(this.triggerEl=e,i.key){case"Escape":yield this.closeMenu();break;case"Enter":case" ":i.preventDefault(),yield this.toggleMenu();break}});s.push({event:"keydown",handler:n}),s.forEach(({event:i,handler:a})=>{e.addEventListener(i,a),this.externalTriggerListeners.push({element:e,event:i,handler:a})}),e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-expanded","false")})}disconnectedCallback(){this.cleanupFloatingUI(),this.cleanupExternalTriggerListeners()}cleanupExternalTriggerListeners(){this.externalTriggerListeners.forEach(({element:e,event:s,handler:n})=>{e.removeEventListener(s,n)}),this.externalTriggerListeners=[]}mouseEnterHandler(){return t(this,null,function*(){this.timedOutCloser&&clearTimeout(this.timedOutCloser),this.isOpen||(yield this.openMenu())})}mouseLeaveHandler(){return t(this,null,function*(){yield this.closeMenu()})}setupFloatingUI(){return t(this,null,function*(){if(this.cleanupAutoUpdate&&this.cleanupAutoUpdate(),this.triggerEl&&this.menuEl){let e=new IntersectionObserver(n=>{!n[0].isIntersecting&&this.isOpen&&this.mouseLeaveHandler()},{threshold:0});e.observe(this.triggerEl),this.cleanupAutoUpdate=l(this.triggerEl,this.menuEl,()=>{if(this.isOpen){let n=this.getFloatingUIPlacement(),i="fixed";c(this.triggerEl,this.menuEl,{placement:n,strategy:i,middleware:[u(this.position==="bottom"||this.position==="top"?this.offset_y:this.offset_x),g({fallbackStrategy:"bestFit",padding:8}),d({padding:8,mainAxis:!0,crossAxis:!0}),p({apply({availableWidth:a,availableHeight:h,elements:o}){Object.assign(o.floating.style,{maxWidth:`${a}px`,maxHeight:`${h}px`})}})]}).then(({x:a,y:h})=>{let o={position:i,left:`${a}px`,top:`${h}px`,margin:"0",transform:"none"};this.width&&(o.width=this.width),Object.assign(this.menuEl.style,o)})}},{ancestorScroll:!0,ancestorResize:!0,elementResize:!0,layoutShift:!0,animationFrame:!0});let s=this.cleanupAutoUpdate;this.cleanupAutoUpdate=()=>{s(),e.disconnect()}}})}cleanupFloatingUI(){this.cleanupAutoUpdate&&(this.cleanupAutoUpdate(),this.cleanupAutoUpdate=void 0)}updateFloatingPosition(){return t(this,null,function*(){!this.triggerEl||!this.menuEl||(yield this.setupFloatingUI())})}getFloatingUIPlacement(){let e={top:"top",bottom:"bottom",left:"left",right:"right"},s={start:"start",end:"end"},n=e[this.position]||"bottom",i=s[this.align]||"start";return`${n}-${i}`}render(){return r(m,{key:"ed4ba146ec1573c03321a7a953e728f187c52ae9",class:"z-modal relative"},r("div",{key:"ef6afe909b65031db18630ffc261f04e8f14b7bf",class:"relative",onBlur:()=>this.trigger==="click"&&!this.disabled?this.mouseLeaveHandler():null},!this.trigger_id&&r("div",{key:"60f8046051e3ee2cf2f29cdb9466f2b7961122d0","aria-haspopup":"true","data-name":"menu-trigger",ref:e=>this.triggerEl=e,"aria-expanded":`${this.isOpen?"true":"false"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled?this.mouseEnterHandler():null,onKeyDown:e=>t(this,null,function*(){switch(e.key){case"Escape":yield this.closeMenu();break;case"Enter":case" ":e.preventDefault(),yield this.toggleMenu();break}}),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled?this.mouseLeaveHandler():null,onClick:e=>t(this,null,function*(){this.trigger==="click"&&!this.disabled&&(e.preventDefault(),e.stopPropagation(),this.isOpen?yield this.closeMenu():yield this.openMenu())}),class:this.disabled?"contents":""},r("slot",{key:"9d4c2a003bce41631d5a4048492e37c6e7cfb6d1",name:"menu-trigger"})),r("div",{key:"fee26237ddee3aa478228196bee21592a087dd6b",role:this.role,"data-position":this.position,"data-align":this.align,ref:e=>this.menuEl=e,"aria-hidden":`${this.isOpen?"false":"true"}`,popover:"auto",id:this.popoverId,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:e=>t(this,null,function*(){(e.key==="Enter"||e.key===" "||e.key==="Escape")&&this.autoclose&&(yield this.mouseLeaveHandler())}),onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:"w-fit rounded-md bg-white p-4 shadow-md","data-name":"menu-content-wrapper"},r("slot",{key:"0fb0d453f16a42d0c7458eca80f931f8bf71a574"}))))}get el(){return E(this)}static get watchers(){return{disabled:["disabledChanged"]}}};export{w as atui_menu};
