import{r as t,c as e,g as s,h as i,H as a}from"./p-jvbUuQtg.js";import{f as h}from"./p-DuLooPsr.js";var n;!function(t){t[t.ASC=1]="ASC",t[t.DESC=-1]="DESC"}(n||(n={}));const l=class{constructor(s){t(this,s),this.atSearchParamsChange=e(this,"atSearchParamsChange",7)}table_data;label;search_label;search_hint;search_info_tooltip;col_defs=[];page_size=10;hide_dropdown_filters;hide_column_manager;hide_export_menu;use_custom_pagination=!1;auto_size_columns=!0;server_side_mode=!1;loading=!1;atSearchParamsChange;get el(){return s(this)}translations;agGrid;tableCreated=!1;activeFilters={};selectedFilters=[];menuSelectedIds=[];searchValue="";tableEl;get shouldShowDropdownFilters(){return!this.hide_dropdown_filters&&this.col_defs&&this.col_defs.length>0}get shouldShowColumnManager(){return!this.hide_column_manager&&this.col_defs&&this.col_defs.length>0}handleSelectedFiltersChange(t){this.menuSelectedIds=t.map((t=>t.id))}async componentWillLoad(){this.translations=await h(this.el)}async componentDidLoad(){await this.initGrid(),this.server_side_mode&&this.agGrid&&this.emitSearchParamsChange()}async componentDidUpdate(){this.tableCreated||await this.initGrid()}async updateRowByIndex(t,e){const s=this.agGrid.getRenderedNodes();t.forEach((({index:t,update:i})=>{const a=s.find((e=>e.rowIndex===t));a&&(a.updateData(i),e?.flash&&this.agGrid.flashCells({rowNodes:[a]}),this.agGrid.refreshCells({rowNodes:[a],force:e?.forceRefresh||!1}))}))}async getDisplayedRows(){return this.agGrid.getRenderedNodes()}async initGrid(){this.col_defs&&!this.tableCreated&&this.tableEl&&(this.agGrid=await this.tableEl.createGrid(),this.tableCreated=!0,this.setupExternalFilters(),this.table_data?.items&&this.agGrid.setGridOption("rowData",this.table_data.items))}setupExternalFilters(){this.agGrid&&(this.server_side_mode||(this.agGrid.setGridOption("isExternalFilterPresent",(()=>Object.keys(this.activeFilters).length>0)),this.agGrid.setGridOption("doesExternalFilterPass",(t=>{if(!t.data)return!0;const e=this.activeFilters.__search__;if(e){const s=e.toLowerCase();if(!this.col_defs.some((e=>{let i;return e.valueGetter&&"function"==typeof e.valueGetter?i=e.valueGetter({data:t.data,node:t,colDef:e,api:this.agGrid,context:null,getValue:e=>t.data[e],column:null}):e.field&&(i=t.data[e.field]),i&&String(i).toLowerCase().includes(s)})))return!1}return Object.entries(this.activeFilters).every((([e,s])=>{if("__search__"===e||!s)return!0;const i=this.col_defs.find((t=>t.field===e));let a;return a=i&&i.valueGetter&&"function"==typeof i.valueGetter?i.valueGetter({data:t.data,node:t,colDef:i,api:this.agGrid,context:null,getValue:e=>t.data[e],column:null}):t.data[e],a&&String(a).toLowerCase().includes(String(s).toLowerCase())}))}))))}handleColumnChange(t){const{id:e,checked:s}=t.detail,i=this.col_defs.map((t=>t.field===e?{...t,hide:!s}:t));this.col_defs=i}handleFilterChange(t){if(!t.detail||Array.isArray(t.detail)&&0===t.detail.length)return this.selectedFilters=[],this.menuSelectedIds=[],void this.updateActiveFilters();Array.isArray(t.detail)&&("string"==typeof t.detail[0]?this.handleMenuFilterChange(t.detail):"object"==typeof t.detail[0]&&this.handleFilterListChange(t.detail)),this.updateActiveFilters()}handleMenuFilterChange(t){this.selectedFilters=t.map((t=>({id:t,value:""}))),this.menuSelectedIds=t}handleFilterListChange(t){!t.length||1===t.length&&""===t[0].id?(this.selectedFilters=[],this.menuSelectedIds=[]):(this.selectedFilters=t,this.menuSelectedIds=t.map((t=>t.id)))}updateActiveFilters(){const t=this.activeFilters.__search__;this.activeFilters={},t&&(this.activeFilters.__search__=t),this.selectedFilters.forEach((t=>{t.value&&(this.activeFilters[t.id]=t.value)})),this.searchValue&&(this.activeFilters.__search__=this.searchValue),this.server_side_mode?this.emitSearchParamsChange():this.agGrid?(this.setupExternalFilters(),this.agGrid.onFilterChanged()):console.log("agGrid not available, cannot apply filter")}handleSearchChange(t){this.searchValue=t.detail||"",this.searchValue?this.activeFilters.__search__=this.searchValue:delete this.activeFilters.__search__,this.updateActiveFilters()}emitSearchParamsChange(){if(!this.agGrid)return;const t=this.agGrid.paginationGetCurrentPage(),e=this.agGrid.paginationGetPageSize(),s=t*e,i=(t+1)*e,a=this.agGrid.getColumnState().find((t=>null!=t.sort));this.atSearchParamsChange.emit({fieldFilters:this.activeFilters,startRow:s,endRow:i,sort:a?.colId,direction:"asc"===a?.sort?n.ASC:n.DESC})}render(){return i(a,{key:"f6c9f97b34fd66623d6243ca47b09484a9082bc4"},i("at-table-actions",{key:"5ee5f0081e0d6602be9b41e99880d846d9048a12",ag_grid:this.agGrid},i("div",{key:"7070e461798b4fa95bec2ee916332bb905be358a",class:"flex items-center gap-8",slot:"search"},this.shouldShowDropdownFilters&&i("at-table-filter-menu",{key:"8af6fef97ea9ce28dd65b68374771484e0c5bd7a",slot:"filter-menu",col_defs:this.col_defs,selected:this.menuSelectedIds,onAtChange:t=>this.handleFilterChange(t)}),i("at-search",{key:"ced4b9d4b764d5f5f3a6cca7d474cd7a08c1994c",class:"w-input-md",label:this.search_label,hint_text:this.search_hint,info_text:this.search_info_tooltip,placeholder:this.translations.ATUI.TABLE.SEARCH_BY_KEYWORD,onAtChange:t=>this.handleSearchChange(t)})),this.shouldShowDropdownFilters&&i("at-table-filters",{key:"24c6df40d1cab769ee6a54ec65c96a59bf02de05",slot:"filters",col_defs:this.col_defs,selected:this.selectedFilters,onAtChange:t=>this.handleFilterChange(t)}),!this.hide_export_menu&&i("at-table-export-menu",{key:"4f52111936c7d280af820611d8c05161de7bc4f3",slot:"export-menu"}),this.shouldShowColumnManager&&i("at-column-manager",{key:"089417e81d8d7c22824d3659b4a43ceb0f9259ed",slot:"column-manager",col_defs:this.col_defs,onAtChange:t=>this.handleColumnChange(t)}),i("div",{key:"0ac4162eac861ca679e04e86f262247ec25a9bb9",slot:"actions"},i("slot",{key:"d48d5b61bf5f6730edd84ee402c9354aa98f14be",name:"actions"}))),i("slot",{key:"d9b7f6eb73f254641a5e4c277585ea0130b5e37d",name:"multi-select-actions"}),this.loading&&this.server_side_mode?i("at-placeholder",{size:"lg",placeholder_title:this.translations?.ATUI?.TABLE?.LOADING_DATA,show_loading_spinner:!0}):i("at-table",{ref:t=>this.tableEl=t,table_data:this.table_data,col_defs:this.col_defs,page_size:this.page_size,use_custom_pagination:this.use_custom_pagination,auto_size_columns:this.auto_size_columns,disable_auto_init:!this.server_side_mode}))}static get watchers(){return{selectedFilters:[{handleSelectedFiltersChange:0}]}}};export{l as at_search_table}