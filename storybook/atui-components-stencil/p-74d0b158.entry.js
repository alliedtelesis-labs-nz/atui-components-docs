import{r as t,c as i,g as e,h as s,H as a}from"./p-EP34iaAr.js";import{a as h,c as n,o as r,f as o,s as c,b as l}from"./p-BO6p966C.js";const d=class{constructor(e){t(this,e);this.atuiMenuStateChange=i(this,"atuiMenuStateChange",7)}offset_x=0;offset_y=0;position="bottom";align="start";width="fit-content";autoclose=true;trigger="click";role="menu";disabled=false;trigger_id;disabledChanged(t){if(t&&this.isOpen){this.closeMenu()}}isOpen=false;triggerEl;menuEl;triggerEls=[];popoverId;cleanupAutoUpdate;updatePosition=async()=>{if(this.triggerEl&&this.menuEl&&this.isOpen){await this.updateFloatingPosition()}};get el(){return e(this)}async toggleMenu(){if(this.disabled){return}if(this.menuEl){this.menuEl.togglePopover();this.isOpen=this.menuEl.matches(":popover-open")}this.atuiMenuStateChange.emit(this.isOpen);await this.updatePosition();this.updateAriaExpanded()}async openMenu(){if(this.disabled){return}if(this.menuEl){this.menuEl.showPopover();this.isOpen=true}this.atuiMenuStateChange.emit(true);await this.updatePosition();this.updateAriaExpanded()}async closeMenu(){if(this.menuEl){this.menuEl.hidePopover();this.isOpen=false}this.atuiMenuStateChange.emit(false);this.updateAriaExpanded()}updateAriaExpanded(){if(this.trigger_id&&this.triggerEl){this.triggerEl.setAttribute("aria-expanded",this.isOpen?"true":"false")}}async getIsOpen(){return this.isOpen}atuiMenuStateChange;timedOutCloser;async componentDidLoad(){this.popoverId=`atui-menu-${Math.random().toString(36).substr(2,9)}`;if(this.trigger_id){this.triggerEls=Array.from(document.querySelectorAll(`[data-menu="${this.trigger_id}"]`));if(this.triggerEls.length===0){console.warn(`atui-menu: No elements found with data-menu="${this.trigger_id}"`);return}}else{this.triggerEl=this.el.querySelector('[data-name="menu-trigger"]')}await this.setupFloatingUI();setTimeout((()=>this.setupPopoverEventListeners()),0);if(this.trigger_id&&this.triggerEls.length){this.setupExternalTriggerListeners()}}setupPopoverEventListeners(){if(this.menuEl){this.menuEl.addEventListener("toggle",(t=>{const i=t;this.isOpen=i.newState==="open";this.atuiMenuStateChange.emit(this.isOpen);if(this.isOpen){requestAnimationFrame((()=>this.updatePosition()))}}))}}setupExternalTriggerListeners(){if(!this.triggerEls||this.triggerEls.length===0)return;this.triggerEls.forEach((t=>{const i=[];if(this.trigger==="hover"){const e=()=>{if(!this.disabled){this.triggerEl=t;this.mouseEnterHandler()}};const s=()=>{if(!this.disabled){this.triggerEl=t;this.mouseLeaveHandler()}};i.push({event:"mouseenter",handler:e},{event:"mouseleave",handler:s})}if(this.trigger==="click"){const e=async i=>{if(!this.disabled){i.preventDefault();i.stopPropagation();this.triggerEl=t;if(this.isOpen){await this.closeMenu()}else{await this.openMenu()}}};i.push({event:"click",handler:e})}const e=async i=>{if(!this.disabled){this.triggerEl=t;switch(i.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":i.preventDefault();await this.toggleMenu();break}}};i.push({event:"keydown",handler:e});i.forEach((({event:i,handler:e})=>{t.addEventListener(i,e);this.externalTriggerListeners.push({element:t,event:i,handler:e})}));t.setAttribute("aria-haspopup","true");t.setAttribute("aria-expanded","false")}))}disconnectedCallback(){this.cleanupFloatingUI();this.cleanupExternalTriggerListeners()}externalTriggerListeners=[];cleanupExternalTriggerListeners(){this.externalTriggerListeners.forEach((({element:t,event:i,handler:e})=>{t.removeEventListener(i,e)}));this.externalTriggerListeners=[]}async mouseEnterHandler(){if(this.timedOutCloser)clearTimeout(this.timedOutCloser);if(!this.isOpen){await this.openMenu()}}async mouseLeaveHandler(){await this.closeMenu()}async setupFloatingUI(){if(this.cleanupAutoUpdate){this.cleanupAutoUpdate()}if(this.triggerEl&&this.menuEl){const t=new IntersectionObserver((t=>{if(!t[0].isIntersecting&&this.isOpen){this.mouseLeaveHandler()}}),{threshold:0});t.observe(this.triggerEl);this.cleanupAutoUpdate=h(this.triggerEl,this.menuEl,(()=>{if(this.isOpen){const t=this.getFloatingUIPlacement();const i="fixed";n(this.triggerEl,this.menuEl,{placement:t,strategy:i,middleware:[r(this.position==="bottom"||this.position==="top"?this.offset_y:this.offset_x),o({fallbackStrategy:"bestFit",padding:8}),c({padding:8,mainAxis:true,crossAxis:true}),l({apply({availableWidth:t,availableHeight:i,elements:e}){Object.assign(e.floating.style,{maxWidth:`${t}px`,maxHeight:`${i}px`})}})]}).then((({x:t,y:e})=>{const s={position:i,left:`${t}px`,top:`${e}px`,margin:"0",transform:"none"};if(this.width){s.width=this.width}Object.assign(this.menuEl.style,s)}))}}),{ancestorScroll:true,ancestorResize:true,elementResize:true,layoutShift:true,animationFrame:true});const i=this.cleanupAutoUpdate;this.cleanupAutoUpdate=()=>{i();t.disconnect()}}}cleanupFloatingUI(){if(this.cleanupAutoUpdate){this.cleanupAutoUpdate();this.cleanupAutoUpdate=undefined}}async updateFloatingPosition(){if(!this.triggerEl||!this.menuEl)return;await this.setupFloatingUI()}getFloatingUIPlacement(){const t={top:"top",bottom:"bottom",left:"left",right:"right"};const i={start:"start",end:"end"};const e=t[this.position]||"bottom";const s=i[this.align]||"start";return`${e}-${s}`}render(){return s(a,{key:"5d627c8e2588ba8ca54ed3d57a42064e1fe46fb1",class:"relative",onBlur:()=>this.trigger==="click"&&!this.disabled?this.mouseLeaveHandler():null},!this.trigger_id&&s("div",{key:"0ec4f5a478f77018739da1a3570aa0a34f3cbce8","aria-haspopup":"true","data-name":"menu-trigger",ref:t=>this.triggerEl=t,"aria-expanded":`${this.isOpen?"true":"false"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled?this.mouseEnterHandler():null,onKeyDown:async t=>{switch(t.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":t.preventDefault();await this.toggleMenu();break}},onMouseLeave:()=>this.trigger==="hover"&&!this.disabled?this.mouseLeaveHandler():null,onClick:async t=>{if(this.trigger==="click"&&!this.disabled){t.preventDefault();t.stopPropagation();if(this.isOpen){await this.closeMenu()}else{await this.openMenu()}}},class:this.disabled?"contents":""},s("slot",{key:"d9c5de4430a051d1ae4d4757d192fc5a0294dfb9",name:"menu-trigger"})),s("div",{key:"2593fc5f68ba9ccd580c989378965eb9eafef15e",role:this.role,"data-position":this.position,"data-align":this.align,ref:t=>this.menuEl=t,"aria-hidden":`${this.isOpen?"false":"true"}`,popover:"auto",id:this.popoverId,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:async t=>{if(t.key==="Enter"||t.key===" "||t.key==="Escape"){if(this.autoclose){await this.mouseLeaveHandler()}}},onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:`w-fit rounded-md bg-white p-4 shadow-md transition-opacity duration-150 ${this.isOpen?"opacity-100":"opacity-0"}`,"data-name":"menu-content-wrapper"},s("slot",{key:"d4f45bfc1f3648cb036279f117e292dbe5d16eef"})))}static get watchers(){return{disabled:["disabledChanged"]}}};export{d as at_menu};
//# sourceMappingURL=p-74d0b158.entry.js.map