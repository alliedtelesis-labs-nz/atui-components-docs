import{r as t,c as i,g as s,h as e,H as a}from"./p-jvbUuQtg.js";import{a as h,c as n,o,f as r,s as c,b as l}from"./p-BO6p966C.js";const d=class{constructor(s){t(this,s),this.atuiMenuStateChange=i(this,"atuiMenuStateChange",7)}offset_x=0;offset_y=0;position="bottom";align="start";width="fit-content";autoclose=!0;trigger="click";role="menu";disabled=!1;trigger_id;disabledChanged(t){t&&this.isOpen&&this.closeMenu()}isOpen=!1;triggerEl;menuEl;triggerEls=[];popoverId;cleanupAutoUpdate;updatePosition=async()=>{this.triggerEl&&this.menuEl&&this.isOpen&&await this.updateFloatingPosition()};get el(){return s(this)}async toggleMenu(){this.disabled||(this.menuEl&&(this.menuEl.togglePopover(),this.isOpen=this.menuEl.matches(":popover-open")),this.atuiMenuStateChange.emit(this.isOpen),await this.updatePosition(),this.updateAriaExpanded())}async openMenu(){this.disabled||(this.menuEl&&(this.menuEl.showPopover(),this.isOpen=!0),this.atuiMenuStateChange.emit(!0),await this.updatePosition(),this.updateAriaExpanded())}async closeMenu(){this.menuEl&&(this.menuEl.hidePopover(),this.isOpen=!1),this.atuiMenuStateChange.emit(!1),this.updateAriaExpanded()}updateAriaExpanded(){this.trigger_id&&this.triggerEl&&this.triggerEl.setAttribute("aria-expanded",this.isOpen?"true":"false")}async getIsOpen(){return this.isOpen}atuiMenuStateChange;timedOutCloser;async componentDidLoad(){if(this.popoverId=`atui-menu-${Math.random().toString(36).substr(2,9)}`,this.trigger_id){if(this.triggerEls=Array.from(document.querySelectorAll(`[data-menu="${this.trigger_id}"]`)),0===this.triggerEls.length)return void console.warn(`atui-menu: No elements found with data-menu="${this.trigger_id}"`)}else this.triggerEl=this.el.querySelector('[data-name="menu-trigger"]');await this.setupFloatingUI(),setTimeout((()=>this.setupPopoverEventListeners()),0),this.trigger_id&&this.triggerEls.length&&this.setupExternalTriggerListeners()}setupPopoverEventListeners(){this.menuEl&&this.menuEl.addEventListener("toggle",(t=>{this.isOpen="open"===t.newState,this.atuiMenuStateChange.emit(this.isOpen),this.isOpen&&requestAnimationFrame((()=>this.updatePosition()))}))}setupExternalTriggerListeners(){this.triggerEls&&0!==this.triggerEls.length&&this.triggerEls.forEach((t=>{const i=[];"hover"===this.trigger&&i.push({event:"mouseenter",handler:()=>{this.disabled||(this.triggerEl=t,this.mouseEnterHandler())}},{event:"mouseleave",handler:()=>{this.disabled||(this.triggerEl=t,this.mouseLeaveHandler())}}),"click"===this.trigger&&i.push({event:"click",handler:async i=>{this.disabled||(i.preventDefault(),i.stopPropagation(),this.triggerEl=t,this.isOpen?await this.closeMenu():await this.openMenu())}}),i.push({event:"keydown",handler:async i=>{if(!this.disabled)switch(this.triggerEl=t,i.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":i.preventDefault(),await this.toggleMenu()}}}),i.forEach((({event:i,handler:s})=>{t.addEventListener(i,s),this.externalTriggerListeners.push({element:t,event:i,handler:s})})),t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded","false")}))}disconnectedCallback(){this.cleanupFloatingUI(),this.cleanupExternalTriggerListeners()}externalTriggerListeners=[];cleanupExternalTriggerListeners(){this.externalTriggerListeners.forEach((({element:t,event:i,handler:s})=>{t.removeEventListener(i,s)})),this.externalTriggerListeners=[]}async mouseEnterHandler(){this.timedOutCloser&&clearTimeout(this.timedOutCloser),this.isOpen||await this.openMenu()}async mouseLeaveHandler(){await this.closeMenu()}async setupFloatingUI(){if(this.cleanupAutoUpdate&&this.cleanupAutoUpdate(),this.triggerEl&&this.menuEl){const t=new IntersectionObserver((t=>{!t[0].isIntersecting&&this.isOpen&&this.mouseLeaveHandler()}),{threshold:0});t.observe(this.triggerEl),this.cleanupAutoUpdate=h(this.triggerEl,this.menuEl,(()=>{if(this.isOpen){const t=this.getFloatingUIPlacement(),i="fixed";n(this.triggerEl,this.menuEl,{placement:t,strategy:i,middleware:[o("bottom"===this.position||"top"===this.position?this.offset_y:this.offset_x),r({fallbackStrategy:"bestFit",padding:8}),c({padding:8,mainAxis:!0,crossAxis:!0}),l({apply({availableWidth:t,availableHeight:i,rects:s,elements:e}){Object.assign(e.floating.style,{width:`${s.reference.width}px`,maxWidth:`${t}px`,maxHeight:`${i}px`,minWidth:0})}})]}).then((({x:t,y:s})=>{const e={position:i,left:`${t}px`,top:`${s}px`,margin:"0",transform:"none"};this.width&&(e.width=this.width),Object.assign(this.menuEl.style,e)}))}}),{ancestorScroll:!0,ancestorResize:!0,elementResize:!0,layoutShift:!0,animationFrame:!0});const i=this.cleanupAutoUpdate;this.cleanupAutoUpdate=()=>{i(),t.disconnect()}}}cleanupFloatingUI(){this.cleanupAutoUpdate&&(this.cleanupAutoUpdate(),this.cleanupAutoUpdate=void 0)}async updateFloatingPosition(){this.triggerEl&&this.menuEl&&await this.setupFloatingUI()}getFloatingUIPlacement(){return`${{top:"top",bottom:"bottom",left:"left",right:"right"}[this.position]||"bottom"}-${{start:"start",end:"end"}[this.align]||"start"}`}render(){return e(a,{key:"ef1d8743a7aeb9afb6fcc8ef618e718b104d3808",class:"relative",onBlur:()=>"click"!==this.trigger||this.disabled?null:this.mouseLeaveHandler()},!this.trigger_id&&e("div",{key:"3be01a1ffb8a083ad307ff702b5e84bccd4e3aca","aria-haspopup":"true","data-name":"menu-trigger",ref:t=>this.triggerEl=t,"aria-expanded":this.isOpen?"true":"false",onMouseEnter:()=>"hover"!==this.trigger||this.disabled?null:this.mouseEnterHandler(),onKeyDown:async t=>{switch(t.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":t.preventDefault(),await this.toggleMenu()}},onMouseLeave:()=>"hover"!==this.trigger||this.disabled?null:this.mouseLeaveHandler(),onClick:async t=>{"click"!==this.trigger||this.disabled||(t.preventDefault(),t.stopPropagation(),this.isOpen?await this.closeMenu():await this.openMenu())},class:this.disabled?"contents":""},e("slot",{key:"0ca41308091b78b976545a20639fcf0f6a362eac",name:"menu-trigger"})),e("div",{key:"3d01250e588c0331869e143a2c639025058605c9",role:this.role,"data-position":this.position,"data-align":this.align,ref:t=>this.menuEl=t,"aria-hidden":this.isOpen?"false":"true",popover:"auto",id:this.popoverId,onMouseEnter:()=>"hover"===this.trigger&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>"hover"===this.trigger&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:async t=>{"Enter"!==t.key&&" "!==t.key&&"Escape"!==t.key||this.autoclose&&await this.mouseLeaveHandler()},onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:"w-max min-w-0 flex-none rounded-md bg-white p-4 shadow-md transition-opacity duration-150 "+(this.isOpen?"opacity-100":"opacity-0"),"data-name":"menu-content-wrapper"},e("slot",{key:"8cd38e0b5e3f5956ca78011a75a363139806a190"})))}static get watchers(){return{disabled:[{disabledChanged:0}]}}};export{d as at_menu}