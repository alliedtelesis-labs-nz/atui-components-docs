import{r as t,c as s,h as i,H as e,g as a}from"./p-D3rwhcmG.js";import{a as h,c as n,o,f as r,s as c,b as l}from"./p-CQbxAaEb.js";const d=class{constructor(i){t(this,i);this.atuiMenuStateChange=s(this,"atuiMenuStateChange",7);this.offset_x=0;this.offset_y=0;this.position="bottom";this.align="start";this.autoclose=true;this.trigger="click";this.role="menu";this.disabled=false;this.isOpen=false;this.updatePosition=async()=>{if(this.triggerEl&&this.menuEl&&this.isOpen){await this.updateFloatingPosition()}}}disabledChanged(t){if(t&&this.isOpen){this.closeMenu()}}async toggleMenu(){if(this.disabled){return}if(this.menuEl){this.menuEl.togglePopover();this.isOpen=this.menuEl.matches(":popover-open")}this.atuiMenuStateChange.emit(this.isOpen);await this.updatePosition()}async openMenu(){if(this.disabled){return}if(this.menuEl){this.menuEl.showPopover();this.isOpen=true}this.atuiMenuStateChange.emit(true);await this.updatePosition()}async closeMenu(){if(this.menuEl){this.menuEl.hidePopover();this.isOpen=false}this.atuiMenuStateChange.emit(false)}async getIsOpen(){return this.isOpen}async componentDidLoad(){this.popoverId=`atui-menu-${Math.random().toString(36).substr(2,9)}`;await this.setupFloatingUI();setTimeout((()=>this.setupPopoverEventListeners()),0)}setupPopoverEventListeners(){if(this.menuEl){this.menuEl.addEventListener("toggle",(t=>{const s=t;this.isOpen=s.newState==="open";this.atuiMenuStateChange.emit(this.isOpen);if(this.isOpen){requestAnimationFrame((()=>this.updatePosition()))}}))}}disconnectedCallback(){this.cleanupFloatingUI()}async mouseEnterHandler(){if(this.timedOutCloser)clearTimeout(this.timedOutCloser);if(!this.isOpen){await this.openMenu()}}async mouseLeaveHandler(){await this.closeMenu()}async setupFloatingUI(){if(this.cleanupAutoUpdate){this.cleanupAutoUpdate()}if(this.triggerEl&&this.menuEl){const t=new IntersectionObserver((t=>{if(!t[0].isIntersecting&&this.isOpen){this.mouseLeaveHandler()}}),{threshold:0});t.observe(this.triggerEl);this.cleanupAutoUpdate=h(this.triggerEl,this.menuEl,(()=>{if(this.isOpen){const t=this.getFloatingUIPlacement();const s="fixed";n(this.triggerEl,this.menuEl,{placement:t,strategy:s,middleware:[o(this.position==="bottom"||this.position==="top"?this.offset_y:this.offset_x),r({fallbackStrategy:"bestFit",padding:8}),c({padding:8,mainAxis:true,crossAxis:true}),l({apply({availableWidth:t,availableHeight:s,elements:i}){Object.assign(i.floating.style,{maxWidth:`${t}px`,maxHeight:`${s}px`})}})]}).then((({x:t,y:i})=>{const e={position:s,left:`${t}px`,top:`${i}px`,margin:"0",transform:"none"};if(this.width){e.width=this.width}Object.assign(this.menuEl.style,e)}))}}),{ancestorScroll:true,ancestorResize:true,elementResize:true,layoutShift:true,animationFrame:true});const s=this.cleanupAutoUpdate;this.cleanupAutoUpdate=()=>{s();t.disconnect()}}}cleanupFloatingUI(){if(this.cleanupAutoUpdate){this.cleanupAutoUpdate();this.cleanupAutoUpdate=undefined}}async updateFloatingPosition(){if(!this.triggerEl||!this.menuEl)return;await this.setupFloatingUI()}getFloatingUIPlacement(){const t={top:"top",bottom:"bottom",left:"left",right:"right"};const s={start:"start",end:"end"};const i=t[this.position]||"bottom";const e=s[this.align]||"start";return`${i}-${e}`}render(){return i(e,{key:"0ccc40e271fd4a14df7653ffd3b74645573589c8",class:"relative z-modal"},i("div",{key:"fcb61f0ffe05715d172148d4654f517487bb1c1c",class:"relative",onBlur:()=>this.trigger==="click"&&!this.disabled?this.mouseLeaveHandler():null},i("div",{key:"c3c7f3fbd692af418a01b60c8098625bd2addaae","aria-haspopup":"true","data-name":"menu-trigger",ref:t=>this.triggerEl=t,"aria-expanded":`${this.isOpen?"true":"false"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled?this.mouseEnterHandler():null,onKeyDown:async t=>{switch(t.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":t.preventDefault();await this.toggleMenu();break}},onMouseLeave:()=>this.trigger==="hover"&&!this.disabled?this.mouseLeaveHandler():null,onClick:async t=>{if(this.trigger==="click"&&!this.disabled){t.preventDefault();t.stopPropagation();if(this.isOpen){await this.closeMenu()}else{await this.openMenu()}}},class:this.disabled?"contents":""},i("slot",{key:"0a898fb587915acb5f2838767a035aaaee6da384",name:"menu-trigger"})),i("div",{key:"34440c8dc0ea4ef501b2b70a96234bdfcd207b0d",role:this.role,"data-position":this.position,"data-align":this.align,ref:t=>this.menuEl=t,"aria-hidden":`${this.isOpen?"false":"true"}`,popover:"auto",id:this.popoverId,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:async t=>{if(t.key==="Enter"||t.key===" "||t.key==="Escape"){if(this.autoclose){await this.mouseLeaveHandler()}}},onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:"w-fit rounded-md bg-white p-4 shadow-md","data-name":"menu-content-wrapper"},i("slot",{key:"179740be7f893b123e430b0b11469d24600a4a42",name:"menu-content"}))))}get el(){return a(this)}static get watchers(){return{disabled:["disabledChanged"]}}};export{d as atui_menu};
//# sourceMappingURL=p-c107e51a.entry.js.map