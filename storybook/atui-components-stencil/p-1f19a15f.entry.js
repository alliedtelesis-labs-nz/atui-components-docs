import{r as e,c as t,a as s,h as a,H as i}from"./p-B5bw8iR3.js";import{f as n}from"./p-DuLooPsr.js";import{c as o}from"./p-COG8_R0C.js";import{PromptResponseScore as r}from"./index.esm.js";const d=o("relative flex flex-col items-end gap-2 rounded-lg border border-solid p-8 transition-[background-color,color,box-shadow] duration-300 ease-in-out",{variants:{invalid:{true:"border-destructive focus-within:border-destructive focus-within:ring-destructive/30 focus-within:ring-2",false:"border-med focus-within:border-active-foreground focus-within:ring-active-foreground/30 focus-within:ring-2"},disabled:{true:"bg-surface-1 pointer-events-none",false:"bg-white"}},compoundVariants:[{disabled:true,class:"focus-within:ring-0"}],defaultVariants:{invalid:false,disabled:false}});const l=o("text-body text-dark w-full resize-none border-none bg-transparent break-words whitespace-pre-wrap shadow-none outline-none focus-visible:ring-0 focus-visible:ring-offset-0",{variants:{invalid:{true:"border-destructive-foreground",false:"border-med"},disabled:{true:"bg-surface-1 pointer-events-none",false:"bg-disableD-LIGHT"}},defaultVariants:{invalid:false,disabled:false}});const h=class{constructor(s){e(this,s);this.atChange=t(this,"atChange",7);this.atSubmit=t(this,"atSubmit",7);this.atStop=t(this,"atStop",7);this.atFocus=t(this,"atFocus",7)}label;hint_text;info_text;error_text;placeholder="Enter your message...";max_height=240;max_length=2e3;in_progress=false;value="";disabled=false;textareaEl;translations;invalid=false;get el(){return s(this)}atChange;atSubmit;atStop;atFocus;inputId=`prompt-input-${Math.random().toString(36).substring(2,11)}`;async componentWillLoad(){this.translations=await n(this.el)}focusInput(){if(this.textareaEl){this.textareaEl.focus();this.atFocus.emit()}}handleInput(e){e.stopPropagation();this.value=e.target.value;if(this.max_length&&this.value.length>this.max_length){this.invalid=true}else{this.invalid=false}this.atChange.emit(this.value);this.autoResize()}autoResize(){if(this.textareaEl){this.textareaEl.style.height="auto";const e=this.textareaEl.scrollHeight;const t=Math.max(44,Math.min(e,this.max_height));this.textareaEl.style.height=`${t}px`}}componentDidLoad(){setTimeout((()=>{this.autoResize()}),0)}handleKeyDown(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();this.sendMessage()}}sendMessage(){if(this.in_progress){this.atStop.emit()}else if(this.value&&this.value.trim()!==""&&!this.invalid){this.atSubmit.emit(this.value.trim());this.value="";this.invalid=false;setTimeout((()=>{this.autoResize();this.focusInput()}),0)}}render(){const e=!this.disabled&&!this.invalid&&(this.in_progress||this.value&&this.value.trim()!=="");const t=d({invalid:this.invalid,disabled:this.disabled});const s=l({invalid:this.invalid,disabled:this.disabled});return a(i,{key:"a92be3a1e39b1a3f580005fe56c85fb82f99759a",id:this.inputId+"-container",class:"w-full px-16"},a("div",{key:"7a9730762c4e6fb6d84055c3b1b516e8da0a8ef9",class:"flex flex-col"},a("slot",{key:"ac089935dd15bd31c11820fea52ad57213e7e199",name:"label"}),(this.label||this.info_text)&&a("at-form-label",{key:"7bf097ab0c155c85203d1bef5158c51d4bb9bebe",label:this.label,for:this.inputId,info_text:this.info_text,"data-name":"prompt-input-label"}),this.hint_text&&a("span",{key:"13c4791e1680faf088fd8709eeca48e7aa3fe0e5",class:"text-light mb-8 inline-block text-xs leading-tight","data-name":"prompt-input-hint"},this.hint_text)),a("div",{key:"2bb81de1389c0112b650cddab44d82aeb965deea",class:t},a("textarea",{key:"b4095a42fd7e1056d132048bda7baa7f4dd77d8e",class:s,disabled:this.disabled,id:this.inputId,placeholder:this.placeholder,onInput:e=>this.handleInput(e),onKeyDown:e=>this.handleKeyDown(e),value:this.value,ref:e=>this.textareaEl=e,style:{minHeight:"44px",maxHeight:this.max_height+"px",overflow:"auto"},"data-name":"prompt-input"}),a("div",{key:"4e883c44e4507137e46860dfed5c2a2b005f4352",class:"flex w-full items-center justify-between gap-1"},a("div",{key:"a768d3db3aaedf2ab809df3f9a9f55f86d5d735d",class:"flex items-center gap-4"},a("slot",{key:"a4f449ac9df8d689e06cc46ed46ace44d5667565",name:"actions-left"})),a("div",{key:"4a15694bfabbfdd03db0a01e6458936d98ed0ad6",class:"flex items-center gap-4 self-end"},a("slot",{key:"473664a212b9004f257f2f3a029634d17ab19728",name:"actions-right"}),a("at-button",{key:"63b60b6982ec32c0e20515d8f98900301674311a",class:"rounded-lg",size:"sm",type:"secondary",icon:this.in_progress?"stop":"arrow_upward",disabled:!e,onClick:()=>this.sendMessage(),onKeyDown:e=>{if(e.key==="Enter"||e.key===" "){this.sendMessage()}},"data-name":"prompt-send-button"})))),a("slot",{key:"82ef1305581236e017705a964b5f39766e5fcfcd",name:"footer"}),this.invalid&&a("span",{key:"10af5faad97d220caa699afa273e4f4f6c1b8c05",class:"text-error-dark text-xs","data-name":"error-text"},this.error_text?this.error_text:this.translations.ATUI.PROMPT.ERROR_MESSAGE))}};const c=class{constructor(s){e(this,s);this.atMessageCopy=t(this,"atMessageCopy",7);this.atMessageRetry=t(this,"atMessageRetry",7);this.atMessageEdit=t(this,"atMessageEdit",7);this.atMessageVote=t(this,"atMessageVote",7)}messages=[];loading=false;auto_scroll=true;chatbot_title="Assistant";enable_vote=true;enable_copy=true;enable_edit=false;response_animation="words";atMessageCopy;atMessageRetry;atMessageEdit;atMessageVote;scrollContainer;componentDidUpdate(){if(this.auto_scroll&&this.scrollContainer){this.scrollToBottom()}}async scrollToBottom(){return new Promise((e=>{requestAnimationFrame((()=>{if(this.scrollContainer){this.scrollContainer.scrollTo({top:this.scrollContainer.scrollHeight,behavior:"smooth"})}e()}))}))}async scrollLastMessageToTop(){return new Promise((e=>{requestAnimationFrame((()=>{if(!this.scrollContainer){e();return}const t=this.scrollContainer.querySelectorAll('[data-role="user"]');if(!t.length){e();return}const s=t[t.length-1];s.scrollIntoView({behavior:"smooth",block:"start"});e()}))}))}handleVote(e){const t=this.messages.findIndex((t=>t.id===e.detail.messageId));if(t!==-1){const s=[...this.messages];s[t]={...s[t],score:e.detail.score};this.messages=s;this.atMessageVote.emit(e.detail)}}handleMessageCopy(e){const t=this.getMessageIndexFromEvent(e);if(t!==-1){this.atMessageCopy.emit({messageId:this.messages[t].id,content:e.detail})}}handleMessageRetry(e){const t=this.getMessageIndexFromEvent(e);if(t!==-1){this.atMessageRetry.emit({messageId:this.messages[t].id})}}handleMessageEdit(e){const t=this.getMessageIndexFromEvent(e);if(t!==-1){this.atMessageEdit.emit({messageId:this.messages[t].id,content:e.detail})}}getMessageIndexFromEvent(e){const t=e.target;const s=t.closest("[data-message-index]");return s?parseInt(s.dataset.messageIndex||"-1",10):-1}renderLoadingIndicator(){if(!this.loading)return null;return a("div",{class:"flex flex-col gap-16","data-name":"loading-container"},a("at-prompt-message",{role:"assistant",content:"Typing...",name:this.chatbot_title,loading:true,"data-name":"loading-message"}))}renderMessage(e,t){const s=e.role;const i=e.role==="user"?e.name:e.name||this.chatbot_title;const n=e.role==="assistant"?this.response_animation:"fade";return a("at-prompt-message",{role:s,content:e.content,name:i,loading:e.loading,error:e.error,error_message:e.error_message,score:e.score||r.NONE,message_id:e.id,enable_vote:this.enable_vote,enable_copy:this.enable_copy,enable_edit:this.enable_edit,response_animation:n,"data-name":`message-${t}`,"data-message-index":t})}renderMessages(){return this.messages.map(((e,t)=>this.renderMessage(e,t)))}render(){const e=this.messages&&this.messages.length>0;return a(i,{key:"81f8c935bab8099dfaf735c9293259d284648e4f",class:"block h-full","data-name":"thread-container"},a("div",{key:"7a6613c8c275963ebf1f12e8179f10808a278fd3",class:"flex h-full flex-col gap-16 overflow-y-auto scroll-smooth",ref:e=>this.scrollContainer=e,"data-name":"scroll-container"},!e?a("slot",{name:"thread-empty-state"}):a("div",{"data-name":"thread-messages-container",class:"flex flex-col gap-16"},this.renderMessages(),this.renderLoadingIndicator()),a("slot",{key:"17483cf7ee881e3beaef4f172196c9f93950997f",name:"thread-messages"})))}};export{h as at_prompt_input,c as at_prompt_thread};
//# sourceMappingURL=p-1f19a15f.entry.js.map