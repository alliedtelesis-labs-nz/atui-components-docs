import{r as t,c as s,h as i,H as e,g as h}from"./p-HJO1YDmC.js";import{c as n}from"./p-CVoOBWGd.js";const a=n("fixed z-menu w-full rounded-md border border-solid border-light bg-white p-4 shadow-md",{variants:{open:{true:null,false:"hidden"}}});const o=class{constructor(i){t(this,i);this.menuStateChange=s(this,"menuStateChange",7);this.offset_x=0;this.offset_y=0;this.position="bottom";this.align="start";this.width="280px";this.autoclose=true;this.trigger="click";this.role="menu";this.disabled=false;this.isOpen=false;this.isIntersectingViewport=false;this.updatePosition=()=>{requestAnimationFrame((()=>{const t=this.triggerEl;if(t){this.triggerPosition=t.getBoundingClientRect()}}))};this.handleOutsideClick=t=>{if(this.isOpen&&!this.el.contains(t.target)){this.mouseLeaveHandler()}}}async toggleMenu(){this.menuStateChange.emit(!this.isOpen);this.isOpen=!this.isOpen;this.updatePosition()}async openMenu(){this.isOpen=true;this.menuStateChange.emit(true)}async closeMenu(){this.isOpen=false;this.menuStateChange.emit(false)}async getIsOpen(){return this.isOpen}componentDidLoad(){this.updatePosition();window.addEventListener("scroll",this.updatePosition,true);window.addEventListener("resize",this.updatePosition);window.addEventListener("click",this.handleOutsideClick);this.initIntersectionObserver()}disconnectedCallback(){window.removeEventListener("scroll",this.updatePosition,true);window.removeEventListener("resize",this.updatePosition);window.removeEventListener("click",this.handleOutsideClick);if(this.observer){this.observer.disconnect()}}initIntersectionObserver(){const t={root:null,rootMargin:"0px",threshold:1};this.observer=new IntersectionObserver((t=>{t.forEach((t=>{if(!t.isIntersecting){this.isIntersectingViewport=true;this.positionStrategy(t)}else{this.isIntersectingViewport=false}}))}),t);const s=this.el.querySelector('[data-name="menu-content-wrapper"]');if(s){this.observer.observe(s)}}positionStrategy(t){if(!this.isOpen)return;const s=window.innerWidth;const i=window.innerHeight;const{top:e,right:h,left:n,height:a}=t.boundingClientRect;if(this.position==="bottom"&&e+a>=i){this.position="top"}else if(this.position==="top"&&e<=0){this.position="bottom"}if(this.position==="right"&&h>=s){this.position="left"}else if(this.position==="left"&&n<=0){this.position="right"}}mouseEnterHandler(){if(this.timedOutCloser)clearTimeout(this.timedOutCloser);if(!this.isOpen){this.isOpen=true;this.menuStateChange.emit(true);this.updatePosition()}}mouseLeaveHandler(){this.timedOutCloser=setTimeout((()=>{this.isOpen=false;this.menuStateChange.emit(false)}),150)}get positionStyle(){var t,s;const i={};const e=(t=this.triggerEl)===null||t===void 0?void 0:t.getBoundingClientRect();const h=(s=this.menuEl)===null||s===void 0?void 0:s.getBoundingClientRect();if(!e)return i;switch(this.position){case"top":i.top=`${e.top-h.height}px`;if(this.align==="start"){i.left=`${e.left}px`}else{i.right=`${window.innerWidth-e.right}px`}break;case"bottom":i.top=`${e.bottom+this.offset_y}px`;if(this.align==="start"){i.left=`${e.left}px`}else{i.right=`${window.innerWidth-e.right-8}px`}break;case"left":i.left=`${e.left-h.width}px`;if(this.align==="start"){i.top=`${e.top}px`}else{i.bottom=`${window.innerHeight-e.bottom}px`}break;case"right":i.left=`${e.right+this.offset_x}px`;if(this.align==="start"){i.top=`${e.top}px`}else{i.bottom=`${window.innerHeight-e.bottom}px`}break}i.width=this.width;return i}render(){const t=a({open:this.isOpen});return i(e,{key:"9a57f48286b36e8ea821ede6f490fa34342a89ee"},i("div",{key:"a897e7320acf66d4089f814ff56c5f90f1a7ca61",class:"relative",onBlur:()=>this.trigger==="click"&&!this.disabled?this.mouseLeaveHandler():null},i("div",{key:"036b305841cacd2e3383f0dd4856c0952e13bf32","aria-haspopup":"true","data-name":"menu-trigger",ref:t=>this.triggerEl=t,"aria-expanded":`${this.isOpen?"true":"false"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled?this.mouseEnterHandler():null,onKeyDown:async t=>{if(t.key==="Escape"){await this.closeMenu()}},onMouseLeave:()=>this.trigger==="hover"&&!this.disabled?this.mouseLeaveHandler():null,onClick:()=>this.trigger==="click"&&!this.disabled?this.toggleMenu():null,class:this.disabled?"contents":""},i("slot",{key:"f0f45a293508792f7146315c78d4f0b02ae4f453",name:"menu-trigger"})),i("div",{key:"a43d19713a09a855a993fa3839dd5bc96526188d",role:this.role,style:this.positionStyle,"data-position":this.position,"data-align":this.align,ref:t=>this.menuEl=t,"aria-hidden":`${this.isOpen?"false":"true"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:t=>{if(t.key==="Enter"||t.key===" "||t.key==="Escape"){if(this.autoclose){this.mouseLeaveHandler()}}},onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:t,"data-name":"menu-content-wrapper"},i("slot",{key:"9cdd0ba67f15c28dca859481b243e5d9ab5a25db",name:"menu-content"}))))}get el(){return h(this)}};export{o as atui_menu};
//# sourceMappingURL=p-b445fbec.entry.js.map