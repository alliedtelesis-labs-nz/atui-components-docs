import{r as t,c as i,g as s,h as e,H as a}from"./p-CVZ0O9-b.js";import{a as h,c as n,o as r,f as o,s as c,b as l}from"./p-BO6p966C.js";const d=class{constructor(s){t(this,s);this.atuiMenuStateChange=i(this,"atuiMenuStateChange",7)}offset_x=0;offset_y=0;position="bottom";align="start";width;autoclose=true;trigger="click";role="menu";disabled=false;trigger_id;disabledChanged(t){if(t&&this.isOpen){this.closeMenu()}}isOpen=false;triggerEl;menuEl;triggerEls=[];popoverId;cleanupAutoUpdate;updatePosition=async()=>{if(this.triggerEl&&this.menuEl&&this.isOpen){await this.updateFloatingPosition()}};get el(){return s(this)}async toggleMenu(){if(this.disabled){return}if(this.menuEl){this.menuEl.togglePopover();this.isOpen=this.menuEl.matches(":popover-open")}this.atuiMenuStateChange.emit(this.isOpen);await this.updatePosition();this.updateAriaExpanded()}async openMenu(){if(this.disabled){return}if(this.menuEl){this.menuEl.showPopover();this.isOpen=true}this.atuiMenuStateChange.emit(true);await this.updatePosition();this.updateAriaExpanded()}async closeMenu(){if(this.menuEl){this.menuEl.hidePopover();this.isOpen=false}this.atuiMenuStateChange.emit(false);this.updateAriaExpanded()}updateAriaExpanded(){if(this.trigger_id&&this.triggerEl){this.triggerEl.setAttribute("aria-expanded",this.isOpen?"true":"false")}}async getIsOpen(){return this.isOpen}atuiMenuStateChange;timedOutCloser;async componentDidLoad(){this.popoverId=`atui-menu-${Math.random().toString(36).substr(2,9)}`;if(this.trigger_id){this.triggerEls=Array.from(document.querySelectorAll(`[data-menu="${this.trigger_id}"]`));if(this.triggerEls.length===0){console.warn(`atui-menu: No elements found with data-menu="${this.trigger_id}"`);return}}else{this.triggerEl=this.el.querySelector('[data-name="menu-trigger"]')}await this.setupFloatingUI();setTimeout((()=>this.setupPopoverEventListeners()),0);if(this.trigger_id&&this.triggerEls.length){this.setupExternalTriggerListeners()}}setupPopoverEventListeners(){if(this.menuEl){this.menuEl.addEventListener("toggle",(t=>{const i=t;this.isOpen=i.newState==="open";this.atuiMenuStateChange.emit(this.isOpen);if(this.isOpen){requestAnimationFrame((()=>this.updatePosition()))}}))}}setupExternalTriggerListeners(){if(!this.triggerEls||this.triggerEls.length===0)return;this.triggerEls.forEach((t=>{const i=[];if(this.trigger==="hover"){const s=()=>{if(!this.disabled){this.triggerEl=t;this.mouseEnterHandler()}};const e=()=>{if(!this.disabled){this.triggerEl=t;this.mouseLeaveHandler()}};i.push({event:"mouseenter",handler:s},{event:"mouseleave",handler:e})}if(this.trigger==="click"){const s=async i=>{if(!this.disabled){i.preventDefault();i.stopPropagation();this.triggerEl=t;if(this.isOpen){await this.closeMenu()}else{await this.openMenu()}}};i.push({event:"click",handler:s})}const s=async i=>{if(!this.disabled){this.triggerEl=t;switch(i.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":i.preventDefault();await this.toggleMenu();break}}};i.push({event:"keydown",handler:s});i.forEach((({event:i,handler:s})=>{t.addEventListener(i,s);this.externalTriggerListeners.push({element:t,event:i,handler:s})}));t.setAttribute("aria-haspopup","true");t.setAttribute("aria-expanded","false")}))}disconnectedCallback(){this.cleanupFloatingUI();this.cleanupExternalTriggerListeners()}externalTriggerListeners=[];cleanupExternalTriggerListeners(){this.externalTriggerListeners.forEach((({element:t,event:i,handler:s})=>{t.removeEventListener(i,s)}));this.externalTriggerListeners=[]}async mouseEnterHandler(){if(this.timedOutCloser)clearTimeout(this.timedOutCloser);if(!this.isOpen){await this.openMenu()}}async mouseLeaveHandler(){await this.closeMenu()}async setupFloatingUI(){if(this.cleanupAutoUpdate){this.cleanupAutoUpdate()}if(this.triggerEl&&this.menuEl){const t=new IntersectionObserver((t=>{if(!t[0].isIntersecting&&this.isOpen){this.mouseLeaveHandler()}}),{threshold:0});t.observe(this.triggerEl);this.cleanupAutoUpdate=h(this.triggerEl,this.menuEl,(()=>{if(this.isOpen){const t=this.getFloatingUIPlacement();const i="fixed";n(this.triggerEl,this.menuEl,{placement:t,strategy:i,middleware:[r(this.position==="bottom"||this.position==="top"?this.offset_y:this.offset_x),o({fallbackStrategy:"bestFit",padding:8}),c({padding:8,mainAxis:true,crossAxis:true}),l({apply({availableWidth:t,availableHeight:i,elements:s}){Object.assign(s.floating.style,{maxWidth:`${t}px`,maxHeight:`${i}px`})}})]}).then((({x:t,y:s})=>{const e={position:i,left:`${t}px`,top:`${s}px`,margin:"0",transform:"none"};if(this.width){e.width=this.width}Object.assign(this.menuEl.style,e)}))}}),{ancestorScroll:true,ancestorResize:true,elementResize:true,layoutShift:true,animationFrame:true});const i=this.cleanupAutoUpdate;this.cleanupAutoUpdate=()=>{i();t.disconnect()}}}cleanupFloatingUI(){if(this.cleanupAutoUpdate){this.cleanupAutoUpdate();this.cleanupAutoUpdate=undefined}}async updateFloatingPosition(){if(!this.triggerEl||!this.menuEl)return;await this.setupFloatingUI()}getFloatingUIPlacement(){const t={top:"top",bottom:"bottom",left:"left",right:"right"};const i={start:"start",end:"end"};const s=t[this.position]||"bottom";const e=i[this.align]||"start";return`${s}-${e}`}render(){return e(a,{key:"035a6c36eb09d23abc240efa4b5480489b244a62",class:"relative",onBlur:()=>this.trigger==="click"&&!this.disabled?this.mouseLeaveHandler():null},!this.trigger_id&&e("div",{key:"292086d7f40aa03142fd7afb99f9c5c1fc095495","aria-haspopup":"true","data-name":"menu-trigger",ref:t=>this.triggerEl=t,"aria-expanded":`${this.isOpen?"true":"false"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled?this.mouseEnterHandler():null,onKeyDown:async t=>{switch(t.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":t.preventDefault();await this.toggleMenu();break}},onMouseLeave:()=>this.trigger==="hover"&&!this.disabled?this.mouseLeaveHandler():null,onClick:async t=>{if(this.trigger==="click"&&!this.disabled){t.preventDefault();t.stopPropagation();if(this.isOpen){await this.closeMenu()}else{await this.openMenu()}}},class:this.disabled?"contents":""},e("slot",{key:"ed799cc7f950b0f544affb15d790d3291cc6b310",name:"menu-trigger"})),e("div",{key:"e6b8224bcaaf65707592e2b0553e9666bb6022db",role:this.role,"data-position":this.position,"data-align":this.align,ref:t=>this.menuEl=t,"aria-hidden":`${this.isOpen?"false":"true"}`,popover:"auto",id:this.popoverId,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:async t=>{if(t.key==="Enter"||t.key===" "||t.key==="Escape"){if(this.autoclose){await this.mouseLeaveHandler()}}},onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:`w-fit rounded-md bg-white p-4 shadow-md transition-opacity duration-150 ${this.isOpen?"opacity-100":"opacity-0"}`,"data-name":"menu-content-wrapper"},e("slot",{key:"8a7772f04a3b45c6555a07b29021bc7654f7fdee"})))}static get watchers(){return{disabled:["disabledChanged"]}}};export{d as at_menu};
//# sourceMappingURL=p-1ff5ae7e.entry.js.map