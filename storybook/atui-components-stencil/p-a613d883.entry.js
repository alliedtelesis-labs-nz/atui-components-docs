import{r as e,c as t,g as s,h as a,H as i}from"./p-jvbUuQtg.js";import{f as n}from"./p-DuLooPsr.js";import{c as o}from"./p-COG8_R0C.js";import{P as r}from"./p-Btgx1mEX.js";const d=o("relative flex flex-col items-end gap-2 rounded-lg border border-solid p-8 transition-[background-color,color,box-shadow] duration-300 ease-in-out",{variants:{invalid:{true:"border-destructive focus-within:border-destructive focus-within:ring-destructive/30 focus-within:ring-2",false:"border-med focus-within:border-active-foreground focus-within:ring-active-foreground/30 focus-within:ring-2"},disabled:{true:"bg-surface-1 pointer-events-none",false:"bg-white"}},compoundVariants:[{disabled:!0,class:"focus-within:ring-0"}],defaultVariants:{invalid:!1,disabled:!1}}),h=o("text-body text-dark w-full resize-none border-none bg-transparent break-words whitespace-pre-wrap shadow-none outline-none focus-visible:ring-0 focus-visible:ring-offset-0",{variants:{invalid:{true:"border-destructive-foreground",false:"border-med"},disabled:{true:"bg-surface-1 pointer-events-none",false:"bg-disableD-LIGHT"}},defaultVariants:{invalid:!1,disabled:!1}}),c=class{constructor(s){e(this,s),this.atChange=t(this,"atChange",7),this.atSubmit=t(this,"atSubmit",7),this.atStop=t(this,"atStop",7),this.atFocus=t(this,"atFocus",7)}label;hint_text;info_text;error_text;placeholder="Enter your message...";max_height=240;max_length=2e3;in_progress=!1;value="";disabled=!1;textareaEl;translations;invalid=!1;get el(){return s(this)}atChange;atSubmit;atStop;atFocus;inputId=`prompt-input-${Math.random().toString(36).substring(2,11)}`;async componentWillLoad(){this.translations=await n(this.el)}focusInput(){this.textareaEl&&(this.textareaEl.focus(),this.atFocus.emit())}handleInput(e){e.stopPropagation(),this.value=e.target.value,this.invalid=!!(this.max_length&&this.value.length>this.max_length),this.atChange.emit(this.value),this.autoResize()}autoResize(){if(this.textareaEl){this.textareaEl.style.height="auto";const e=Math.max(44,Math.min(this.textareaEl.scrollHeight,this.max_height));this.textareaEl.style.height=`${e}px`}}componentDidLoad(){setTimeout((()=>{this.autoResize()}),0)}handleKeyDown(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())}sendMessage(){this.in_progress?this.atStop.emit():this.value&&""!==this.value.trim()&&!this.invalid&&(this.atSubmit.emit(this.value.trim()),this.value="",this.invalid=!1,setTimeout((()=>{this.autoResize(),this.focusInput()}),0))}render(){const e=!this.disabled&&!this.invalid&&(this.in_progress||this.value&&""!==this.value.trim()),t=d({invalid:this.invalid,disabled:this.disabled}),s=h({invalid:this.invalid,disabled:this.disabled});return a(i,{key:"1945c2d07427750b72f02dcf3e41939d1c58849a",id:this.inputId+"-container",class:"w-full px-16"},a("div",{key:"862035db7fc7c1678a0bec3e4d0f562d97f22521",class:"flex flex-col"},a("slot",{key:"d3fc7974948d124f9eb8d8eb22f2768ad41df02c",name:"label"}),(this.label||this.info_text)&&a("at-form-label",{key:"92615214c07b2e4be2ac4a0baa93e7605665e8ba",label:this.label,for:this.inputId,info_text:this.info_text,"data-name":"prompt-input-label"}),this.hint_text&&a("span",{key:"a34f4bb94eced0be6d4e2a4fe6af6ca282ebbd11",class:"text-light mb-8 inline-block text-xs leading-tight","data-name":"prompt-input-hint"},this.hint_text)),a("div",{key:"d0dd8d4cd1ab14c1e8961c5d70830bc882c7014c",class:t},a("textarea",{key:"13676445c4cc540c9c1acbe65675a4a0aa3a0580",class:s,disabled:this.disabled,id:this.inputId,placeholder:this.placeholder,onInput:e=>this.handleInput(e),onKeyDown:e=>this.handleKeyDown(e),value:this.value,ref:e=>this.textareaEl=e,style:{minHeight:"44px",maxHeight:this.max_height+"px",overflow:"auto"},"data-name":"prompt-input"}),a("div",{key:"c5a8b896afdbe86d960e159f4eadac7be8685046",class:"flex w-full items-center justify-between gap-1"},a("div",{key:"9973c3d12efb297cc7cffbb95eb733da667672ab",class:"flex items-center gap-4"},a("slot",{key:"ee0f80283bb18ebef543767da0965b5b4e4c972b",name:"actions-left"})),a("div",{key:"0b6b87e6475548b8c1c36dbe3f2b6835b40f288a",class:"flex items-center gap-4 self-end"},a("slot",{key:"af302640bcc8b4e93edbf538e2237c0bcc9784a9",name:"actions-right"}),a("at-button",{key:"0163bccc1212f17787b2004c987fdd7d80f1744b",class:"rounded-lg",size:"sm",type:"secondary",icon:this.in_progress?"stop":"arrow_upward",disabled:!e,onClick:()=>this.sendMessage(),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.sendMessage()},"data-name":"prompt-send-button"})))),a("slot",{key:"6106937935388ebaf86c2bb1bee3defccf0e8d12",name:"footer"}),this.invalid&&a("span",{key:"92ad7ca917519332fcfea8b086d3a73032bf9621",class:"text-error-dark text-xs","data-name":"error-text"},this.error_text?this.error_text:this.translations.ATUI.PROMPT.ERROR_MESSAGE))}},l=class{constructor(s){e(this,s),this.atMessageCopy=t(this,"atMessageCopy",7),this.atMessageRetry=t(this,"atMessageRetry",7),this.atMessageEdit=t(this,"atMessageEdit",7),this.atMessageVote=t(this,"atMessageVote",7)}messages=[];loading=!1;auto_scroll=!0;chatbot_title="Assistant";enable_vote=!0;enable_copy=!0;enable_edit=!1;response_animation="words";atMessageCopy;atMessageRetry;atMessageEdit;atMessageVote;scrollContainer;componentDidUpdate(){this.auto_scroll&&this.scrollContainer&&this.scrollToBottom()}async scrollToBottom(){return new Promise((e=>{requestAnimationFrame((()=>{this.scrollContainer&&this.scrollContainer.scrollTo({top:this.scrollContainer.scrollHeight,behavior:"smooth"}),e()}))}))}async scrollLastMessageToTop(){return new Promise((e=>{requestAnimationFrame((()=>{if(!this.scrollContainer)return void e();const t=this.scrollContainer.querySelectorAll('[data-role="user"]');t.length?(t[t.length-1].scrollIntoView({behavior:"smooth",block:"start"}),e()):e()}))}))}handleVote(e){const t=this.messages.findIndex((t=>t.id===e.detail.messageId));if(-1!==t){const s=[...this.messages];s[t]={...s[t],score:e.detail.score},this.messages=s,this.atMessageVote.emit(e.detail)}}handleMessageCopy(e){const t=this.getMessageIndexFromEvent(e);-1!==t&&this.atMessageCopy.emit({messageId:this.messages[t].id,content:e.detail})}handleMessageRetry(e){const t=this.getMessageIndexFromEvent(e);-1!==t&&this.atMessageRetry.emit({messageId:this.messages[t].id})}handleMessageEdit(e){const t=this.getMessageIndexFromEvent(e);-1!==t&&this.atMessageEdit.emit({messageId:this.messages[t].id,content:e.detail})}getMessageIndexFromEvent(e){const t=e.target.closest("[data-message-index]");return t?parseInt(t.dataset.messageIndex||"-1",10):-1}renderLoadingIndicator(){return this.loading?a("div",{class:"flex flex-col gap-16","data-name":"loading-container"},a("at-prompt-message",{role:"assistant",content:"Typing...",name:this.chatbot_title,loading:!0,"data-name":"loading-message"})):null}renderMessage(e,t){return a("at-prompt-message",{role:e.role,content:e.content,name:"user"===e.role?e.name:e.name||this.chatbot_title,loading:e.loading,error:e.error,error_message:e.error_message,score:e.score||r.NONE,message_id:e.id,enable_vote:this.enable_vote,enable_copy:this.enable_copy,enable_edit:this.enable_edit,response_animation:"assistant"===e.role?this.response_animation:"fade","data-name":`message-${t}`,"data-message-index":t})}renderMessages(){return this.messages.map(((e,t)=>this.renderMessage(e,t)))}render(){return a(i,{key:"6664e246258eded19e785cdc39621f7724396246",class:"block h-full","data-name":"thread-container"},a("div",{key:"d316370a9d896cf77033fb8a5c4af320a798d7ff",class:"flex h-full flex-col gap-16 overflow-y-auto scroll-smooth",ref:e=>this.scrollContainer=e,"data-name":"scroll-container"},this.messages&&this.messages.length>0?a("div",{"data-name":"thread-messages-container",class:"flex flex-col gap-16"},this.renderMessages(),this.renderLoadingIndicator()):a("slot",{name:"thread-empty-state"}),a("slot",{key:"2c596a810e00cc2ad6614b76385ed099ca3ec4ee",name:"thread-messages"})))}};export{c as at_prompt_input,l as at_prompt_thread}