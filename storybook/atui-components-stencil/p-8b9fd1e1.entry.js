import{r as t,c as e,g as s,h as i,H as a}from"./p-EP34iaAr.js";import{f as h}from"./p-DuLooPsr.js";var n;(function(t){t[t["ASC"]=1]="ASC";t[t["DESC"]=-1]="DESC"})(n||(n={}));const l=class{constructor(s){t(this,s);this.atSearchParamsChange=e(this,"atSearchParamsChange",7)}table_data;label;search_label;search_hint;search_info_tooltip;col_defs=[];page_size=10;hide_dropdown_filters;hide_column_manager;hide_export_menu;use_custom_pagination=false;auto_size_columns=true;server_side_mode=false;loading=false;atSearchParamsChange;get el(){return s(this)}translations;agGrid;tableCreated=false;activeFilters={};selectedFilters=[];menuSelectedIds=[];searchValue="";tableEl;get shouldShowDropdownFilters(){return!this.hide_dropdown_filters&&this.col_defs&&this.col_defs.length>0}get shouldShowColumnManager(){return!this.hide_column_manager&&this.col_defs&&this.col_defs.length>0}handleSelectedFiltersChange(t){this.menuSelectedIds=t.map((t=>t.id))}async componentWillLoad(){this.translations=await h(this.el)}async componentDidLoad(){await this.initGrid();if(this.server_side_mode&&this.agGrid){this.emitSearchParamsChange()}}async componentDidUpdate(){if(!this.tableCreated){await this.initGrid()}}async updateRowByIndex(t,e){const s=this.agGrid.getRenderedNodes();t.forEach((({index:t,update:i})=>{const a=s.find((e=>e.rowIndex===t));if(a){a.updateData(i);if(e?.flash){this.agGrid.flashCells({rowNodes:[a]})}this.agGrid.refreshCells({rowNodes:[a],force:e?.forceRefresh||false})}}))}async getDisplayedRows(){return this.agGrid.getRenderedNodes()}async initGrid(){if(this.col_defs&&!this.tableCreated&&this.tableEl){this.agGrid=await this.tableEl.createGrid();this.tableCreated=true;this.setupExternalFilters();if(this.table_data?.items){this.agGrid.setGridOption("rowData",this.table_data.items)}}}setupExternalFilters(){if(!this.agGrid)return;if(this.server_side_mode){return}this.agGrid.setGridOption("isExternalFilterPresent",(()=>Object.keys(this.activeFilters).length>0));this.agGrid.setGridOption("doesExternalFilterPass",(t=>{if(!t.data)return true;const e=this.activeFilters["__search__"];if(e){const s=e.toLowerCase();const i=this.col_defs.some((e=>{let i;if(e.valueGetter&&typeof e.valueGetter==="function"){i=e.valueGetter({data:t.data,node:t,colDef:e,api:this.agGrid,context:null,getValue:e=>t.data[e],column:null})}else if(e.field){i=t.data[e.field]}return i&&String(i).toLowerCase().includes(s)}));if(!i)return false}const s=Object.entries(this.activeFilters).every((([e,s])=>{if(e==="__search__"||!s)return true;const i=this.col_defs.find((t=>t.field===e));let a;if(i&&i.valueGetter&&typeof i.valueGetter==="function"){a=i.valueGetter({data:t.data,node:t,colDef:i,api:this.agGrid,context:null,getValue:e=>t.data[e],column:null})}else{a=t.data[e]}const h=a&&String(a).toLowerCase().includes(String(s).toLowerCase());return h}));return s}))}handleColumnChange(t){const{id:e,checked:s}=t.detail;const i=this.col_defs.map((t=>{if(t.field===e){return{...t,hide:!s}}return t}));this.col_defs=i}handleFilterChange(t){if(!t.detail||Array.isArray(t.detail)&&t.detail.length===0){this.selectedFilters=[];this.menuSelectedIds=[];this.updateActiveFilters();return}if(Array.isArray(t.detail)){if(typeof t.detail[0]==="string"){this.handleMenuFilterChange(t.detail)}else if(typeof t.detail[0]==="object"){this.handleFilterListChange(t.detail)}}this.updateActiveFilters()}handleMenuFilterChange(t){this.selectedFilters=t.map((t=>({id:t,value:""})));this.menuSelectedIds=t}handleFilterListChange(t){if(!t.length||t.length===1&&t[0].id===""){this.selectedFilters=[];this.menuSelectedIds=[]}else{this.selectedFilters=t;this.menuSelectedIds=t.map((t=>t.id))}}updateActiveFilters(){const t=this.activeFilters["__search__"];this.activeFilters={};if(t){this.activeFilters["__search__"]=t}this.selectedFilters.forEach((t=>{if(t.value){this.activeFilters[t.id]=t.value}}));if(this.searchValue){this.activeFilters["__search__"]=this.searchValue}if(this.server_side_mode){this.emitSearchParamsChange()}else{if(this.agGrid){this.setupExternalFilters();this.agGrid.onFilterChanged()}else{console.log("agGrid not available, cannot apply filter")}}}handleSearchChange(t){this.searchValue=t.detail||"";if(this.searchValue){this.activeFilters["__search__"]=this.searchValue}else{delete this.activeFilters["__search__"]}this.updateActiveFilters()}emitSearchParamsChange(){if(!this.agGrid)return;const t=this.agGrid.paginationGetCurrentPage();const e=this.agGrid.paginationGetPageSize();const s=t*e;const i=(t+1)*e;const a=this.agGrid.getColumnState();const h=a.find((t=>t.sort!==null&&t.sort!==undefined));const l={fieldFilters:this.activeFilters,startRow:s,endRow:i,sort:h?.colId,direction:h?.sort==="asc"?n.ASC:n.DESC};this.atSearchParamsChange.emit(l)}render(){return i(a,{key:"3a8e26ffa1175c106983090e2abd0682d00317df"},i("at-table-actions",{key:"254ecfb7125ba28136a5dd11ae1fe12bc87df91a",ag_grid:this.agGrid},i("div",{key:"eb770c7a77f5dccc1d97852b9b6b5b5f03a60e14",class:"flex items-center gap-8",slot:"search"},this.shouldShowDropdownFilters&&i("at-table-filter-menu",{key:"e16555f6b4bee03712d4329faf3653e92f235668",slot:"filter-menu",col_defs:this.col_defs,selected:this.menuSelectedIds,onAtChange:t=>this.handleFilterChange(t)}),i("at-search",{key:"61a5b8256407cf1e1f5267b68600b2107f4ce25b",class:"w-input-md",label:this.search_label,hint_text:this.search_hint,info_text:this.search_info_tooltip,placeholder:this.translations.ATUI.TABLE.SEARCH_BY_KEYWORD,onAtChange:t=>this.handleSearchChange(t)})),this.shouldShowDropdownFilters&&i("at-table-filters",{key:"1b1b5f6775ff4e4323d3d6d3327969a031b2b667",slot:"filters",col_defs:this.col_defs,selected:this.selectedFilters,onAtChange:t=>this.handleFilterChange(t)}),!this.hide_export_menu&&i("at-table-export-menu",{key:"5f043e23b89a8b065311eff673aa6bc95a53cceb",slot:"export-menu"}),this.shouldShowColumnManager&&i("at-column-manager",{key:"7cb5ede479177a61927ba9986824ff5e800d069e",slot:"column-manager",col_defs:this.col_defs,onAtChange:t=>this.handleColumnChange(t)}),i("div",{key:"f0e0019c561a1f7ca6901660852995614080073f",slot:"actions"},i("slot",{key:"8d3b490c98b55a82b1e8a726ef90277f0fe1a166",name:"actions"}))),i("slot",{key:"8500ba1a68b8a7d79331b7a87f3d6ca0d5157842",name:"multi-select-actions"}),this.loading&&this.server_side_mode?i("at-placeholder",{size:"lg",placeholder_title:this.translations?.ATUI?.TABLE?.LOADING_DATA,show_loading_spinner:true}):i("at-table",{ref:t=>this.tableEl=t,table_data:this.table_data,col_defs:this.col_defs,page_size:this.page_size,use_custom_pagination:this.use_custom_pagination,auto_size_columns:this.auto_size_columns,disable_auto_init:!this.server_side_mode}))}static get watchers(){return{selectedFilters:["handleSelectedFiltersChange"]}}};export{l as at_search_table};
//# sourceMappingURL=p-8b9fd1e1.entry.js.map