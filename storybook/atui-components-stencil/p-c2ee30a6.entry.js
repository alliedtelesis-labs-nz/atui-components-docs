import{r as t,c as e,g as s,h as i,H as a}from"./p-EP34iaAr.js";import{f as n}from"./p-DuLooPsr.js";import{c as r}from"./p-COG8_R0C.js";import{h as o,a as h}from"./p-CF3ljWUs.js";const l={variants:{disabled:{false:"focus-within:ring-active-foreground/40 bg-white",true:"bg-surface-1 !text-disabled pointer-events-none border-none"},readonly:{false:"focus-within:ring-active-foreground/40",true:"!bg-surface-1 !text-dark cursor-text border-none"},invalid:{false:"border-med focus-within:border-active-dark focus-within:ring-active-foreground/40",true:"border-error-base focus-within:border-error-base focus-within:ring-destructive-foreground/30"},typeahead:{false:"cursor-pointer caret-transparent",true:null}},defaultVariants:{disabled:false,readonly:false,invalid:false,typeahead:false}};const c=class{constructor(s){t(this,s);this.atuiChange=e(this,"atuiChange",7)}options;label="";hint_text="";error_text="";info_text="";placeholder="";required;invalid;clearable;disabled;readonly;typeahead;value=[];searchText="";isOpen=false;translations;parentWidth="";hasMatchingOptions=false;get el(){return s(this)}menuId=`dropdown-${Math.random().toString(36).substring(2,11)}`;menuRef;optionEls=[];searchInputEl;watchValue(t){const e=t??[];this.optionEls.forEach((t=>{const s=e.includes(t.value);if(t.is_active!==s){t.is_active=s}}))}watchSearchText(t){const e=t.trim().toLowerCase();if(this.options&&this.options.length>0){this.hasMatchingOptions=this.hasMatchingItems(this.options,t);return}this.optionEls.forEach((t=>{const s=!e||t.value.toLowerCase().includes(e);t.style.display=s?"":"none"}));this.hasMatchingOptions=Array.from(this.optionEls).some((t=>t.style.display!=="none"))}atuiChange;componentWillLoad(){n(this.el).then((t=>{this.translations=t}))}componentDidLoad(){this.setupOptionElements();const t=this.el.getBoundingClientRect();this.parentWidth=`${t.width}px`}setupOptionElements(){this.optionEls=[];if(!this.options||this.options.length===0){this.el.querySelectorAll("at-select-option").forEach((t=>{const e=t;e.is_active=(this.value??[]).includes(e.value);e.addEventListener("atuiClick",(t=>{this.handleChange(t.detail)}));this.optionEls.push(e)}))}this.hasMatchingOptions=this.hasMatchingItems(this.optionEls,this.searchText)}updateIsOpenState(t){this.isOpen=t.detail;if(this.isOpen&&this.typeahead){requestAnimationFrame((()=>{if(this.searchInputEl){this.searchInputEl.focus()}}))}}handleChange(t){this.value=this.value.includes(t)?this.value.filter((e=>e!==t)):[...this.value,t];this.atuiChange.emit(this.value)}handleClear(){this.searchText=""}async handleKeyDownMenu(t){if(t.key==="Enter"||t.key===" "){if(t.target instanceof HTMLLIElement){t.preventDefault();t.target.click()}return}const e=this.el.querySelector(`ul[id="${this.menuId}"]`);if(!e)return;o(t,e);h(t,e)}hasMatchingItems(t,e){const s=e.trim().toLowerCase();return s?t?.some((t=>t.value.toLowerCase().includes(s)))??false:true}handleSearchInput(t){const e=t.target;this.searchText=e.value}render(){return i(a,{key:"ce9fcec1a42a6f7c75e72e6b86bc85bb43995dd8",class:"group/select",onFocusout:async t=>{const e=t.relatedTarget;if(!e||!this.el.contains(e)){this.handleClear();setTimeout((async()=>{await(this.menuRef?.closeMenu())}),100)}}},this.renderLabel(),i("at-menu",{key:"37c0b5797f2136780dbd28f67099c6ece9e70db7",ref:t=>this.menuRef=t,trigger:"click",align:"start",width:this.parentWidth,role:"listbox",autoclose:false,disabled:this.disabled||this.readonly,onAtuiMenuStateChange:t=>this.updateIsOpenState(t)},this.renderInput(),!this.disabled||!this.readonly?this.renderOptions():null),i("div",{key:"9f5e42ef15f31b14b3d964bbf4d41af9441c2c11"},this.error_text&&this.invalid&&i("span",{key:"02cc4258cbf992327a3a1aa7cfee342ea07f7949","data-name":"multi-select-error",class:"text-error"},this.error_text)))}renderLabel(){return i("div",{class:"mb-4 flex flex-col"},i("slot",{name:"label"}),(this.label||this.required||this.info_text)&&i("at-form-label",{for:this.menuId,label:this.label,required:this.required&&!this.readonly,info_text:this.info_text}),this.hint_text&&i("span",{class:"text-med text-xs leading-tight","data-name":"multi-select-hint"},this.hint_text))}renderInput(){const t=r("placeholder-text-light transition[background-color,color,box-shadow] relative flex min-h-36 min-h-[36px] w-full flex-shrink flex-grow basis-0 gap-4 rounded-md border border-solid py-4 pr-24 pl-8 duration-300 ease-in-out outline-none focus-within:ring-2 focus-within:outline-0",l);const e=t({invalid:this.invalid,disabled:this.disabled,readonly:this.readonly,typeahead:this.typeahead});return i("div",{class:e,slot:"menu-trigger",tabindex:0},i("div",null,i("at-chip-list",{size:"sm",class:"w-full focus-within:ring-0",readonly:this.readonly,disabled:this.disabled,show_clear_all:this.clearable,onAtRemoveChip:t=>{this.value=this.value.filter((e=>!t.detail.includes(e)));this.atuiChange.emit(this.value)},chips:this.value,"data-name":"multi-select-chips-inside"},this.value.length===0&&i("div",{class:"text-body text-disabled pointer-events-none select-none"},this.placeholder))),!this.readonly&&!this.disabled&&i("div",{class:"absolute right-4 flex items-center"},i("div",{class:"user-select-none text-foreground pointer-events-none flex h-full items-center bg-transparent p-4",role:"presentation",tabindex:-1},i("span",{class:"material-icons h-16 w-16 text-[16px] leading-[16px]","data-name":"button-icon-right"},this.isOpen?"arrow_drop_up":"arrow_drop_down"))))}renderOptions(){return i("ul",{id:this.menuId,role:"listbox",class:"contents",onKeyDown:async t=>{await this.handleKeyDownMenu(t)}},this.typeahead&&i("div",{class:"relative z-10 bg-white p-4"},i("input",{"data-name":"multi-select-input",type:"text",class:`transition[background-color,color] bg-surface-1 ring-active-foreground/40 mb-4 h-[28px] w-full flex-shrink flex-grow basis-0 rounded-md p-8 outline-0 duration-300 ease-in-out focus:ring-2 ${this.clearable?"pr-24":""} `,placeholder:this.translations?.ATUI?.SEARCH||"Search",name:"",value:this.searchText,onInput:t=>{t.stopPropagation();this.handleSearchInput(t)},onClick:t=>t.stopPropagation(),ref:t=>this.searchInputEl=t}),this.clearable&&this.searchText!==""&&i("div",{class:"absolute top-4 right-4"},i("at-button",{class:"m-2",size:"sm",icon:"cancel",type:"secondaryText",onClick:t=>{t.stopPropagation();this.searchText="";this.searchInputEl.value=""},"data-name":"multi-select-search-clear"}))),this.options?.filter((t=>!this.searchText||t.value.toLowerCase().includes(this.searchText.toLowerCase()))).map((t=>this.renderOption(t))),i("slot",null),this.typeahead&&this.searchText&&!this.hasMatchingOptions&&i("div",{"data-name":"no-results-found",class:"text-body text-light w-full bg-white px-16 py-8"},this.translations?.ATUI?.NO_RESULTS_FOUND||"No results found"))}renderOption(t){return i("at-select-option",{value:t.value,is_active:this.value.includes(t.value),"data-name":"multi-select-option",onAtuiClick:()=>this.handleChange(t.value)})}static get watchers(){return{value:["watchValue"],searchText:["watchSearchText"]}}};export{c as at_multi_select};
//# sourceMappingURL=p-c2ee30a6.entry.js.map