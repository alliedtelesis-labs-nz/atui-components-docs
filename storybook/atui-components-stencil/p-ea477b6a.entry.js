import{r as t,c as e,g as i,h as s,H as a}from"./p-jvbUuQtg.js";import{f as n}from"./p-DuLooPsr.js";import{c as o}from"./p-COG8_R0C.js";import{h as r,a as l}from"./p-CF3ljWUs.js";const h={variants:{focused:{false:"ring-active-foreground/30",true:"pointer-events-none"},disabled:{false:"focus-within:ring-active-foreground/30 cursor-pointer bg-white",true:"bg-surface-1 !text-disabled pointer-events-none border-none"},readonly:{false:"focus-within:ring-active-foreground/30",true:"!bg-surface-1 !text-dark cursor-text border-none"},invalid:{false:"border-med focus-within:border-active-dark focus-within:ring-active-foreground/30",true:"border-error-base focus-within:border-error-base focus-within:ring-destructive-foreground/30"}},defaultVariants:{disabled:!1,readonly:!1,invalid:!1}},c=class{constructor(i){t(this,i),this.atuiChange=e(this,"atuiChange",7)}value;options;label;hint_text;info_text;placeholder;error_text;required;invalid;disabled;readonly;typeahead=!1;clearable=!1;autoclose=!0;inputEl;searchText="";isOpen=!1;translations;hasMatchingElOptions=!1;parentWidth;filteredOptions=[];selectedLabel="";get el(){return i(this)}menuId=`dropdown-${Math.random().toString(36).substring(2,11)}`;menuRef;optionEls=[];searchInputEl;slottedOptionLabels=new Map;watchValue(t){this.selectedLabel=this.findLabelByValue(t),this.optionEls.forEach((e=>{e.is_active=t===e.value}))}watchSearchText(t){const e=t.trim().toLowerCase();if(this.options&&this.options.length>0)return this.filteredOptions=this.filterOptions(this.options),void(this.hasMatchingElOptions=this.filteredOptions.length>0);this.filterSlottedContent(e),this.hasMatchingElOptions=Array.from(this.optionEls).some((t=>"none"!==t.style.display))}watchFilterInputs(){this.filteredOptions=this.filterOptions(this.options||[]),this.value&&(this.selectedLabel=this.findLabelByValue(this.value))}atuiChange;componentWillLoad(){n(this.el).then((t=>{this.translations=t}))}componentDidLoad(){this.setupOptionElements(),this.options&&this.options.length>0&&(this.filteredOptions=this.options);const t=this.el.getBoundingClientRect();this.parentWidth=`${t.width}px`}setupOptionElements(){this.slottedOptionLabels.clear(),this.el.querySelectorAll("at-select-option").forEach((t=>{const e=t,i=e.label;i&&this.slottedOptionLabels.set(e.value,i),e.is_active=this.value===e.value,this.addListenerToOptionElements(e),this.optionEls.push(e)}))}addListenerToOptionElements(t){t.addEventListener("atuiClick",(t=>{this.handleChange(t.detail)})),t.addEventListener("mousedown",(()=>{t.disabled||this.handleChange(t.value)}))}filterOptions(t){const e=this.searchText.trim().toLowerCase();return e?t.map((t=>{if(this.isGroup(t)){const i=t.children.filter((t=>(t.label||t.value).toLowerCase().includes(e)||t.value.toLowerCase().includes(e)));return i.length>0?{...t,children:i}:null}return(t.label||t.value).toLowerCase().includes(e)||t.value.toLowerCase().includes(e)?t:null})).filter(Boolean):t}filterSlottedContent(t){this.optionEls.forEach((e=>{const i=!t||(e.label||e.value).toLowerCase().includes(t)||e.value.toLowerCase().includes(t);e.style.display=i?"":"none"})),this.el.querySelectorAll("at-select-group").forEach((t=>{const e=Array.from(t.querySelectorAll("at-select-option")).some((t=>"none"!==t.style.display));t.style.display=e?"":"none"}))}updateIsOpenState(t){this.isOpen=t.detail;const e=this.el.querySelector('[slot="menu-trigger"]'),i=e?.getBoundingClientRect();i&&i.width>0&&(this.parentWidth=`${i.width}px`),this.isOpen&&this.typeahead?requestAnimationFrame((()=>{this.searchInputEl&&this.searchInputEl.focus()})):this.isOpen||(this.searchText="")}async handleChange(t){this.autoclose&&await(this.menuRef?.closeMenu()),this.value=t,this.selectedLabel=this.findLabelByValue(t),this.inputEl.focus(),this.atuiChange.emit(this.value)}handleClear(){this.searchText="",this.searchInputEl.focus()}async handleKeyDownMenu(t){if("Enter"===t.key||" "===t.key)return void(t.target instanceof HTMLLIElement&&(t.preventDefault(),t.target.click()));const e=this.el.querySelector('ul[id="at-select"]');e&&(r(t,e),l(t,e))}handleSearchInput(t){this.searchText=t.target.value.toLowerCase()}isGroup(t){return!!(t.children&&t.children.length>0)}findOptionByValue(t){if(t&&this.options&&0!==this.options.length)return this.options.flatMap((t=>t.children?[t,...t.children]:[t])).find((e=>e.value===t))}findLabelByValue(t){if(!t)return"";if(this.options&&this.options.length>0){const e=this.findOptionByValue(t);return e?.label||t}return this.slottedOptionLabels.has(t)?this.slottedOptionLabels.get(t):t}get hasMatchingOptions(){return this.filteredOptions.length>0}get hasAnyMatchingOptions(){return this.options&&this.options.length>0?this.hasMatchingOptions:this.hasMatchingElOptions}get hasAnyOptions(){return this.options&&this.options.length>0||this.optionEls.length>0}render(){return s(a,{key:"d35e01fb67a5c46c2d54034fd9535bf036cf9170",class:"group/select",onFocusout:async t=>{const e=t.relatedTarget;e&&this.el.contains(e)||setTimeout((async()=>{await(this.menuRef?.closeMenu())}),100)}},this.renderLabel(),s("at-menu",{key:"4573dab274fb6c881dcaee0c3159226b67d481b9",ref:t=>this.menuRef=t,trigger:"click",align:"start",width:this.parentWidth,role:"listbox",disabled:this.disabled||this.readonly,onAtuiMenuStateChange:t=>this.updateIsOpenState(t)},this.renderInput(),this.disabled||this.readonly?null:this.renderOptions()),s("div",{key:"2820428119d6cc40aca2c324bb60a99149d4057a"},this.error_text&&this.invalid&&s("span",{key:"d92b62524a0c598f2f23b626d244d6558263b896",class:"text-error","data-name":"select-error"},this.error_text)))}renderLabel(){return s("div",{class:"mb-4 flex flex-col"},s("slot",{name:"label"}),(this.label||this.required||this.info_text)&&s("at-form-label",{for:this.menuId,label:this.label,required:this.required&&!this.readonly,info_text:this.info_text}),this.hint_text&&s("span",{class:"text-light inline-block text-xs leading-tight","data-name":"select-hint"},this.hint_text))}renderInput(){const t=o("height-[36px] transition[background-color,color,box-shadow] placeholder-text-light group/select:focus-within:ring-2 w-full cursor-pointer rounded-md border border-solid p-8 outline-0 duration-300 ease-in-out select-none focus:ring-2",h)({invalid:this.invalid,disabled:this.disabled,readonly:this.readonly});return s("div",{class:"relative flex items-center gap-4",slot:"menu-trigger","data-name":"select-input-container"},s("input",{class:t,role:"combobox",list:"at-select","aria-expanded":this.isOpen,"aria-controls":this.menuId,type:"text",readonly:!0,"aria-disabled":this.disabled,disabled:this.disabled,placeholder:this.placeholder,value:this.selectedLabel||this.value,"data-name":"select-input",ref:t=>this.inputEl=t}),this.clearable&&this.value&&!this.readonly&&!this.disabled&&s("div",{class:"absolute top-4 right-24"},s("at-button",{class:"m-2",size:"sm",icon:"cancel",type:"secondaryText",onClick:async t=>{t.stopPropagation(),this.value="",this.atuiChange.emit(this.value),this.inputEl&&this.inputEl.focus()},"data-name":"select-clear-main"})),!this.readonly&&!this.disabled&&s("div",{class:"bg-surface1 absolute right-4 flex h-full cursor-pointer items-center rounded-md p-4 select-none",role:"presentation",tabindex:-1},s("span",{class:"material-icons h-16 w-16 text-[16px] leading-[16px]","data-name":"button-icon-right"},this.isOpen?"arrow_drop_up":"arrow_drop_down")))}renderOptions(){return s("ul",{class:"contents",id:"at-select",onKeyDown:async t=>{await this.handleKeyDownMenu(t)}},this.typeahead&&this.hasAnyOptions&&s("div",{class:"relative z-10 bg-white p-4"},s("input",{type:"text",class:"transition[background-color,color] bg-surface-1 ring-active-foreground/30 mb-4 h-[28px] w-full flex-shrink flex-grow basis-0 rounded-md p-8 pr-24 outline-0 duration-300 ease-in-out focus:ring-2",placeholder:this.translations?.ATUI?.SEARCH||"Search",name:"",autoComplete:"off","aria-autocomplete":"list",value:this.searchText,onInput:t=>{t.stopPropagation(),this.handleSearchInput(t)},onClick:t=>t.stopPropagation(),ref:t=>this.searchInputEl=t}),""!==this.searchText&&s("div",{class:"absolute top-4 right-4"},s("at-button",{class:"m-2",size:"sm",icon:"cancel",type:"secondaryText",onMouseDown:t=>t.preventDefault(),onClick:t=>{t.stopPropagation(),this.handleClear()},onKeyDown:t=>{if("Escape"!==t.key)return"Enter"===t.key||" "===t.key?(t.preventDefault(),t.stopPropagation(),void this.handleClear()):void t.stopPropagation()},"data-name":"select-clear"}))),this.filteredOptions?.map((t=>this.isGroup(t)?this.renderGroupedOption(t):this.renderOption(t))).filter(Boolean),s("slot",null),this.typeahead&&this.searchText&&this.hasAnyOptions&&!this.hasAnyMatchingOptions&&s("div",{"data-name":"no-results-found",class:"text-body text-light w-full bg-white px-16 py-8"},this.translations?.ATUI?.NO_RESULTS_FOUND||"No results found"),!this.hasAnyOptions&&s("div",{"data-name":"no-options-available",class:"text-body text-light w-full bg-white px-16 py-8"},this.translations?.ATUI?.NO_OPTIONS_AVAILABLE||"No options available"))}renderOption(t){return s("at-select-option",{key:t.value,value:t.value,label:t.label||t.value,is_active:this.value===t.value,disabled:t.disabled,onAtuiClick:()=>this.handleChange(t.value),onMouseDown:()=>{t.disabled||this.handleChange(t.value)}})}renderGroupedOption(t){return this.isGroup(t)&&t.children&&0!==t.children.length?s("at-select-group",{key:t.value,label:t.label||t.value},t.children.map((t=>s("at-select-option",{value:t.value,label:t.label||t.value,is_active:this.value===t.value,disabled:t.disabled,option_group:!0,onAtuiClick:()=>this.handleChange(t.value)})))):null}static get watchers(){return{value:[{watchValue:0}],searchText:[{watchSearchText:0}],options:[{watchFilterInputs:0}]}}},d=class{constructor(e){t(this,e)}label;render(){return s(a,{key:"306758dba4f8966853ec7527c8bb8ab2584ea5ee",role:"group","aria-labelledby":this.label,"data-name":"select-option-group"},s("div",{key:"ef34db7e8f1d13681397574f6dc7fe9c0e6a7593",role:"group","aria-labelledby":this.label},s("li",{key:"a7b5b869ac2ebfd0f31c1543a5d7dd995afc64b4",id:this.label,class:"text-light border-light border-b px-0 pt-8 pb-4 text-sm","data-name":"select-option-group-title"},this.label),s("slot",{key:"1634e871d0e12937b7db9e1648d7dbc02d4e7731"})))}},u={variants:{active:{true:"bg-active-light text-active",false:"hover:bg-disabled-light bg-white"},group_option:{true:"px-16 ",false:null}}},p=class{constructor(i){t(this,i),this.atuiClick=e(this,"atuiClick",7)}value;label;option_group=!1;is_active=!1;disabled=!1;atuiClick;handleClick(){this.atuiClick.emit(this.value)}render(){const t=o("transition[background-color,color,box-shadow] text-body focus:ring-active-foreground/40 flex w-full items-center truncate p-8 font-normal duration-300 ease-in-out focus:ring-2 focus:outline-0 focus:ring-inset gap-4",u),e=this.disabled?"pointer-events-none opacity-50 bg-gray-100 text-gray-400":"cursor-pointer",i=`${t({active:this.is_active,group_option:this.option_group})} ${e}`;return s("li",{key:"71129005359a635371626e439197c0923f9d0e7f",role:"option",value:this.value,"data-name":"select-option","aria-selected":this.is_active?"true":"false","aria-disabled":this.disabled?"true":"false",tabIndex:this.disabled?-1:0,class:i,onClick:this.disabled?void 0:()=>this.handleClick()},s("slot",{key:"44c36d025bd3ce72b35771bdd15712a4adb70256"}),this.label||this.value,s("slot",{key:"7e0c589bde6c2731f3db70037e39f74993fb04f8",name:"after"}))}};export{c as at_select,d as at_select_group,p as at_select_option}