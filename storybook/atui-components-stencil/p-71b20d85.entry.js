import{r as t,c as s,g as i,h as e,H as a}from"./p-DW9Wz0FM.js";import{a as h,c as n,o,f as r,s as c,b as d}from"./p-BO6p966C.js";const l=class{constructor(i){t(this,i),this.atuiMenuStateChange=s(this,"atuiMenuStateChange",7)}offset_x=0;offset_y=0;position="bottom";align="start";width="fit-content";autoclose=!0;trigger="click";role="menu";disabled=!1;trigger_id;disabledChanged(t){t&&this.isOpen&&this.closeMenu()}isOpen=!1;triggerEl;menuEl;triggerEls=[];popoverId;cleanupAutoUpdate;updatePosition=async()=>{this.triggerEl&&this.menuEl&&this.isOpen&&await this.updateFloatingPosition()};get el(){return i(this)}async toggleMenu(){this.disabled||(this.menuEl&&(this.menuEl.togglePopover(),this.isOpen=this.menuEl.matches(":popover-open")),this.atuiMenuStateChange.emit(this.isOpen),await this.updatePosition(),this.updateAriaExpanded())}async openMenu(){this.disabled||(this.menuEl&&(this.menuEl.showPopover(),this.isOpen=!0),this.atuiMenuStateChange.emit(!0),await this.updatePosition(),this.updateAriaExpanded())}async closeMenu(){this.menuEl&&(this.menuEl.hidePopover(),this.isOpen=!1),this.atuiMenuStateChange.emit(!1),this.updateAriaExpanded()}updateAriaExpanded(){this.trigger_id&&this.triggerEl&&this.triggerEl.setAttribute("aria-expanded",this.isOpen?"true":"false")}async getIsOpen(){return this.isOpen}atuiMenuStateChange;timedOutCloser;async componentDidLoad(){if(this.popoverId=`atui-menu-${Math.random().toString(36).substr(2,9)}`,this.trigger_id){if(this.triggerEls=Array.from(document.querySelectorAll(`[data-menu="${this.trigger_id}"]`)),0===this.triggerEls.length)return void console.warn(`atui-menu: No elements found with data-menu="${this.trigger_id}"`)}else this.triggerEl=this.el.querySelector('[data-name="menu-trigger"]');await this.setupFloatingUI(),setTimeout((()=>this.setupPopoverEventListeners()),0),this.trigger_id&&this.triggerEls.length&&this.setupExternalTriggerListeners()}setupPopoverEventListeners(){this.menuEl&&this.menuEl.addEventListener("toggle",(t=>{this.isOpen="open"===t.newState,this.atuiMenuStateChange.emit(this.isOpen),this.isOpen&&requestAnimationFrame((()=>this.updatePosition()))}))}setupExternalTriggerListeners(){this.triggerEls&&0!==this.triggerEls.length&&this.triggerEls.forEach((t=>{const s=[];"hover"===this.trigger&&s.push({event:"mouseenter",handler:()=>{this.disabled||(this.triggerEl=t,this.mouseEnterHandler())}},{event:"mouseleave",handler:()=>{this.disabled||(this.triggerEl=t,this.mouseLeaveHandler())}}),"click"===this.trigger&&s.push({event:"click",handler:async s=>{this.disabled||(s.preventDefault(),s.stopPropagation(),this.triggerEl=t,this.isOpen?await this.closeMenu():await this.openMenu())}}),s.push({event:"keydown",handler:async s=>{if(!this.disabled)switch(this.triggerEl=t,s.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":s.preventDefault(),await this.toggleMenu()}}}),s.forEach((({event:s,handler:i})=>{t.addEventListener(s,i),this.externalTriggerListeners.push({element:t,event:s,handler:i})})),t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded","false")}))}disconnectedCallback(){this.cleanupFloatingUI(),this.cleanupExternalTriggerListeners()}externalTriggerListeners=[];cleanupExternalTriggerListeners(){this.externalTriggerListeners.forEach((({element:t,event:s,handler:i})=>{t.removeEventListener(s,i)})),this.externalTriggerListeners=[]}async mouseEnterHandler(){this.timedOutCloser&&clearTimeout(this.timedOutCloser),this.isOpen||await this.openMenu()}async mouseLeaveHandler(){await this.closeMenu()}async setupFloatingUI(){if(this.cleanupAutoUpdate&&this.cleanupAutoUpdate(),this.triggerEl&&this.menuEl){const t=new IntersectionObserver((t=>{!t[0].isIntersecting&&this.isOpen&&this.mouseLeaveHandler()}),{threshold:0});t.observe(this.triggerEl),this.cleanupAutoUpdate=h(this.triggerEl,this.menuEl,(()=>{if(this.isOpen){const t=this.getFloatingUIPlacement(),s="fixed";n(this.triggerEl,this.menuEl,{placement:t,strategy:s,middleware:[o("bottom"===this.position||"top"===this.position?this.offset_y:this.offset_x),r({fallbackStrategy:"bestFit",padding:8}),c({padding:8,mainAxis:!0,crossAxis:!0}),d({apply({availableWidth:t,availableHeight:s,elements:i}){Object.assign(i.floating.style,{maxWidth:`${t}px`,maxHeight:`${s}px`})}})]}).then((({x:t,y:i})=>{const e={position:s,left:`${t}px`,top:`${i}px`,margin:"0",transform:"none"};this.width&&(e.width=this.width),Object.assign(this.menuEl.style,e)}))}}),{ancestorScroll:!0,ancestorResize:!0,elementResize:!0,layoutShift:!0,animationFrame:!0});const s=this.cleanupAutoUpdate;this.cleanupAutoUpdate=()=>{s(),t.disconnect()}}}cleanupFloatingUI(){this.cleanupAutoUpdate&&(this.cleanupAutoUpdate(),this.cleanupAutoUpdate=void 0)}async updateFloatingPosition(){this.triggerEl&&this.menuEl&&await this.setupFloatingUI()}getFloatingUIPlacement(){return`${{top:"top",bottom:"bottom",left:"left",right:"right"}[this.position]||"bottom"}-${{start:"start",end:"end"}[this.align]||"start"}`}render(){return e(a,{key:"144a141a806758a8f3066c755fbe78ac281f19a0",class:"relative",onBlur:()=>"click"!==this.trigger||this.disabled?null:this.mouseLeaveHandler()},!this.trigger_id&&e("div",{key:"40396b10f8d088980502764682aa0125a4dd7645","aria-haspopup":"true","data-name":"menu-trigger",ref:t=>this.triggerEl=t,"aria-expanded":this.isOpen?"true":"false",onMouseEnter:()=>"hover"!==this.trigger||this.disabled?null:this.mouseEnterHandler(),onKeyDown:async t=>{switch(t.key){case"Escape":await this.closeMenu();break;case"Enter":case" ":t.preventDefault(),await this.toggleMenu()}},onMouseLeave:()=>"hover"!==this.trigger||this.disabled?null:this.mouseLeaveHandler(),onClick:async t=>{"click"!==this.trigger||this.disabled||(t.preventDefault(),t.stopPropagation(),this.isOpen?await this.closeMenu():await this.openMenu())},class:this.disabled?"contents":""},e("slot",{key:"7d4d6432d199a426f6b3d6c4d79e9f3dc6032fce",name:"menu-trigger"})),e("div",{key:"1d997423edf1f2bba344301bf0d65aff6119dea4",role:this.role,"data-position":this.position,"data-align":this.align,ref:t=>this.menuEl=t,"aria-hidden":this.isOpen?"false":"true",popover:"auto",id:this.popoverId,onMouseEnter:()=>"hover"===this.trigger&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>"hover"===this.trigger&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:async t=>{"Enter"!==t.key&&" "!==t.key&&"Escape"!==t.key||this.autoclose&&await this.mouseLeaveHandler()},onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:"w-fit rounded-md bg-white p-4 shadow-md transition-opacity duration-150 "+(this.isOpen?"opacity-100":"opacity-0"),"data-name":"menu-content-wrapper"},e("slot",{key:"39f2c55bd85323abc89f92521f944e56cac4da59"})))}static get watchers(){return{disabled:[{disabledChanged:0}]}}};export{l as at_menu}