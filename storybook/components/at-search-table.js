import{p as t,H as e,d as s,h as a,c as i,t as o}from"./p-CGooRokE.js";import{f as r}from"./p-DuLooPsr.js";import{d as n}from"./p-Di0GDcCy.js";import{d as h}from"./p-BA03dtkB.js";import{d as l}from"./p-DTGC4HMe.js";import{d as c}from"./p-C4e7KAAJ.js";import{d}from"./p-DhOP89rt.js";import{d as m}from"./p-xXNoYwpu.js";import{d as p}from"./p-COVJfV1p.js";import{d as u}from"./p-Bi3WoZuh.js";import{d as f}from"./p-C98B8n5X.js";import{d as b}from"./p-C8CzOlpz.js";import{d as g}from"./p-Dkwz2oiW.js";import{d as _}from"./p-Bysykz15.js";import{d as k}from"./p-Cfcmc9gI.js";import{d as C}from"./p-Rw0Ekv0e.js";import{d as y}from"./p-fqKldy9p.js";import{d as E}from"./p-CY_ceumQ.js";import{d as x}from"./p-BB8h0pmC.js";import{d as j}from"./p-vzbyODBw.js";import{d as w}from"./p-Cd3zAnZ2.js";import{d as F}from"./p-pfB-V43j.js";import{d as v}from"./p-Dfg4lUNr.js";var D;!function(t){t[t.ASC=1]="ASC",t[t.DESC=-1]="DESC"}(D||(D={}));const S=t(class extends e{constructor(t){super(),!1!==t&&this.__registerHost(),this.atSearchParamsChange=s(this,"atSearchParamsChange",7),this.atExportCsv=s(this,"atExportCsv",7),this.atExportPdf=s(this,"atExportPdf",7)}table_data;label;search_label;search_hint;search_info_tooltip;col_defs=[];page_size=10;hide_dropdown_filters;hide_column_manager;hide_export_menu;hide_csv_export=!1;hide_pdf_export=!1;use_custom_pagination=!1;auto_size_columns=!0;server_side_mode=!1;loading=!1;atSearchParamsChange;atExportCsv;atExportPdf;get el(){return this}translations;agGrid;tableCreated=!1;activeFilters={};selectedFilters=[];menuSelectedIds=[];searchValue="";currentPage=1;pageSize=this.page_size||10;tableEl;get shouldShowDropdownFilters(){return!this.hide_dropdown_filters&&this.col_defs&&this.col_defs.length>0}get shouldShowColumnManager(){return!this.hide_column_manager&&this.col_defs&&this.col_defs.length>0}get totalPages(){return Math.max(1,Math.ceil((this.table_data?.total||0)/this.pageSize))}handleSelectedFiltersChange(t){this.menuSelectedIds=t.map((t=>t.id))}async componentWillLoad(){this.translations=await r(this.el)}async componentDidLoad(){await this.initGrid(),this.server_side_mode&&this.agGrid&&this.emitSearchParamsChange()}async componentDidUpdate(){this.tableCreated||await this.initGrid()}async updateRowByIndex(t,e){const s=this.agGrid.getRenderedNodes();t.forEach((({index:t,update:a})=>{const i=s.find((e=>e.rowIndex===t));i&&(i.updateData(a),e?.flash&&this.agGrid.flashCells({rowNodes:[i]}),this.agGrid.refreshCells({rowNodes:[i],force:e?.forceRefresh||!1}))}))}async getDisplayedRows(){return this.agGrid.getRenderedNodes()}async initGrid(){this.col_defs&&!this.tableCreated&&this.tableEl&&(this.agGrid=await this.tableEl.createGrid(),this.tableCreated=!0,this.setupExternalFilters(),this.agGrid.addEventListener("sortChanged",(()=>{this.server_side_mode&&this.emitSearchParamsChange()})),this.table_data?.items&&this.agGrid.setGridOption("rowData",this.table_data.items))}setupExternalFilters(){this.agGrid&&(this.server_side_mode||(this.agGrid.setGridOption("isExternalFilterPresent",(()=>Object.keys(this.activeFilters).length>0)),this.agGrid.setGridOption("doesExternalFilterPass",(t=>{if(!t.data)return!0;const e=this.searchValue;if(e){const s=e.toLowerCase();if(!this.col_defs.some((e=>{let a;return e.valueGetter&&"function"==typeof e.valueGetter?a=e.valueGetter({data:t.data,node:t,colDef:e,api:this.agGrid,context:null,getValue:e=>t.data[e],column:null}):e.field&&(a=t.data[e.field]),a&&(a+"").toLowerCase().includes(s)})))return!1}return Object.entries(this.activeFilters).every((([e,s])=>{if("__search__"===e||!s)return!0;const a=this.col_defs.find((t=>t.field===e));let i;return i=a&&a.valueGetter&&"function"==typeof a.valueGetter?a.valueGetter({data:t.data,node:t,colDef:a,api:this.agGrid,context:null,getValue:e=>t.data[e],column:null}):t.data[e],i&&(i+"").toLowerCase().includes((s+"").toLowerCase())}))}))))}handleColumnChange(t){const{id:e,checked:s}=t.detail,a=this.col_defs.map((t=>t.field===e?{...t,hide:!s}:t));this.col_defs=a}handleFilterChange(t){if(!t.detail||Array.isArray(t.detail)&&0===t.detail.length)return this.selectedFilters=[],this.menuSelectedIds=[],void this.updateActiveFilters();Array.isArray(t.detail)&&("string"==typeof t.detail[0]?this.handleMenuFilterChange(t.detail):"object"==typeof t.detail[0]&&this.handleFilterListChange(t.detail)),this.updateActiveFilters()}handleMenuFilterChange(t){this.selectedFilters=t.map((t=>({id:t,value:""}))),this.menuSelectedIds=t}handleFilterListChange(t){!t.length||1===t.length&&""===t[0].id?(this.selectedFilters=[],this.menuSelectedIds=[]):(this.selectedFilters=t,this.menuSelectedIds=t.map((t=>t.id)))}updateActiveFilters(){this.activeFilters=this.col_defs.reduce(((t,e)=>(t[e.field]="",t)),{}),this.selectedFilters.forEach((t=>{t.value&&(this.activeFilters[t.id]=t.value)})),this.server_side_mode?this.emitSearchParamsChange():this.agGrid?(this.setupExternalFilters(),this.agGrid.onFilterChanged()):console.log("agGrid not available, cannot apply filter")}handleSearchChange(t){this.searchValue=t.detail||"",this.updateActiveFilters()}handlePageChange(t){this.currentPage=t.detail,this.emitSearchParamsChange()}handlePageSizeChange(t){this.pageSize=t.detail,this.currentPage=1,this.emitSearchParamsChange()}emitSearchParamsChange(){if(!this.agGrid)return;const t=(this.currentPage-1)*this.pageSize,e=this.currentPage*this.pageSize,s=this.agGrid.getColumnState(),a=s.find((t=>null!=t.sort)),i=s.filter((t=>!t.hide)).map((t=>t.colId)),o=Object.values(this.activeFilters).some((t=>""!==t));let r;r="asc"===a?.sort?D.ASC:"desc"===a?.sort?D.DESC:D.ASC;const n={columns:i,globalFilter:this.searchValue,...o?{fieldFilters:this.activeFilters}:{},startRow:t,endRow:e,sort:a?.colId??"",direction:r};this.atSearchParamsChange.emit(n)}handleExport(t){const e=t.detail;if("CSV"===e)this.atExportCsv.emit({start:(this.currentPage-1)*this.pageSize,end:this.currentPage*this.pageSize});else if("PDF"===e){const t=this.col_defs.filter((t=>!t.hide)).map((t=>({field:t.field,displayName:t.headerName||t.field,actualWidth:t.width})));this.atExportPdf.emit(t)}}render(){return a(i,{key:"d8c6166a0ced66e3e26df9c032aab48781170275"},a("at-table-actions",{key:"81e044c27dd929d902a52668f4a6fccc905b1cd6",ag_grid:this.agGrid},a("div",{key:"fa0130cf85c6afb25706bcdec4b42fc91a22927d",class:"flex items-center gap-8 px-8",slot:"search"},this.shouldShowDropdownFilters&&a("at-table-filter-menu",{key:"d2486b6c6da0e49ae2193469789ac6b7c010a041",slot:"filter-menu",col_defs:this.col_defs,selected:this.menuSelectedIds,onAtChange:t=>this.handleFilterChange(t)}),a("at-search",{key:"94b0c9801a7b0c651104f88a8534c2550d7712a4",class:"w-input-md",label:this.search_label,hint_text:this.search_hint,info_text:this.search_info_tooltip,placeholder:this.translations.ATUI.TABLE.SEARCH_BY_KEYWORD,onAtChange:t=>this.handleSearchChange(t)})),this.shouldShowDropdownFilters&&a("at-table-filters",{key:"232d5a90c77a0e70a22cc89e8c1522fca84d261b",slot:"filters",col_defs:this.col_defs,selected:this.selectedFilters,onAtChange:t=>this.handleFilterChange(t)}),!this.hide_export_menu&&a("at-table-export-menu",{key:"0e99599741f822007fe3200975adced108670ca3",slot:"export-menu",hide_csv:this.hide_csv_export,hide_pdf:this.hide_pdf_export,onAtChange:t=>this.handleExport(t)}),this.shouldShowColumnManager&&a("at-column-manager",{key:"42d4914da24968673f92008cf44b71dfb98ba34d",slot:"column-manager",col_defs:this.col_defs,onAtChange:t=>this.handleColumnChange(t)}),a("div",{key:"94002012ef2c39a75bf798938ab0aae5fb238fc0",slot:"actions"},a("slot",{key:"2fee71cd70d15a7981915c5d1bd0bf97227d9df4",name:"actions"}))),a("slot",{key:"6d100336357ec29eec62f4816a9259ce48ec3ad9",name:"multi-select-actions"}),this.loading&&this.server_side_mode?a("at-placeholder",{size:"lg",placeholder_title:this.translations?.ATUI?.TABLE?.LOADING_DATA,show_loading_spinner:!0}):a("at-table",{ref:t=>this.tableEl=t,table_data:this.table_data,col_defs:this.col_defs,page_size:this.server_side_mode?this.pageSize:this.page_size,use_custom_pagination:this.server_side_mode,auto_size_columns:this.auto_size_columns,disable_auto_init:!this.server_side_mode}),this.server_side_mode&&a("at-table-pagination",{key:"9b04724f2fc479349103529d0063dbbdd3770f24",current_page:this.currentPage,num_pages:this.totalPages,onAtChange:t=>this.handlePageChange(t),onAtPageSizeChange:t=>this.handlePageSizeChange(t)}))}static get watchers(){return{selectedFilters:[{handleSelectedFiltersChange:0}]}}},[772,"at-search-table",{table_data:[16],label:[1],search_label:[1],search_hint:[1],search_info_tooltip:[1],col_defs:[16],page_size:[2],hide_dropdown_filters:[4],hide_column_manager:[4],hide_export_menu:[4],hide_csv_export:[4],hide_pdf_export:[4],use_custom_pagination:[4],auto_size_columns:[4],server_side_mode:[4],loading:[4],translations:[32],agGrid:[32],tableCreated:[32],activeFilters:[32],selectedFilters:[32],menuSelectedIds:[32],searchValue:[32],currentPage:[32],pageSize:[32],updateRowByIndex:[64],getDisplayedRows:[64]},void 0,{selectedFilters:[{handleSelectedFiltersChange:0}]}]),z=S,P=function(){"undefined"!=typeof customElements&&["at-search-table","at-button","at-checkbox","at-checkbox-group","at-column-manager","at-form-label","at-input","at-loading","at-menu","at-menu-item","at-placeholder","at-search","at-select","at-select-group","at-select-option","at-table","at-table-actions","at-table-export-menu","at-table-filter-menu","at-table-filters","at-table-pagination","at-tooltip"].forEach((t=>{switch(t){case"at-search-table":customElements.get(o(t))||customElements.define(o(t),S);break;case"at-button":customElements.get(o(t))||n();break;case"at-checkbox":customElements.get(o(t))||h();break;case"at-checkbox-group":customElements.get(o(t))||l();break;case"at-column-manager":customElements.get(o(t))||c();break;case"at-form-label":customElements.get(o(t))||d();break;case"at-input":customElements.get(o(t))||m();break;case"at-loading":customElements.get(o(t))||p();break;case"at-menu":customElements.get(o(t))||u();break;case"at-menu-item":customElements.get(o(t))||f();break;case"at-placeholder":customElements.get(o(t))||b();break;case"at-search":customElements.get(o(t))||g();break;case"at-select":customElements.get(o(t))||_();break;case"at-select-group":customElements.get(o(t))||k();break;case"at-select-option":customElements.get(o(t))||C();break;case"at-table":customElements.get(o(t))||y();break;case"at-table-actions":customElements.get(o(t))||E();break;case"at-table-export-menu":customElements.get(o(t))||x();break;case"at-table-filter-menu":customElements.get(o(t))||j();break;case"at-table-filters":customElements.get(o(t))||w();break;case"at-table-pagination":customElements.get(o(t))||F();break;case"at-tooltip":customElements.get(o(t))||v()}}))};export{z as AtSearchTable,P as defineCustomElement}