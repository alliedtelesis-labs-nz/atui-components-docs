import{p as e,H as t,d as s,h as a,c as i,t as o}from"./p-CGooRokE.js";import{f as l}from"./p-DuLooPsr.js";import{d as r}from"./p-DLlWJE6U.js";import{d as n}from"./p-DRLeV8ma.js";import{d as c}from"./p-xRDYq2-7.js";import{d as h}from"./p-BSoEgRK7.js";import{d}from"./p-BF1qhNk1.js";import{d as m}from"./p-bCnNTi-M.js";import{d as u}from"./p-COVJfV1p.js";import{d as p}from"./p-BqblBn6C.js";import{d as b}from"./p-snekq8Vj.js";import{d as f}from"./p-D5VY_kgf.js";import{d as _}from"./p-BTM957UM.js";import{d as g}from"./p-DXPJTYks.js";import{d as k}from"./p-UEHW1Glk.js";import{d as y}from"./p-BCoyxJYN.js";import{d as E}from"./p-BEPA2dPj.js";import{d as C}from"./p-GHXGK9Ja.js";import{d as j}from"./p-D3zsC1jI.js";var x;!function(e){e[e.ASC=1]="ASC",e[e.DESC=-1]="DESC"}(x||(x={}));const w=e(class extends t{constructor(e){super(),!1!==e&&this.__registerHost(),this.atSearchParamsChange=s(this,"atSearchParamsChange",7)}table_data;label;search_label;search_hint;search_info_tooltip;col_defs=[];page_size=10;hide_dropdown_filters;hide_column_manager;hide_export_menu;use_custom_pagination=!1;auto_size_columns=!0;server_side_mode=!1;loading=!1;atSearchParamsChange;get el(){return this}translations;agGrid;tableCreated=!1;activeFilters={};selectedFilters=[];menuSelectedIds=[];searchValue="";tableEl;get shouldShowDropdownFilters(){return!this.hide_dropdown_filters&&this.col_defs&&this.col_defs.length>0}get shouldShowColumnManager(){return!this.hide_column_manager&&this.col_defs&&this.col_defs.length>0}handleSelectedFiltersChange(e){this.menuSelectedIds=e.map((e=>e.id))}async componentWillLoad(){this.translations=await l(this.el)}async componentDidLoad(){await this.initGrid(),this.server_side_mode&&this.agGrid&&this.emitSearchParamsChange()}async componentDidUpdate(){this.tableCreated||await this.initGrid()}async updateRowByIndex(e,t){const s=this.agGrid.getRenderedNodes();e.forEach((({index:e,update:a})=>{const i=s.find((t=>t.rowIndex===e));i&&(i.updateData(a),t?.flash&&this.agGrid.flashCells({rowNodes:[i]}),this.agGrid.refreshCells({rowNodes:[i],force:t?.forceRefresh||!1}))}))}async getDisplayedRows(){return this.agGrid.getRenderedNodes()}async initGrid(){this.col_defs&&!this.tableCreated&&this.tableEl&&(this.agGrid=await this.tableEl.createGrid(),this.tableCreated=!0,this.setupExternalFilters(),this.table_data?.items&&this.agGrid.setGridOption("rowData",this.table_data.items))}setupExternalFilters(){this.agGrid&&(this.server_side_mode||(this.agGrid.setGridOption("isExternalFilterPresent",(()=>Object.keys(this.activeFilters).length>0)),this.agGrid.setGridOption("doesExternalFilterPass",(e=>{if(!e.data)return!0;const t=this.activeFilters.__search__;if(t){const s=t.toLowerCase();if(!this.col_defs.some((t=>{let a;return t.valueGetter&&"function"==typeof t.valueGetter?a=t.valueGetter({data:e.data,node:e,colDef:t,api:this.agGrid,context:null,getValue:t=>e.data[t],column:null}):t.field&&(a=e.data[t.field]),a&&(a+"").toLowerCase().includes(s)})))return!1}return Object.entries(this.activeFilters).every((([t,s])=>{if("__search__"===t||!s)return!0;const a=this.col_defs.find((e=>e.field===t));let i;return i=a&&a.valueGetter&&"function"==typeof a.valueGetter?a.valueGetter({data:e.data,node:e,colDef:a,api:this.agGrid,context:null,getValue:t=>e.data[t],column:null}):e.data[t],i&&(i+"").toLowerCase().includes((s+"").toLowerCase())}))}))))}handleColumnChange(e){const{id:t,checked:s}=e.detail,a=this.col_defs.map((e=>e.field===t?{...e,hide:!s}:e));this.col_defs=a}handleFilterChange(e){if(!e.detail||Array.isArray(e.detail)&&0===e.detail.length)return this.selectedFilters=[],this.menuSelectedIds=[],void this.updateActiveFilters();Array.isArray(e.detail)&&("string"==typeof e.detail[0]?this.handleMenuFilterChange(e.detail):"object"==typeof e.detail[0]&&this.handleFilterListChange(e.detail)),this.updateActiveFilters()}handleMenuFilterChange(e){this.selectedFilters=e.map((e=>({id:e,value:""}))),this.menuSelectedIds=e}handleFilterListChange(e){!e.length||1===e.length&&""===e[0].id?(this.selectedFilters=[],this.menuSelectedIds=[]):(this.selectedFilters=e,this.menuSelectedIds=e.map((e=>e.id)))}updateActiveFilters(){const e=this.activeFilters.__search__;this.activeFilters={},e&&(this.activeFilters.__search__=e),this.selectedFilters.forEach((e=>{e.value&&(this.activeFilters[e.id]=e.value)})),this.searchValue&&(this.activeFilters.__search__=this.searchValue),this.server_side_mode?this.emitSearchParamsChange():this.agGrid?(this.setupExternalFilters(),this.agGrid.onFilterChanged()):console.log("agGrid not available, cannot apply filter")}handleSearchChange(e){this.searchValue=e.detail||"",this.searchValue?this.activeFilters.__search__=this.searchValue:delete this.activeFilters.__search__,this.updateActiveFilters()}emitSearchParamsChange(){if(!this.agGrid)return;const e=this.agGrid.paginationGetCurrentPage(),t=this.agGrid.paginationGetPageSize(),s=e*t,a=(e+1)*t,i=this.agGrid.getColumnState().find((e=>null!=e.sort));this.atSearchParamsChange.emit({fieldFilters:this.activeFilters,startRow:s,endRow:a,sort:i?.colId,direction:"asc"===i?.sort?x.ASC:x.DESC})}render(){return a(i,{key:"f6c9f97b34fd66623d6243ca47b09484a9082bc4"},a("at-table-actions",{key:"5ee5f0081e0d6602be9b41e99880d846d9048a12",ag_grid:this.agGrid},a("div",{key:"7070e461798b4fa95bec2ee916332bb905be358a",class:"flex items-center gap-8",slot:"search"},this.shouldShowDropdownFilters&&a("at-table-filter-menu",{key:"8af6fef97ea9ce28dd65b68374771484e0c5bd7a",slot:"filter-menu",col_defs:this.col_defs,selected:this.menuSelectedIds,onAtChange:e=>this.handleFilterChange(e)}),a("at-search",{key:"ced4b9d4b764d5f5f3a6cca7d474cd7a08c1994c",class:"w-input-md",label:this.search_label,hint_text:this.search_hint,info_text:this.search_info_tooltip,placeholder:this.translations.ATUI.TABLE.SEARCH_BY_KEYWORD,onAtChange:e=>this.handleSearchChange(e)})),this.shouldShowDropdownFilters&&a("at-table-filters",{key:"24c6df40d1cab769ee6a54ec65c96a59bf02de05",slot:"filters",col_defs:this.col_defs,selected:this.selectedFilters,onAtChange:e=>this.handleFilterChange(e)}),!this.hide_export_menu&&a("at-table-export-menu",{key:"4f52111936c7d280af820611d8c05161de7bc4f3",slot:"export-menu"}),this.shouldShowColumnManager&&a("at-column-manager",{key:"089417e81d8d7c22824d3659b4a43ceb0f9259ed",slot:"column-manager",col_defs:this.col_defs,onAtChange:e=>this.handleColumnChange(e)}),a("div",{key:"0ac4162eac861ca679e04e86f262247ec25a9bb9",slot:"actions"},a("slot",{key:"d48d5b61bf5f6730edd84ee402c9354aa98f14be",name:"actions"}))),a("slot",{key:"d9b7f6eb73f254641a5e4c277585ea0130b5e37d",name:"multi-select-actions"}),this.loading&&this.server_side_mode?a("at-placeholder",{size:"lg",placeholder_title:this.translations?.ATUI?.TABLE?.LOADING_DATA,show_loading_spinner:!0}):a("at-table",{ref:e=>this.tableEl=e,table_data:this.table_data,col_defs:this.col_defs,page_size:this.page_size,use_custom_pagination:this.use_custom_pagination,auto_size_columns:this.auto_size_columns,disable_auto_init:!this.server_side_mode}))}static get watchers(){return{selectedFilters:[{handleSelectedFiltersChange:0}]}}},[772,"at-search-table",{table_data:[16],label:[1],search_label:[1],search_hint:[1],search_info_tooltip:[1],col_defs:[16],page_size:[2],hide_dropdown_filters:[4],hide_column_manager:[4],hide_export_menu:[4],use_custom_pagination:[4],auto_size_columns:[4],server_side_mode:[4],loading:[4],translations:[32],agGrid:[32],tableCreated:[32],activeFilters:[32],selectedFilters:[32],menuSelectedIds:[32],searchValue:[32],updateRowByIndex:[64],getDisplayedRows:[64]},void 0,{selectedFilters:[{handleSelectedFiltersChange:0}]}]),F=w,D=function(){"undefined"!=typeof customElements&&["at-search-table","at-button","at-checkbox","at-checkbox-group","at-column-manager","at-form-label","at-input","at-loading","at-menu","at-menu-item","at-placeholder","at-search","at-table","at-table-actions","at-table-export-menu","at-table-filter-menu","at-table-filters","at-tooltip"].forEach((e=>{switch(e){case"at-search-table":customElements.get(o(e))||customElements.define(o(e),w);break;case"at-button":customElements.get(o(e))||r();break;case"at-checkbox":customElements.get(o(e))||n();break;case"at-checkbox-group":customElements.get(o(e))||c();break;case"at-column-manager":customElements.get(o(e))||h();break;case"at-form-label":customElements.get(o(e))||d();break;case"at-input":customElements.get(o(e))||m();break;case"at-loading":customElements.get(o(e))||u();break;case"at-menu":customElements.get(o(e))||p();break;case"at-menu-item":customElements.get(o(e))||b();break;case"at-placeholder":customElements.get(o(e))||f();break;case"at-search":customElements.get(o(e))||_();break;case"at-table":customElements.get(o(e))||g();break;case"at-table-actions":customElements.get(o(e))||k();break;case"at-table-export-menu":customElements.get(o(e))||y();break;case"at-table-filter-menu":customElements.get(o(e))||E();break;case"at-table-filters":customElements.get(o(e))||C();break;case"at-tooltip":customElements.get(o(e))||j()}}))};export{F as AtSearchTable,D as defineCustomElement}