import{p as e,H as t,d as s,h as a,c as o,t as n}from"./p-CGooRokE.js";import{d as r}from"./p-B9YfMiOg.js";import{d as i}from"./p-COVJfV1p.js";import{d,P as l}from"./p-0dPmnHth.js";import{d as h}from"./p-B8-EiVSh.js";const m=e(class extends t{constructor(e){super(),!1!==e&&this.__registerHost(),this.atThreadMessageCopy=s(this,"atThreadMessageCopy",7),this.atThreadMessageRetry=s(this,"atThreadMessageRetry",7),this.atThreadMessageEdit=s(this,"atThreadMessageEdit",7),this.atThreadMessageVote=s(this,"atThreadMessageVote",7)}messages=[];loading=!1;auto_scroll=!0;chatbot_title="Assistant";enable_vote=!0;enable_copy=!0;enable_edit=!1;response_animation="words";atThreadMessageCopy;atThreadMessageRetry;atThreadMessageEdit;atThreadMessageVote;scrollContainer;componentDidUpdate(){this.auto_scroll&&this.scrollContainer&&this.scrollToBottom()}async scrollToBottom(){return new Promise((e=>{requestAnimationFrame((()=>{this.scrollContainer&&this.scrollContainer.scrollTo({top:this.scrollContainer.scrollHeight,behavior:"smooth"}),e()}))}))}async scrollLastMessageToTop(){return new Promise((e=>{requestAnimationFrame((()=>{if(!this.scrollContainer)return void e();const t=this.scrollContainer.querySelectorAll('[data-role="user"]');t.length?(t[t.length-1].scrollIntoView({behavior:"smooth",block:"start"}),e()):e()}))}))}handleVote(e){const t=this.messages.findIndex((t=>t.id===e.detail.messageId));if(-1!==t){const s=[...this.messages];s[t]={...s[t],score:e.detail.score},this.messages=s,this.atThreadMessageVote.emit(e.detail)}}handleMessageCopy(e){const t=this.getMessageIndexFromEvent(e);-1!==t&&this.atThreadMessageCopy.emit({messageId:this.messages[t].id,content:e.detail})}handleMessageRetry(e){const t=this.getMessageIndexFromEvent(e);-1!==t&&this.atThreadMessageRetry.emit({messageId:this.messages[t].id})}handleMessageEdit(e){const t=this.getMessageIndexFromEvent(e);-1!==t&&this.atThreadMessageEdit.emit({messageId:this.messages[t].id,content:e.detail})}getMessageIndexFromEvent(e){const t=e.target.closest("[data-message-index]");return t?parseInt(t.dataset.messageIndex||"-1",10):-1}renderLoadingIndicator(){return this.loading?a("div",{class:"flex flex-col gap-16","data-name":"loading-container"},a("at-prompt-message",{role:"assistant",content:"Typing...",name:this.chatbot_title,loading:!0,"data-name":"loading-message"})):null}renderMessage(e,t){return a("at-prompt-message",{role:e.role,content:e.content,name:"user"===e.role?e.name:e.name||this.chatbot_title,loading:e.loading,error:e.error,error_message:e.error_message,score:e.score||l.NONE,message_id:e.id,enable_vote:this.enable_vote,enable_copy:this.enable_copy,enable_edit:this.enable_edit,response_animation:"assistant"===e.role?this.response_animation:"fade","data-name":`message-${t}`,"data-message-index":t})}renderMessages(){return this.messages.map(((e,t)=>this.renderMessage(e,t)))}render(){return a(o,{key:"3bfeef903a6134cfed5e1edb430568dd81449c80",class:"block h-full","data-name":"thread-container"},a("div",{key:"0dab7989cfd362ae5032e05cb9d08cbf4c8c869c",class:"flex h-full flex-col gap-16 overflow-y-auto scroll-smooth",ref:e=>this.scrollContainer=e,"data-name":"scroll-container"},this.messages&&this.messages.length>0?a("div",{"data-name":"thread-messages-container",class:"flex flex-col gap-16"},this.renderMessages(),this.renderLoadingIndicator()):a("slot",{name:"thread-empty-state"}),a("slot",{key:"e3f77bb568ce5394ade0b52feae0adef4db3cb33",name:"thread-messages"})))}},[772,"at-prompt-thread",{messages:[1040],loading:[4],auto_scroll:[4],chatbot_title:[1],enable_vote:[4],enable_copy:[4],enable_edit:[4],response_animation:[1],scrollToBottom:[64],scrollLastMessageToTop:[64]},[[0,"atVote","handleVote"],[0,"atCopy","handleMessageCopy"],[0,"atRetry","handleMessageRetry"],[0,"atEdit","handleMessageEdit"]]]);function c(){"undefined"!=typeof customElements&&["at-prompt-thread","at-button","at-loading","at-prompt-message","at-tooltip"].forEach((e=>{switch(e){case"at-prompt-thread":customElements.get(n(e))||customElements.define(n(e),m);break;case"at-button":customElements.get(n(e))||r();break;case"at-loading":customElements.get(n(e))||i();break;case"at-prompt-message":customElements.get(n(e))||d();break;case"at-tooltip":customElements.get(n(e))||h()}}))}export{m as A,c as d}