import{p as t,H as e,d as s,h as i,c as a,t as n}from"./p-CGooRokE.js";import{f as o}from"./p-DuLooPsr.js";import{c as r}from"./p-COG8_R0C.js";import{h as l,a as h}from"./p-CF3ljWUs.js";import{d as c}from"./p-B1u1prpS.js";import{d}from"./p-Di0GDcCy.js";import{d as u}from"./p-Cqg0pAKQ.js";import{d as p}from"./p-Cyh6UBB-.js";import{d as m}from"./p-COVJfV1p.js";import{d as f}from"./p-Bi3WoZuh.js";import{d as b}from"./p-BlDSuP1U.js";import{d as g}from"./p-B9K5Bk9_.js";import{d as x}from"./p-DzzrYA4J.js";const w={variants:{disabled:{false:"focus-within:ring-active-foreground/40 bg-white",true:"bg-surface-1 !text-disabled pointer-events-none border-none"},readonly:{false:"focus-within:ring-active-foreground/40",true:"!bg-surface-1 !text-dark cursor-text border-none"},invalid:{false:"border-med focus-within:border-active-dark focus-within:ring-active-foreground/40",true:"border-error-base focus-within:border-error-base focus-within:ring-destructive-foreground/30"},typeahead:{false:"cursor-pointer caret-transparent",true:null}},defaultVariants:{disabled:!1,readonly:!1,invalid:!1,typeahead:!1}},v=t(class extends e{constructor(t){super(),!1!==t&&this.__registerHost(),this.atuiChange=s(this,"atuiChange",7)}options;label="";hint_text="";error_text="";info_text="";placeholder="";required;invalid;clearable;disabled;readonly;typeahead;value=[];searchText="";isOpen=!1;translations;parentWidth="";hasMatchingElOptions=!1;filteredOptions=[];get el(){return this}menuId="dropdown-"+Math.random().toString(36).substring(2,11);menuRef;optionEls=[];searchInputEl;slottedOptionLabels=new Map;watchValue(t){const e=t??[];this.optionEls.forEach((t=>{const s=e.includes(t.value);t.is_active!==s&&(t.is_active=s)}))}watchOptions(){this.filteredOptions=this.filterOptions(this.options||[])}watchSearchText(t){const e=t.trim().toLowerCase();if(this.options&&this.options.length>0)return this.filteredOptions=this.filterOptions(this.options),void(this.hasMatchingElOptions=this.filteredOptions.length>0);this.filterSlottedContent(e),this.hasMatchingElOptions=Array.from(this.optionEls).some((t=>"none"!==t.style.display))}atuiChange;componentWillLoad(){o(this.el).then((t=>{this.translations=t}))}componentDidLoad(){this.setupOptionElements(),this.options&&this.options.length>0&&(this.filteredOptions=this.options);const t=this.el.getBoundingClientRect();this.parentWidth=t.width+"px"}filterOptions(t){const e=this.searchText.trim().toLowerCase();return e?t.map((t=>{if(this.isGroup(t)){const s=t.children.filter((t=>(t.label||t.value).toLowerCase().includes(e)||t.value.toLowerCase().includes(e)));return s.length>0?{...t,children:s}:null}return(t.label||t.value).toLowerCase().includes(e)||t.value.toLowerCase().includes(e)?t:null})).filter(Boolean):t}filterSlottedContent(t){this.optionEls.forEach((e=>{const s=!t||(e.label||e.value).toLowerCase().includes(t)||e.value.toLowerCase().includes(t);e.style.display=s?"":"none"})),this.el.querySelectorAll("at-select-group").forEach((t=>{const e=Array.from(t.querySelectorAll("at-select-option")).some((t=>"none"!==t.style.display));t.style.display=e?"":"none"}))}setupOptionElements(){this.slottedOptionLabels.clear(),this.optionEls=[],this.el.querySelectorAll("at-select-option").forEach((t=>{const e=t,s=e.label;s&&this.slottedOptionLabels.set(e.value,s),e.is_active=(this.value??[]).includes(e.value),this.addListenerToOptionElements(e),this.optionEls.push(e)}))}addListenerToOptionElements(t){t.addEventListener("atuiClick",(t=>{this.handleChange(t.detail)}))}findOptionByValue(t){if(t&&this.options&&0!==this.options.length)return this.options.flatMap((t=>t.children?[t,...t.children]:[t])).find((e=>e.value===t))}findLabelByValue(t){if(!t)return"";if(this.options&&this.options.length>0){const e=this.findOptionByValue(t);return e?.label||t}return this.slottedOptionLabels.has(t)?this.slottedOptionLabels.get(t):t}getSelectedLabels(){return this.value&&Array.isArray(this.value)?this.value.map((t=>this.findLabelByValue(t))):[]}updateIsOpenState(t){this.isOpen=t.detail,this.isOpen&&this.typeahead?requestAnimationFrame((()=>{this.searchInputEl&&this.searchInputEl.focus()})):this.isOpen||(this.searchText="")}handleChange(t){this.value=this.value.includes(t)?this.value.filter((e=>e!==t)):[...this.value,t],this.atuiChange.emit(this.value)}handleClear(){this.searchText="",this.searchInputEl&&(this.searchInputEl.value="",this.searchInputEl.focus())}async handleKeyDownMenu(t){if("Enter"===t.key||" "===t.key)return void(t.target instanceof HTMLLIElement&&(t.preventDefault(),t.target.click()));const e=this.el.querySelector(`ul[id="${this.menuId}"]`);e&&(l(t,e),h(t,e))}handleSearchInput(t){this.searchText=t.target.value}handleRemoveChip(t){const e=t.detail,s=this.getSelectedLabels(),i=e.map((t=>{const e=s.indexOf(t);return e>=0?this.value[e]:null})).filter(Boolean);this.value=this.value.filter((t=>!i.includes(t))),this.atuiChange.emit(this.value)}isGroup(t){return!!(t.children&&t.children.length>0)}get hasMatchingOptions(){return this.filteredOptions.length>0}get hasAnyMatchingOptions(){return this.options&&this.options.length>0?this.hasMatchingOptions:this.hasMatchingElOptions}get hasAnyOptions(){return this.options&&this.options.length>0||this.optionEls.length>0}render(){return i(a,{key:"f1ecaf11533b5fe716119f9c56432e8a0296ce97",class:"group/select",onFocusout:async t=>{const e=t.relatedTarget;e&&this.el.contains(e)||setTimeout((async()=>{await(this.menuRef?.closeMenu())}),100)}},this.renderLabel(),i("at-menu",{key:"dab43126a5b0f50448fd4f7f8679bde909f71e72",ref:t=>this.menuRef=t,trigger:"click",align:"start",width:this.parentWidth,role:"listbox",autoclose:!1,disabled:this.disabled||this.readonly,onAtuiMenuStateChange:t=>this.updateIsOpenState(t)},this.renderInput(),this.disabled||this.readonly?null:this.renderOptions()),i("div",{key:"3ee569519e481d4ee74b821945277bbf4dedc02a"},this.error_text&&this.invalid&&i("span",{key:"9a02dc2b6ed09af672af6e62a0750408dc876541","data-name":"multi-select-error",class:"text-error"},this.error_text)))}renderLabel(){return i("div",{class:"mb-4 flex flex-col"},i("slot",{name:"label"}),(this.label||this.required||this.info_text)&&i("at-form-label",{for:this.menuId,label:this.label,required:this.required&&!this.readonly,info_text:this.info_text}),this.hint_text&&i("span",{class:"text-med text-xs leading-tight","data-name":"multi-select-hint"},this.hint_text))}renderInput(){const t=r("placeholder-text-light transition[background-color,color,box-shadow] relative flex min-h-36 min-h-[36px] w-full flex-shrink flex-grow basis-0 gap-4 rounded-md border border-solid py-4 pr-24 pl-8 duration-300 ease-in-out outline-none focus-within:ring-2 focus-within:outline-0",w)({invalid:this.invalid,disabled:this.disabled,readonly:this.readonly,typeahead:this.typeahead});return i("div",{class:t,slot:"menu-trigger","data-name":"multi-select-input-container",tabindex:0},i("at-chip-list",{size:"sm",class:"w-full focus-within:ring-0",readonly:this.readonly,disabled:this.disabled,show_clear_all:this.clearable,onAtRemoveChip:t=>this.handleRemoveChip(t),chips:this.getSelectedLabels(),"data-name":"multi-select-chips-inside"},0===this.value.length&&i("div",{class:"text-body text-disabled pointer-events-none select-none"},this.placeholder)),!this.readonly&&!this.disabled&&i("div",{class:"absolute right-4 flex items-center"},i("div",{class:"user-select-none text-foreground pointer-events-none flex h-full items-center bg-transparent p-4",role:"presentation",tabindex:-1},i("span",{class:"material-icons h-16 w-16 text-[16px] leading-[16px]","data-name":"button-icon-right"},this.isOpen?"arrow_drop_up":"arrow_drop_down"))))}renderOptions(){return i("ul",{id:this.menuId,role:"listbox",class:"contents",onKeyDown:async t=>{await this.handleKeyDownMenu(t)}},this.typeahead&&this.hasAnyOptions&&i("div",{class:"relative z-10 bg-white p-4"},i("input",{"data-name":"multi-select-search-input",autocomplete:"off",type:"text",class:"transition[background-color,color] bg-surface-1 ring-active-foreground/40 mb-4 h-[28px] w-full flex-shrink flex-grow basis-0 rounded-md p-8 pr-24 outline-0 duration-300 ease-in-out focus:ring-2",placeholder:this.translations?.ATUI?.SEARCH||"Search",value:this.searchText,onInput:t=>{t.stopPropagation(),this.handleSearchInput(t)},onClick:t=>t.stopPropagation(),ref:t=>this.searchInputEl=t}),""!==this.searchText&&i("div",{class:"absolute top-4 right-4"},i("at-button",{class:"m-2",size:"sm",icon:"cancel",type:"secondaryText",onMouseDown:t=>t.preventDefault(),onClick:t=>{t.stopPropagation(),this.handleClear()},onKeyDown:t=>{if("Escape"!==t.key)return"Enter"===t.key||" "===t.key?(t.preventDefault(),t.stopPropagation(),void this.handleClear()):void t.stopPropagation()},"data-name":"multi-select-search-clear"}))),this.filteredOptions?.map((t=>this.isGroup(t)?this.renderGroupedOption(t):this.renderOption(t))).filter(Boolean),i("slot",null),this.typeahead&&this.searchText&&this.hasAnyOptions&&!this.hasAnyMatchingOptions&&i("div",{"data-name":"no-results-found",class:"text-body text-light w-full bg-white px-16 py-8"},this.translations?.ATUI?.NO_RESULTS_FOUND||"No results found"),!this.hasAnyOptions&&i("div",{"data-name":"no-options-available",class:"text-body text-light w-full bg-white px-16 py-8"},this.translations?.ATUI?.NO_OPTIONS_AVAILABLE||"No options available"))}renderGroupedOption(t){return this.isGroup(t)&&t.children&&0!==t.children.length?i("at-select-group",{key:t.value,label:t.label||t.value},t.children.map((t=>i("at-select-option",{key:t.value,value:t.value,label:t.label||t.value,disabled:t.disabled,is_active:this.value.includes(t.value),"data-name":"multi-select-option",option_group:!0,onAtuiClick:()=>this.handleChange(t.value)})))):null}renderOption(t){return i("at-select-option",{key:t.value,value:t.value,label:t.label||t.value,disabled:t.disabled,is_active:this.value.includes(t.value),"data-name":"multi-select-option",onAtuiClick:()=>this.handleChange(t.value)})}static get watchers(){return{value:[{watchValue:0}],options:[{watchOptions:0}],searchText:[{watchSearchText:0}]}}},[772,"at-multi-select",{options:[1040],label:[1],hint_text:[1],error_text:[1],info_text:[1],placeholder:[1],required:[4],invalid:[4],clearable:[4],disabled:[4],readonly:[4],typeahead:[4],value:[1040],searchText:[32],isOpen:[32],translations:[32],parentWidth:[32],hasMatchingElOptions:[32],filteredOptions:[32]},void 0,{value:[{watchValue:0}],options:[{watchOptions:0}],searchText:[{watchSearchText:0}]}]),y=v,k=function(){"undefined"!=typeof customElements&&["at-multi-select","at-badge","at-button","at-chip-list","at-form-label","at-loading","at-menu","at-select-group","at-select-option","at-tooltip"].forEach((t=>{switch(t){case"at-multi-select":customElements.get(n(t))||customElements.define(n(t),v);break;case"at-badge":customElements.get(n(t))||c();break;case"at-button":customElements.get(n(t))||d();break;case"at-chip-list":customElements.get(n(t))||u();break;case"at-form-label":customElements.get(n(t))||p();break;case"at-loading":customElements.get(n(t))||m();break;case"at-menu":customElements.get(n(t))||f();break;case"at-select-group":customElements.get(n(t))||b();break;case"at-select-option":customElements.get(n(t))||g();break;case"at-tooltip":customElements.get(n(t))||x()}}))};export{y as AtMultiSelect,k as defineCustomElement}