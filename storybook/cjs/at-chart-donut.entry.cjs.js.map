{"version":3,"file":"at-chart-donut.entry.cjs.js","sources":["src/components/at-chart-donut/at-chart-donut.tsx"],"sourcesContent":["import { Component, h, Host, Method, Prop } from '@stencil/core';\nimport {\n    ArcElement,\n    Chart,\n    ChartConfiguration,\n    ChartDataset,\n    DoughnutController,\n    Filler,\n    Legend,\n    Tooltip,\n    Plugin,\n} from 'chart.js';\nimport 'chartjs-adapter-moment';\nimport { ChartColorPalette } from '../../types/chart-color';\nimport { getChartColors } from '../../utils/chart-color';\nconst TOKEN_TEXT_DARK = '#0f172a';\n\nexport type Height = 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'auto';\nexport type LegendPosition = 'top' | 'bottom' | 'left' | 'right';\n\nconst heightVariants = {\n    xs: 'h-[70px]',\n    sm: 'h-[160px]',\n    md: 'h-[235px]',\n    lg: 'h-[330px]',\n    xl: 'h-[440px]',\n    auto: 'h-full',\n};\n\n/**\n * @category Data Visualization\n * @description A donut chart component for visualizing proportional data with customizable colors and legends. Built on Chart.js with responsive design and interactive hover effects.\n */\n@Component({\n    tag: 'at-chart-donut',\n    shadow: false,\n})\nexport class AtChartDonut {\n    /**\n     * Data to be shown in the chart. ChartDataset properties can be found\n     * [here](https://www.chartjs.org/docs/latest/charts/doughnut.html#dataset-properties)\n     */\n    @Prop()\n    data: {\n        labels: string[];\n        datasets: ChartDataset[];\n    };\n\n    /**\n     * Additional options to be added to the chart configuration\n     */\n    @Prop()\n    options?: object;\n\n    /**\n     * Height of the chart\n     */\n    @Prop()\n    height?: Height = 'auto';\n\n    /**\n     * Position of the legend\n     */\n    @Prop()\n    legend_position: LegendPosition = 'top';\n\n    /**\n     * Additional options for formatting the legend\n     */\n    @Prop()\n    legend_format?: object = {\n        labels: {\n            boxWidth: 10,\n            boxHeight: 10,\n            fontSize: 11,\n        },\n        onHover: (event): void => {\n            if (event.native) {\n                (event.native.target as HTMLElement).style.cursor = 'pointer';\n            }\n        },\n        // Toggle slice visibility on click and disable tooltips if none visible\n        onClick: (_evt, legendItem, legend) => {\n            const chart = legend.chart;\n            const idx = legendItem.index;\n            chart.toggleDataVisibility(idx);\n            const anyVisible = chart.data.labels?.some((_, i) =>\n                chart.getDataVisibility(i),\n            );\n            if (chart.options.plugins?.tooltip) {\n                chart.options.plugins.tooltip.enabled = !!anyVisible;\n            }\n            chart.update();\n        },\n        display: true,\n    };\n\n    /**\n     * Additional options for the tooltip\n     */\n    @Prop()\n    tooltip_options?: object = {\n        mode: 'nearest',\n        intersect: true,\n        position: 'nearest',\n    };\n\n    /**\n     * Additional plugin options\n     */\n    @Prop()\n    plugins?: Plugin[];\n\n    /**\n     * Colour palette to use for the chart. Preset options are provided ChartColourPalette:\n     * 'categorical' : For charts with data that have distinct labels and no natural order\n     * 'sequential' : For charts with data that is numeric or is naturally ordered.\n     * 'alert' : For charts that relate to health state. Note that data requires a specific order.\n     * 'custom' : Use colors defined in data. If none are provided, the ChartJS default will be used.\n     */\n    @Prop()\n    color_palette: ChartColorPalette = ChartColorPalette.CATEGORICAL;\n\n    /**\n     * Optional value text to display in the center of the donut chart\n     */\n    @Prop()\n    center_value?: string;\n\n    /**\n     * Optional heading text to display in the center of the donut chart\n     */\n    @Prop()\n    center_text?: string;\n\n    /**\n     * Controls the thickness of the donut ring. Value between 0 and 100.\n     * 0 means no cutout (solid circle), 100 means maximum cutout (thin ring).\n     * Default is 70.\n     */\n    @Prop()\n    cutout?: number = 70;\n\n    canvasEl: HTMLCanvasElement;\n    config: ChartConfiguration;\n    chart: Chart;\n\n    /**\n     * Getter method for the chart's configuration object\n     * @returns Configuration of the chart\n     */\n    @Method()\n    async getConfig(): Promise<object> {\n        return this.config;\n    }\n\n    /**\n     * Manually trigger a chart resize to fit container dimensions\n     */\n    @Method()\n    async resize(): Promise<void> {\n        if (this.chart) {\n            this.chart.resize();\n        }\n    }\n\n    defaultPieTooltipOptions = {\n        mode: 'nearest',\n        intersect: true,\n        position: 'nearest',\n        animation: {\n            duration: 150,\n        },\n    };\n\n    private getDrawCenterTextPlugin(): Plugin {\n        return {\n            id: 'DrawCenterTextPlugin',\n            afterDatasetDraw: (chart): void => {\n                const centerX =\n                    (chart.chartArea.left + chart.chartArea.right) / 2;\n                const centerY =\n                    (chart.chartArea.top + chart.chartArea.bottom) / 2;\n                const ctx = chart.ctx;\n                if (!ctx) {\n                    return;\n                }\n\n                ctx.restore();\n\n                const height = chart.chartArea.bottom - chart.chartArea.top;\n                const textFontSize =\n                    (height / 200).toFixed(2) + 'em sans-serif';\n                const valueFontSize =\n                    (height / 140).toFixed(2) + 'em sans-serif';\n\n                ctx.fillStyle = TOKEN_TEXT_DARK;\n                ctx.textAlign = 'center';\n                ctx.textBaseline = 'middle';\n                ctx.font = '500 ' + valueFontSize;\n\n                const addText = (\n                    fontSize: string,\n                    text: string,\n                    x: number,\n                    y: number,\n                    position: 'top' | 'middle' | 'bottom',\n                ): void => {\n                    ctx.font = '500 ' + fontSize;\n                    const textMetrics = ctx.measureText(text);\n                    const textHeight =\n                        textMetrics.actualBoundingBoxAscent +\n                        textMetrics.actualBoundingBoxDescent;\n\n                    if (position != 'middle') {\n                        y =\n                            position === 'top'\n                                ? y - textHeight\n                                : y + textHeight;\n                    }\n                    ctx.fillText(text, x, y);\n                };\n\n                if (this.center_value) {\n                    addText(\n                        valueFontSize,\n                        this.center_value,\n                        centerX,\n                        centerY,\n                        'top',\n                    );\n                    addText(\n                        textFontSize,\n                        this.center_text,\n                        centerX,\n                        centerY,\n                        'bottom',\n                    );\n                } else if (this.center_text) {\n                    addText(\n                        textFontSize,\n                        this.center_text,\n                        centerX,\n                        centerY,\n                        'middle',\n                    );\n                }\n\n                ctx.save();\n            },\n        };\n    }\n\n    initChart() {\n        Chart.register(DoughnutController, ArcElement, Legend, Tooltip, Filler);\n\n        const dpr = window.devicePixelRatio || 1;\n        const colors = getChartColors(this.color_palette);\n\n        if (colors) {\n            this.applyPresetPalette(colors);\n        }\n\n        const plugins = this.plugins ? [...this.plugins] : [];\n        if (this.center_text || this.center_value) {\n            plugins.push(this.getDrawCenterTextPlugin());\n        }\n\n        this.config = {\n            type: 'doughnut',\n            data: {\n                ...this.data,\n                datasets: this.data.datasets.map((dataset) => ({\n                    ...dataset,\n                    cutout: `${this.cutout}%`,\n                })),\n            },\n            options: {\n                devicePixelRatio: dpr,\n                maintainAspectRatio: false,\n                aspectRatio: 1,\n                layout: { padding: 16 },\n                interaction: { mode: 'nearest', intersect: true },\n                plugins: {\n                    legend: {\n                        ...(this.legend_format || {}),\n                        position: this.legend_position,\n                        fullSize: true,\n                    },\n                    tooltip: {\n                        ...(this.tooltip_options ||\n                            this.defaultPieTooltipOptions),\n                        filter: (ctx) =>\n                            ctx.chart.getDataVisibility(ctx.dataIndex),\n                        enabled: true,\n                    },\n                },\n                ...(this.options || {}),\n            },\n            plugins,\n        };\n\n        if (this.chart) {\n            this.chart.destroy();\n        }\n        this.chart = new Chart(\n            this.canvasEl,\n            this.config as ChartConfiguration,\n        );\n    }\n    applyPresetPalette(colors: string[]): void {\n        if (this.color_palette === ChartColorPalette.CUSTOM) {\n            return;\n        }\n\n        this.data.datasets = this.data.datasets.map((dataset) => {\n            const color = dataset.data.map(\n                (_, index) => colors[index % colors.length],\n            );\n\n            return {\n                ...dataset,\n                backgroundColor: color,\n                hoverBackgroundColor: color,\n                borderColor: color,\n                hoverBorderColor: color,\n            };\n        });\n    }\n\n    componentDidUpdate() {\n        if (this.data && this.data.datasets.length) {\n            this.initChart();\n        }\n    }\n\n    /**\n     * componentDidLoad will be run, but if the props haven't been passed to it yet,\n     * it will throw an error. So we catch this, and wait for the props to be passed\n     * to the component where it will run componentDidUpdtae.\n     */\n    componentDidLoad() {\n        if (this.data && this.data.datasets.length) {\n            this.initChart();\n        }\n    }\n\n    render() {\n        return (\n            <Host style={{ height: '100%', width: '100%' }}>\n                <canvas\n                    ref={(el) => (this.canvasEl = el)}\n                    class={`w-full min-w-100 ${heightVariants[this.height]}`}\n                />\n            </Host>\n        );\n    }\n}\n"],"names":["ChartColorPalette","Chart","DoughnutController","ArcElement","Legend","Tooltip","Filler","getChartColors","h","Host"],"mappings":"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"}