{"version":3,"file":"atui-chart-donut.js","sourceRoot":"","sources":["../../../src/components/atui-chart-donut/atui-chart-donut.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Host, Method, Prop } from '@stencil/core';\nimport {\n    ArcElement,\n    Chart,\n    ChartConfiguration,\n    ChartDataset,\n    DoughnutController,\n    Filler,\n    Legend,\n    Tooltip,\n    Plugin,\n} from 'chart.js';\nimport 'chartjs-adapter-moment';\nimport { ChartColorPalette } from '../../types/chart-color';\nimport { getChartColors } from '../../utils/chart-color';\nconst TOKEN_TEXT_DARK = '#0f172a';\n\nexport type Height = 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'auto';\nexport type LegendPosition = 'top' | 'bottom' | 'left' | 'right';\n\nconst heightVariants = {\n    xs: 'h-[70px]',\n    sm: 'h-[160px]',\n    md: 'h-[235px]',\n    lg: 'h-[330px]',\n    xl: 'h-[440px]',\n    auto: 'h-full',\n};\n\n/**\n * @category Data Visualization\n * @description A donut chart component for visualizing proportional data with customizable colors and legends. Built on Chart.js with responsive design and interactive hover effects.\n */\n@Component({\n    tag: 'atui-chart-donut',\n    shadow: false,\n})\nexport class AtuiChartDonut {\n    /**\n     * Data to be shown in the chart. ChartDataset properties can be found\n     * [here](https://www.chartjs.org/docs/latest/charts/doughnut.html#dataset-properties)\n     */\n    @Prop()\n    data: {\n        labels: string[];\n        datasets: ChartDataset[];\n    };\n\n    /**\n     * Additional options to be added to the chart configuration\n     */\n    @Prop()\n    options?: object;\n\n    /**\n     * Height of the chart\n     */\n    @Prop()\n    height?: Height = 'md';\n\n    /**\n     * Additional options for formatting the legend\n     */\n    @Prop()\n    legend_format?: object = {\n        labels: {\n            boxWidth: 10,\n            boxHeight: 10,\n            fontSize: 11,\n        },\n        onHover: (event): void => {\n            if (event.native) {\n                (event.native.target as HTMLElement).style.cursor = 'pointer';\n            }\n        },\n        display: true,\n    };\n\n    /**\n     * Additional options for the tooltip\n     */\n    @Prop()\n    tooltip_options?: object = {\n        mode: 'index',\n        intersect: false,\n        position: 'nearest',\n    };\n\n    /**\n     * Additional plugin options\n     */\n    @Prop()\n    plugins?: Plugin[];\n\n    /**\n     * Animations added to the chart configuration\n     */\n    @Prop()\n    animations: object;\n\n    /**\n     * Colour palette to use for the chart. Preset options are provided ChartColourPalette:\n     * 'categorical' : For charts with data that have distinct labels and no natural order\n     * 'sequential' : For charts with data that is numeric or is naturally ordered.\n     * 'alert' : For charts that relate to health state. Note that data requires a specific order.\n     * 'custom' : Use colors defined in data. If none are provided, the ChartJS default will be used.\n     */\n    @Prop()\n    color_palette: ChartColorPalette = ChartColorPalette.CATEGORICAL;\n\n    /**\n     * Optional value text to display in the center of the donut chart\n     */\n    @Prop()\n    center_value?: string;\n\n    /**\n     * Optional heading text to display in the center of the donut chart\n     */\n    @Prop()\n    center_text?: string;\n\n    /**\n     * Controls the thickness of the donut ring. Value between 0 and 100.\n     * 0 means no cutout (solid circle), 100 means maximum cutout (thin ring).\n     * Default is 70.\n     */\n    @Prop()\n    cutout?: number = 70;\n\n    canvasEl: HTMLCanvasElement;\n    config: ChartConfiguration;\n\n    /**\n     * Getter method for the chart's configuration object\n     * @returns Configuration of the chart\n     */\n    @Method()\n    async getConfig(): Promise<object> {\n        return this.config;\n    }\n\n    defaultPieTooltipOptions = {\n        mode: 'index',\n        intersect: true,\n        position: 'nearest',\n        animation: {\n            duration: 150,\n        },\n    };\n\n    private getDrawCenterTextPlugin(): Plugin {\n        return {\n            id: 'DrawCenterTextPlugin',\n            afterDatasetDraw: (chart): void => {\n                const centerX =\n                    (chart.chartArea.left + chart.chartArea.right) / 2;\n                const centerY =\n                    (chart.chartArea.top + chart.chartArea.bottom) / 2;\n                const ctx = chart.ctx;\n                if (!ctx) {\n                    return;\n                }\n\n                ctx.restore();\n\n                const height = chart.chartArea.bottom - chart.chartArea.top;\n                const textFontSize =\n                    (height / 250).toFixed(2) + 'em sans-serif';\n                const valueFontSize =\n                    (height / 180).toFixed(2) + 'em sans-serif';\n\n                ctx.fillStyle = TOKEN_TEXT_DARK;\n                ctx.textAlign = 'center';\n                ctx.textBaseline = 'middle';\n                ctx.font = '500 ' + valueFontSize;\n\n                const addText = (\n                    fontSize: string,\n                    text: string,\n                    x: number,\n                    y: number,\n                    position: 'top' | 'middle' | 'bottom',\n                ): void => {\n                    ctx.font = '500 ' + fontSize;\n                    const textMetrics = ctx.measureText(text);\n                    const textHeight =\n                        textMetrics.actualBoundingBoxAscent +\n                        textMetrics.actualBoundingBoxDescent;\n\n                    if (position != 'middle') {\n                        y =\n                            position === 'top'\n                                ? y - textHeight\n                                : y + textHeight;\n                    }\n                    ctx.fillText(text, x, y);\n                };\n\n                if (this.center_value) {\n                    addText(\n                        valueFontSize,\n                        this.center_value,\n                        centerX,\n                        centerY,\n                        'top',\n                    );\n                    addText(\n                        textFontSize,\n                        this.center_text,\n                        centerX,\n                        centerY,\n                        'bottom',\n                    );\n                } else if (this.center_text) {\n                    addText(\n                        textFontSize,\n                        this.center_text,\n                        centerX,\n                        centerY,\n                        'middle',\n                    );\n                }\n\n                ctx.save();\n            },\n        };\n    }\n\n    initChart() {\n        Chart.register(DoughnutController, ArcElement, Legend, Tooltip, Filler);\n\n        const colors = getChartColors(this.color_palette);\n\n        if (colors) {\n            this.applyPresetPalette(colors);\n        }\n\n        const plugins = this.plugins ? [...this.plugins] : [];\n\n        if (this.center_text || this.center_value) {\n            plugins.push(this.getDrawCenterTextPlugin());\n        }\n\n        this.config = {\n            type: 'doughnut',\n            data: {\n                ...this.data,\n                datasets: this.data.datasets.map((dataset) => ({\n                    ...dataset,\n                    cutout: `${this.cutout}%`,\n                })),\n            },\n            options: {\n                animation: this.animations,\n                ...this.options,\n                maintainAspectRatio: true,\n                aspectRatio: 1,\n                layout: {\n                    padding: 16,\n                },\n                plugins: {\n                    legend: this.legend_format,\n                    tooltip:\n                        this.tooltip_options || this.defaultPieTooltipOptions,\n                },\n            },\n            plugins: plugins,\n        };\n\n        new Chart(this.canvasEl, this.config as ChartConfiguration);\n        this.canvasEl.style.width = '100%';\n        this.canvasEl.style.height = '100%';\n    }\n\n    applyPresetPalette(colors: string[]): void {\n        if (this.color_palette === ChartColorPalette.CUSTOM) {\n            return;\n        }\n\n        this.data.datasets = this.data.datasets.map((dataset) => {\n            const color = dataset.data.map(\n                (_, index) => colors[index % colors.length],\n            );\n\n            return {\n                ...dataset,\n                backgroundColor: color,\n                hoverBackgroundColor: color,\n                borderColor: color,\n                hoverBorderColor: color,\n            };\n        });\n    }\n\n    componentDidUpdate() {\n        if (this.data && this.data.datasets.length) {\n            this.initChart();\n        }\n    }\n\n    /**\n     * componentDidLoad will be run, but if the props haven't been passed to it yet,\n     * it will throw an error. So we catch this, and wait for the props to be passed\n     * to the component where it will run componentDidUpdtae.\n     */\n    componentDidLoad() {\n        if (this.data && this.data.datasets.length) {\n            this.initChart();\n        }\n    }\n\n    render() {\n        return (\n            <Host\n                role=\"region\"\n                class={`relative flex w-full flex-col items-center justify-center ${heightVariants[this.height]}`}\n            >\n                <canvas\n                    ref={(el) => (this.canvasEl = el)}\n                    style={{\n                        position: 'absolute',\n                        top: '50%',\n                        left: '50%',\n                        transform: 'translate(-50%, -50%)',\n                        maxWidth: '100%',\n                        maxHeight: '100%',\n                    }}\n                />\n            </Host>\n        );\n    }\n}\n"]}