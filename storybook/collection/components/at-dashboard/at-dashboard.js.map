{"version":3,"file":"at-dashboard.js","sourceRoot":"","sources":["../../../src/components/at-dashboard/at-dashboard.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n    Component,\n    Element,\n    Event,\n    EventEmitter,\n    h,\n    Prop,\n    Watch,\n} from '@stencil/core';\nimport {\n    GridItemHTMLElement,\n    GridStack,\n    GridStackNode,\n    GridStackWidget,\n} from 'gridstack';\n\nexport interface CustomGridStackItem extends GridStackNode {\n    id: string;\n    x?: number;\n    y?: number;\n    w?: number;\n    h?: number;\n    [key: string]: any;\n}\n\nconst DEFAULT_SIZE = {\n    w: 4,\n    h: 3,\n};\n\n@Component({\n    tag: 'at-dashboard',\n    styleUrl: 'at-dashboard.scss',\n    shadow: false,\n})\nexport class AtDashboard {\n    @Element() el: HTMLElement;\n\n    @Prop() widget_items: CustomGridStackItem[] = [];\n\n    @Event() changedItem: EventEmitter<CustomGridStackItem>;\n    @Event() removedItem: EventEmitter<CustomGridStackItem>;\n    @Event() resizeDragEvent: EventEmitter<CustomGridStackItem>;\n\n    @Watch('widget_items')\n    widgetItemsChanged(): void {}\n\n    private grid?: GridStack;\n    private gridContainerRef?: HTMLElement;\n\n    componentDidLoad(): void {\n        if (!this.gridContainerRef) return;\n        this.grid = GridStack.init(\n            {\n                margin: 4,\n                minRow: 1,\n                maxRow: 100,\n                float: true,\n                columnOpts: {\n                    columnMax: 12,\n                    breakpoints: [\n                        {\n                            w: 768,\n                            c: 1,\n                            layout: 'compact',\n                        },\n                    ],\n                },\n            },\n            this.gridContainerRef,\n        );\n\n        this.layoutWidgets();\n\n        this.grid.on(\n            'added change',\n            (_event: Event, items?: GridStackNode[]) => {\n                items?.forEach((item) => {\n                    const dashboardItem = this.widget_items.find(\n                        (w) => w.id === item.el.id,\n                    );\n                    if (dashboardItem) {\n                        Object.assign(dashboardItem, {\n                            x: item.x,\n                            y: item.y,\n                            w: item.w ?? DEFAULT_SIZE.w,\n                            h: item.h ?? DEFAULT_SIZE.h,\n                        });\n                        this.changedItem.emit(dashboardItem);\n                    }\n                });\n            },\n        );\n\n        this.grid.on(\n            'resizestop dragstop',\n            (_event: Event, el: GridItemHTMLElement) => {\n                const node = el.gridstackNode;\n                const dashboardItem = {\n                    id: el.id,\n                    x: node.x,\n                    y: node.y,\n                    w: node.w ?? DEFAULT_SIZE.w,\n                    h: node.h ?? DEFAULT_SIZE.h,\n                };\n                this.resizeChartComponents(el);\n                this.resizeDragEvent.emit(dashboardItem);\n            },\n        );\n    }\n\n    componentDidUpdate(): void {\n        this.layoutWidgets();\n    }\n\n    disconnectedCallback(): void {\n        this.grid?.destroy(false);\n    }\n\n    private layoutWidgets(): void {\n        if (!this.grid) return;\n        this.grid.removeAll(false);\n        this.widget_items.forEach((widget) => this.makeWidget(widget));\n    }\n\n    private makeWidget(widget: GridStackWidget): void {\n        const elSelector = `#${widget.id}`;\n        const options: GridStackWidget = {\n            id: widget.id,\n            x: widget.x,\n            y: widget.y,\n            w: widget.w,\n            h: widget.h,\n        };\n        this.grid.makeWidget(elSelector, options);\n    }\n\n    private removeWidget(widget: CustomGridStackItem): void {\n        this.removedItem.emit(widget);\n    }\n\n    private resizeChartComponents(element: HTMLElement): void {\n        const chartSelectors = [\n            'at-chart-donut',\n            'at-chart-bar',\n            'at-chart-line',\n        ];\n\n        chartSelectors.forEach((selector) => {\n            const charts = element.querySelectorAll(selector);\n            charts.forEach((chart: any) => {\n                if (typeof chart.resize === 'function') {\n                    chart.resize();\n                }\n            });\n        });\n    }\n\n    render() {\n        return (\n            <div\n                class=\"grid-stack\"\n                ref={(el) => (this.gridContainerRef = el)}\n            >\n                {this.widget_items.map((widget) => (\n                    <div\n                        class=\"grid-stack-item\"\n                        id={widget.id}\n                        key={widget.id}\n                    >\n                        <div class=\"grid-stack-item-content\">\n                            <div class=\"absolute top-0 right-0\">\n                                <at-menu>\n                                    <at-button\n                                        slot=\"menu-trigger\"\n                                        icon=\"more_vert\"\n                                        type=\"secondaryText\"\n                                    ></at-button>\n                                    <at-button\n                                        label=\"Delete\"\n                                        type=\"secondaryText\"\n                                        onAtuiClick={() => {\n                                            this.removeWidget(widget);\n                                        }}\n                                    ></at-button>\n                                </at-menu>\n                            </div>\n                            <slot name={widget.id}></slot>\n                        </div>\n                    </div>\n                ))}\n            </div>\n        );\n    }\n}\n"]}