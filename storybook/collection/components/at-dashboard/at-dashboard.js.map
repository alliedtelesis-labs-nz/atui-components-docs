{"version":3,"file":"at-dashboard.js","sourceRoot":"","sources":["../../../src/components/at-dashboard/at-dashboard.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n    Component,\n    Element,\n    Event,\n    EventEmitter,\n    h,\n    Prop,\n    // State,\n    Watch,\n} from '@stencil/core';\nimport {\n    GridStack,\n    GridStackElement,\n    GridStackNode,\n    GridStackWidget,\n} from 'gridstack';\nimport gridstackCss from 'gridstack/dist/gridstack.min.css';\n\nexport interface CustomGridStackItem extends GridStackNode {\n    id: string;\n    x?: number;\n    y?: number;\n    w?: number;\n    h?: number;\n    [key: string]: any;\n}\n\n@Component({\n    tag: 'at-dashboard',\n    shadow: false,\n})\nexport class AtDashboard {\n    @Element() el: HTMLElement;\n\n    @Prop() widget_templates: CustomGridStackItem[] = [];\n\n    // @Event() changedDashboard: EventEmitter<CustomGridStackItem[]>;\n    @Event() changedItem: EventEmitter<CustomGridStackItem>;\n    @Event() removedItem: EventEmitter<CustomGridStackItem>;\n    @Event() resizeEvent: EventEmitter<GridStackNode>;\n\n    // @State() dashboard: CustomGridStackItem[] = [];\n\n    @Watch('widget_templates')\n    widgetTemplatesChanged() {\n        // this.updateDashboard();\n        this.needsLayout = true;\n    }\n\n    private grid?: GridStack;\n    private gridContainerRef?: HTMLElement;\n    private needsLayout = false;\n\n    componentWillLoad() {\n        this.injectStyle();\n        // this.updateDashboard();\n    }\n\n    componentDidLoad() {\n        if (!this.gridContainerRef) return;\n        this.grid = GridStack.init(\n            {\n                margin: 4,\n                minRow: 1,\n                maxRow: 100,\n                float: true,\n                columnOpts: {\n                    columnMax: 16,\n                    breakpoints: [\n                        {\n                            w: 768,\n                            c: 1,\n                        },\n                    ],\n                },\n            },\n            this.gridContainerRef,\n        );\n\n        this.grid.on('change', (_event: Event, items?: GridStackNode[]) => {\n            items?.forEach((item) => {\n                const dashboardItem = this.widget_templates.find(\n                    (d) => d.id === item.id,\n                );\n                if (dashboardItem) {\n                    Object.assign(dashboardItem, {\n                        x: item.x,\n                        y: item.y,\n                        w: item.w,\n                        h: item.h,\n                    });\n                    this.changedItem.emit(dashboardItem);\n                }\n            });\n        });\n\n        this.grid.on('resizestop', (_event: Event, el: GridStackElement) => {\n            const node = (el as any).gridstackNode as GridStackNode;\n            this.resizeEvent.emit(node);\n        });\n    }\n\n    componentDidRender() {\n        if (!this.grid || !this.needsLayout) return;\n        this.grid.removeAll(false);\n        this.layoutWidgets();\n        this.needsLayout = false;\n    }\n\n    disconnectedCallback() {\n        this.grid?.destroy(false);\n    }\n\n    // private updateDashboard() {\n    //     if (this.widget_templates?.length) {\n    //         this.dashboard = this.widget_templates.map((template) => ({\n    //             ...template,\n    //         }));\n    //         this.changedDashboard.emit(this.dashboard);\n    //     }\n    // }\n\n    private layoutWidgets() {\n        if (!this.grid) return;\n        this.widget_templates.forEach((widget) => this.makeWidget(widget));\n    }\n\n    private makeWidget(widget: GridStackWidget) {\n        const elSelector = `#${widget.id}`;\n        const options: GridStackWidget = {\n            id: widget.id,\n            x: widget.x,\n            y: widget.y,\n            w: widget.w,\n            h: widget.h,\n        };\n        this.grid.makeWidget(elSelector, options);\n    }\n\n    private removeWidget(widget: CustomGridStackItem): void {\n        this.removedItem.emit(widget);\n    }\n\n    private injectStyle() {\n        const style = document.createElement('style');\n        style.textContent = gridstackCss;\n        this.el.appendChild(style);\n    }\n\n    render() {\n        return (\n            <div\n                class=\"grid-stack\"\n                ref={(el) => (this.gridContainerRef = el)}\n            >\n                {this.widget_templates.map((widget) => (\n                    <div\n                        class=\"grid-stack-item\"\n                        id={widget.id}\n                    >\n                        <div class=\"grid-stack-item-content\">\n                            <div class=\"absolute top-0 right-0\">\n                                <at-menu>\n                                    <at-button\n                                        slot=\"menu-trigger\"\n                                        icon=\"more_vert\"\n                                        type=\"secondaryText\"\n                                    ></at-button>\n                                    <at-button\n                                        label=\"Delete\"\n                                        type=\"secondaryText\"\n                                        onAtuiClick={() => {\n                                            this.removeWidget(widget);\n                                        }}\n                                    ></at-button>\n                                </at-menu>\n                            </div>\n                            <slot name={widget.id}></slot>\n                        </div>\n                    </div>\n                ))}\n            </div>\n        );\n    }\n}\n"]}