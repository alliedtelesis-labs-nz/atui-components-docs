import{r as t,c as s,h as i,H as e,g as h}from"./p-8kq1vl9Q.js";import{c as n}from"./p-CVoOBWGd.js";const o=n("fixed z-menu w-full rounded-md border border-solid border-light bg-white p-4 shadow-md",{variants:{open:{true:null,false:"hidden"}}});const a=class{constructor(i){t(this,i);this.menuStateChange=s(this,"menuStateChange",7);this.offset_x=0;this.offset_y=0;this.position="bottom";this.align="start";this.width="280px";this.autoclose=true;this.trigger="click";this.role="menu";this.disabled=false;this.isOpen=false;this.isIntersectingViewport=false;this.updatePosition=()=>{requestAnimationFrame((()=>{const t=this.triggerEl;if(t){this.triggerPosition=t.getBoundingClientRect()}}))};this.handleOutsideClick=t=>{if(this.isOpen&&!this.el.contains(t.target)){this.mouseLeaveHandler()}}}async toggleMenu(){this.menuStateChange.emit(!this.isOpen);this.isOpen=!this.isOpen;this.updatePosition()}async openMenu(){this.isOpen=true;this.menuStateChange.emit(true)}async closeMenu(){this.isOpen=false;this.menuStateChange.emit(false)}async getIsOpen(){return this.isOpen}componentDidLoad(){this.updatePosition();window.addEventListener("scroll",this.updatePosition,true);window.addEventListener("resize",this.updatePosition);window.addEventListener("click",this.handleOutsideClick);this.initIntersectionObserver()}disconnectedCallback(){window.removeEventListener("scroll",this.updatePosition,true);window.removeEventListener("resize",this.updatePosition);window.removeEventListener("click",this.handleOutsideClick);if(this.observer){this.observer.disconnect()}}initIntersectionObserver(){const t={root:null,rootMargin:"0px",threshold:1};this.observer=new IntersectionObserver((t=>{t.forEach((t=>{if(!t.isIntersecting){this.isIntersectingViewport=true;this.positionStrategy(t)}else{this.isIntersectingViewport=false}}))}),t);const s=this.el.querySelector('[data-name="menu-content-wrapper"]');if(s){this.observer.observe(s)}}positionStrategy(t){if(!this.isOpen)return;const s=window.innerWidth;const i=window.innerHeight;const{top:e,right:h,left:n,height:o}=t.boundingClientRect;if(this.position==="bottom"&&e+o>=i){this.position="top"}else if(this.position==="top"&&e<=0){this.position="bottom"}if(this.position==="right"&&h>=s){this.position="left"}else if(this.position==="left"&&n<=0){this.position="right"}}mouseEnterHandler(){if(this.timedOutCloser)clearTimeout(this.timedOutCloser);if(!this.isOpen){this.isOpen=true;this.menuStateChange.emit(true);this.updatePosition()}}mouseLeaveHandler(){this.isOpen=false;this.menuStateChange.emit(false)}get positionStyle(){var t,s;const i={};const e=(t=this.triggerEl)===null||t===void 0?void 0:t.getBoundingClientRect();const h=(s=this.menuEl)===null||s===void 0?void 0:s.getBoundingClientRect();if(!e)return i;switch(this.position){case"top":i.top=`${e.top-h.height}px`;if(this.align==="start"){i.left=`${e.left}px`}else{i.right=`${window.innerWidth-e.right}px`}break;case"bottom":i.top=`${e.bottom+this.offset_y}px`;if(this.align==="start"){i.left=`${e.left}px`}else{i.right=`${window.innerWidth-e.right-8}px`}break;case"left":i.left=`${e.left-h.width}px`;if(this.align==="start"){i.top=`${e.top}px`}else{i.bottom=`${window.innerHeight-e.bottom}px`}break;case"right":i.left=`${e.right+this.offset_x}px`;if(this.align==="start"){i.top=`${e.top}px`}else{i.bottom=`${window.innerHeight-e.bottom}px`}break}i.width=this.width;return i}render(){const t=o({open:this.isOpen});return i(e,{key:"e3bcb9a968ff521391ea75c55cdf2580b08f002a"},i("div",{key:"6bd2c883986b5354ff880435f6859de4a7481064",class:"relative",onBlur:()=>this.trigger==="click"&&!this.disabled?this.mouseLeaveHandler():null},i("div",{key:"9cf2d5eeedeb17295385a25cb6f52ff32c1b1046","aria-haspopup":"true","data-name":"menu-trigger",ref:t=>this.triggerEl=t,"aria-expanded":`${this.isOpen?"true":"false"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled?this.mouseEnterHandler():null,onKeyDown:async t=>{if(t.key==="Escape"){await this.closeMenu()}},onMouseLeave:()=>this.trigger==="hover"&&!this.disabled?this.mouseLeaveHandler():null,onClick:()=>this.trigger==="click"&&!this.disabled?this.toggleMenu():null,class:this.disabled?"contents":""},i("slot",{key:"c16d4efc9f700d2a72f0f0378cfccea7648caa2b",name:"menu-trigger"})),i("div",{key:"1a895b723e0fa27ec622d874a1c660d6b88f2017",role:this.role,style:this.positionStyle,"data-position":this.position,"data-align":this.align,ref:t=>this.menuEl=t,"aria-hidden":`${this.isOpen?"false":"true"}`,onMouseEnter:()=>this.trigger==="hover"&&!this.disabled&&this.mouseEnterHandler(),onMouseLeave:()=>this.trigger==="hover"&&!this.disabled&&this.mouseLeaveHandler(),onKeyDown:t=>{if(t.key==="Enter"||t.key===" "||t.key==="Escape"){if(this.autoclose){this.mouseLeaveHandler()}}},onClick:()=>this.autoclose&&this.mouseLeaveHandler(),class:t,"data-name":"menu-content-wrapper"},i("slot",{key:"60ba1db461d29b2b443cf800981d9bef1738884a",name:"menu-content"}))))}get el(){return h(this)}};export{a as atui_menu};
//# sourceMappingURL=p-c8c7fd3e.entry.js.map