import{r as t,h as e,H as i,g as s}from"./p-8kq1vl9Q.js";import{f as a}from"./p-DuLooPsr.js";const h=class{constructor(e){t(this,e);this.page_size=10;this.use_custom_pagination=false;this.tableCreated=false;this.activeFilters={};this.selectedFilters=[];this.menuSelectedIds=[];this.searchValue=""}handleSelectedFiltersChange(t){this.menuSelectedIds=t.map((t=>t.id))}async componentWillLoad(){this.translations=await a(this.el)}async componentDidLoad(){await this.initGrid()}async componentDidUpdate(){await this.initGrid()}async updateRowByIndex(t,e){const i=this.agGrid.getRenderedNodes();t.forEach((({index:t,update:s})=>{const a=i.find((e=>e.rowIndex===t));if(a){a.updateData(s);if(e===null||e===void 0?void 0:e.flash){this.agGrid.flashCells({rowNodes:[a]})}this.agGrid.refreshCells({rowNodes:[a],force:(e===null||e===void 0?void 0:e.forceRefresh)||false})}}))}async getDisplayedRows(){return this.agGrid.getRenderedNodes()}async initGrid(){var t;if(this.col_defs&&!this.tableCreated&&this.tableEl){this.agGrid=await this.tableEl.createGrid();this.tableCreated=true;this.setupExternalFilters();if((t=this.table_data)===null||t===void 0?void 0:t.items){this.agGrid.setGridOption("rowData",this.table_data.items)}}}setupExternalFilters(){if(!this.agGrid)return;this.agGrid.setGridOption("isExternalFilterPresent",(()=>{const t=Object.keys(this.activeFilters).length>0;console.log("isExternalFilterPresent called, hasFilters:",t);return t}));this.agGrid.setGridOption("doesExternalFilterPass",(t=>{if(!t.data)return true;const e=this.activeFilters["__search__"];if(e){const i=e.toLowerCase();const s=Object.values(t.data).some((t=>t&&String(t).toLowerCase().includes(i)));if(!s)return false}const i=Object.entries(this.activeFilters).every((([e,i])=>{if(e==="__search__"||!i)return true;const s=t.data[e];const a=s&&String(s).toLowerCase().includes(String(i).toLowerCase());return a}));return i}))}handleColumnChange(t){const{id:e,checked:i}=t.detail;const s=this.col_defs.map((t=>{if(t.field===e){return Object.assign(Object.assign({},t),{hide:!i})}return t}));this.col_defs=s}handleFilterChange(t){if(t.detail){if(Array.isArray(t.detail)&&typeof t.detail[0]==="string"){this.handleMenuFilterChange(t.detail)}else if(Array.isArray(t.detail)&&typeof t.detail[0]==="object"){this.handleFilterListChange(t.detail)}}this.updateActiveFilters()}handleMenuFilterChange(t){this.selectedFilters=t.map((t=>({id:t,value:""})));this.menuSelectedIds=t}handleFilterListChange(t){if(t.length===1&&t[0].id===""){this.selectedFilters=[];this.menuSelectedIds=[]}else{this.selectedFilters=t;this.menuSelectedIds=t.filter((t=>t.value&&t.value.trim()!=="")).map((t=>t.id))}}updateActiveFilters(){this.activeFilters={};this.selectedFilters.forEach((t=>{if(t.value){this.activeFilters[t.id]=t.value}}));if(this.searchValue){this.activeFilters["__search__"]=this.searchValue}if(this.agGrid){this.setupExternalFilters();this.agGrid.onFilterChanged()}else{console.log("agGrid not available, cannot apply filter")}}handleSearchChange(t){this.searchValue=t.detail||"";this.updateActiveFilters()}render(){return e(i,{key:"4c2598c93c350489da9aabb14becb4ac3a7a1b17"},e("atui-table-actions",{key:"69e425b83f8d1521344f1a3123b1b132c6aea8b3",ag_grid:this.agGrid},e("div",{key:"f617060bc1cf9f277d814dbb1bf0ab0c3380871e",class:"flex items-center gap-8",slot:"search"},!this.hide_dropdown_filters&&this.col_defs&&e("atui-table-filter-menu",{key:"65e694dbd10a1a1b4f58fca66d4fb741ca5e907c",slot:"filter-menu",col_defs:this.col_defs,selected:this.menuSelectedIds,onAtuiChange:t=>this.handleFilterChange(t)}),e("atui-search",{key:"160ecc9b1828bb4cf6141ec8410f6c892259480e",class:"w-input-md",label:this.search_label,hint_text:this.search_hint,info_text:this.search_info_tooltip,placeholder:this.translations.ATUI.TABLE.SEARCH_BY_KEYWORD,onAtuiChange:t=>this.handleSearchChange(t)})),!this.hide_dropdown_filters&&this.col_defs&&e("atui-table-filters",{key:"6e590bdb124af1fb5cb4b1c6c673cbc2a5e92f9d",slot:"filters",col_defs:this.col_defs,selected:this.selectedFilters,onAtuiChange:t=>this.handleFilterChange(t)}),!this.hide_export_menu&&e("atui-table-export-menu",{key:"8ca9b6f0c3fcea29a4f62fe4d4bbc1e14c1f4aaa",slot:"export-menu"}),!this.hide_column_manager&&this.col_defs&&e("atui-column-manager",{key:"7e08182de30325b74d8fc82c7141b9509b38a78e",slot:"column-manager",col_defs:this.col_defs,onAtuiChange:t=>this.handleColumnChange(t)}),e("div",{key:"ddcd708522e3fff981b53cf77775a8173621d2ca",slot:"actions"},e("slot",{key:"78182336857c86ef414ddb6b346fefc2e2c42d88",name:"actions"}))),e("slot",{key:"5b3501390290e7363bd29e6ae55eeaaa564e71d8",name:"multi-select-actions"}),e("atui-table",{key:"a9e796054eb4e3462e842b46dfbc4d879f587dab",ref:t=>this.tableEl=t,table_data:this.table_data,col_defs:this.col_defs,page_size:this.page_size,use_custom_pagination:this.use_custom_pagination,disable_auto_init:true}))}get el(){return s(this)}static get watchers(){return{selectedFilters:["handleSelectedFiltersChange"]}}};export{h as atui_search_table};
//# sourceMappingURL=p-c42a642a.entry.js.map